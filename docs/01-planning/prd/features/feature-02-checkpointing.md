# F2. äººæ©Ÿå”ä½œæª¢æŸ¥é»

**é¡åˆ¥**ï¼šå®‰å…¨èˆ‡æ§åˆ¶  
**å„ªå…ˆç´š**ï¼šP0ï¼ˆå¿…é ˆæœ‰ - é—œéµå®‰å…¨åŠŸèƒ½ï¼‰  
**é–‹ç™¼æ™‚é–“**ï¼š2 é€±  
**è¤‡é›œåº¦**ï¼šâ­â­â­â­ï¼ˆé«˜ï¼‰  
**ä¾è³´é …**ï¼šF1ï¼ˆé †åºå¼ç·¨æ’ï¼‰ã€PostgreSQLã€Microsoft Teamsã€Redisï¼ˆå¯é¸ï¼Œç”¨æ–¼ç·©å­˜ï¼‰  
**é¢¨éšªç­‰ç´š**ï¼šä¸­ï¼ˆå¯©æ‰¹è¶…æ™‚è™•ç†è‡³é—œé‡è¦ï¼‰

---

## ğŸ“‘ å°èˆª

- [â† åŠŸèƒ½æ¦‚è¦½](../prd-appendix-a-features-overview.md)
- [â† F1: é †åºå¼ Agent ç·¨æ’](./feature-01-orchestration.md)
- **F2: äººæ©Ÿå”ä½œæª¢æŸ¥é»** â† æ‚¨åœ¨é€™è£¡
- [â†’ F3: è·¨ç³»çµ±é—œè¯](./feature-03-correlation.md)

---

## 2.1 åŠŸèƒ½æ¦‚è¿°

**ä»€éº¼æ˜¯äººæ©Ÿå”ä½œæª¢æŸ¥é»ï¼Ÿ**

äººæ©Ÿå”ä½œï¼ˆHITLï¼‰æª¢æŸ¥é»æ˜¯ä¸€å€‹**é—œéµå®‰å…¨æ©Ÿåˆ¶**ï¼Œåœ¨é å®šç¾©çš„æ±ºç­–é»æš«åœå·¥ä½œæµåŸ·è¡Œï¼Œè¦æ±‚æ˜ç¢ºçš„äººå·¥å¯©æ‰¹æ‰å…è¨± AI Agent ç¹¼çºŒåŸ·è¡Œé«˜é¢¨éšªæ“ä½œã€‚é€™ç¢ºä¿äººé¡åœ¨é—œéµæ“ä½œä¸­ä¿æŒæ§åˆ¶æ¬Šï¼ŒåŒæ™‚ä»èƒ½å—ç›Šæ–¼ AI è‡ªå‹•åŒ–ã€‚

**ç‚ºä»€éº¼é‡è¦**ï¼š
- **é¢¨éšªç·©è§£**ï¼šé˜²æ­¢ AI çŠ¯ä¸‹ä¸å¯é€†è½‰çš„éŒ¯èª¤ï¼ˆä¾‹å¦‚åˆªé™¤ç”Ÿç”¢æ•¸æ“šã€ç™¼é€éŒ¯èª¤é€šä¿¡ï¼‰
- **åˆè¦æ€§**ï¼šæ»¿è¶³æ•æ„Ÿæ“ä½œä¸­äººå·¥ç›£ç£çš„ç›£ç®¡è¦æ±‚ï¼ˆGDPRã€SOC 2ã€HIPAAï¼‰
- **å»ºç«‹ä¿¡ä»»**ï¼šé€šéå¾æ‰‹å‹•å¯©æ‰¹é–‹å§‹ï¼Œéš¨è‘—ä¿¡å¿ƒå¢é•·é€æ­¥æ¼”é€²åˆ°è‡ªå‹•å¯©æ‰¹ï¼Œå…è¨±å° AI çš„æ¼¸é€²ä¿¡ä»»
- **å­¸ç¿’æ©Ÿæœƒ**ï¼šæ•ç²äººå·¥å° AI å»ºè­°çš„ä¿®æ”¹ï¼Œå¯¦ç¾æŒçºŒæ”¹é€²ï¼ˆF5ï¼‰
- **å•è²¬åˆ¶**ï¼šå‰µå»ºæ¸…æ™°çš„å¯©è¨ˆè¿½è¹¤ï¼Œè¨˜éŒ„èª°åœ¨ä½•æ™‚æ‰¹å‡†äº†ä»€éº¼æ“ä½œ

**æ ¸å¿ƒèƒ½åŠ›**ï¼š
1. **å¯é…ç½®è§¸ç™¼å™¨**ï¼šé€šé YAML å®šç¾©æª¢æŸ¥é»è¦å‰‡ï¼ˆé¢¨éšªç­‰ç´šã€æ“ä½œé¡å‹ã€æ•¸æ“šé–¾å€¼ï¼‰
2. **è±å¯Œçš„ä¸Šä¸‹æ–‡å±•ç¤º**ï¼šé¡¯ç¤º AI æè­°çš„æ“ä½œã€æ¨ç†ã€ç½®ä¿¡åº¦åˆ†æ•¸å’Œç›¸é—œæ•¸æ“š
3. **éˆæ´»çš„å¯©æ‰¹æ“ä½œ**ï¼šæ‰¹å‡†ã€æ‹’çµ•æˆ–åœ¨ç¹¼çºŒå‰ä¿®æ”¹åƒæ•¸
4. **è‡ªå‹•å¯©æ‰¹è¦å‰‡**ï¼šé…ç½®ä½é¢¨éšªæ“ä½œçš„è‡ªå‹•å¯©æ‰¹
5. **è¶…æ™‚è™•ç†**ï¼šå¦‚æœåœ¨ SLA å…§æœªæ”¶åˆ°å¯©æ‰¹ï¼Œè‡ªå‹•å‡ç´šæˆ–å–æ¶ˆ
6. **ä¿®æ”¹è¿½è¹¤**ï¼šè¨˜éŒ„æ‰€æœ‰äººå·¥æ›´æ”¹ä»¥ç”¨æ–¼å­¸ç¿’ï¼ˆF5ï¼‰

**å•†æ¥­åƒ¹å€¼**ï¼š
- **å®‰å…¨æ€§**ï¼šé˜²æ­¢ AI éŒ¯èª¤é€ æˆ $100K+ çš„äº‹æ•…ï¼ˆä¾‹å¦‚éŒ¯èª¤åˆªé™¤å®¢æˆ¶æ•¸æ“šï¼‰
- **åˆè¦æ€§**ï¼šé€šéå±•ç¤ºäººå·¥ç›£ç£æ§åˆ¶é€šéå¯©è¨ˆ
- **æ¼¸é€²æ¡ç”¨**ï¼šå¾ 100% äººå·¥å¯©æ‰¹é–‹å§‹ï¼Œéš¨è‘—ä¿¡å¿ƒå»ºç«‹æ¸›å°‘åˆ° <30%
- **æŒçºŒæ”¹é€²**ï¼šå¾äººå·¥ç³¾æ­£ä¸­å­¸ç¿’ä»¥æé«˜ AI æº–ç¢ºæ€§
- **å¿ƒç†å®‰å…¨**ï¼šç”¨æˆ¶å¯ä»¥å®‰å¿ƒï¼ŒçŸ¥é“é—œéµæ“ä½œéœ€è¦å¯©æ‰¹

**å¯¦éš›æ¡ˆä¾‹**ï¼š
```
å®¢æœ Agent å·¥ä½œæµï¼šç™¼é€é€€æ¬¾éƒµä»¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 1: åˆ†æå·¥å–® âœ… å·²å®Œæˆ                                   â”‚
â”‚ æ­¥é©Ÿ 2: è¨ˆç®—é€€æ¬¾é‡‘é¡ âœ… å·²å®Œæˆ ($99.99)                      â”‚
â”‚ æ­¥é©Ÿ 3: ç”Ÿæˆéƒµä»¶ âœ… å·²å®Œæˆ                                   â”‚
â”‚                                                             â”‚
â”‚ â¸ï¸  æª¢æŸ¥é»ï¼šæª¢æ¸¬åˆ°é«˜é¢¨éšªæ“ä½œ                                 â”‚
â”‚                                                             â”‚
â”‚ AI æè­°ï¼š                                                    â”‚
â”‚   æ“ä½œï¼šç™¼é€é€€æ¬¾ç¢ºèªéƒµä»¶                                     â”‚
â”‚   æ”¶ä»¶äººï¼šjohn@example.com                                   â”‚
â”‚   é‡‘é¡ï¼š$99.99                                               â”‚
â”‚   ç½®ä¿¡åº¦ï¼š87%                                                â”‚
â”‚                                                             â”‚
â”‚ âš ï¸  éœ€è¦å¯©æ‰¹çš„åŸå› ï¼š                                          â”‚
â”‚   â€¢ é¢¨éšªç­‰ç´šï¼šHIGHï¼ˆæ¶‰åŠé‡‘éŒ¢ï¼‰                               â”‚
â”‚   â€¢ æ“ä½œé¡å‹ï¼šSEND_EMAIL                                     â”‚
â”‚                                                             â”‚
â”‚ [æ‰¹å‡†] [ä¿®æ”¹] [æ‹’çµ•]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2.2 ç”¨æˆ¶æ•…äº‹ï¼ˆå®Œæ•´ï¼‰

### **US-F2-001: é€šé YAML é…ç½®æª¢æŸ¥é»è¦å‰‡**

**å„ªå…ˆç´š**ï¼šP0ï¼ˆå¿…é ˆæœ‰ï¼‰  
**é ä¼°é–‹ç™¼æ™‚é–“**ï¼š3 å¤©  
**è¤‡é›œåº¦**ï¼šâ­â­â­

**ç”¨æˆ¶æ•…äº‹**ï¼š
- **ä½œç‚º** IT é‹ç¶­ç®¡ç†å“¡ï¼ˆAlex Chenï¼‰
- **æˆ‘æƒ³è¦** ä½¿ç”¨ç°¡å–®çš„ YAML æ–‡ä»¶é…ç½®æª¢æŸ¥é»è¦å‰‡
- **ä»¥ä¾¿** ç„¡éœ€ç·¨å¯«ä»£ç¢¼å³å¯ç²¾ç¢ºå®šç¾©ç³»çµ±ä½•æ™‚æ‡‰æš«åœä»¥ç­‰å¾…å¯©æ‰¹

**é©—æ”¶æ¨™æº–**ï¼š
1. âœ… **YAML é…ç½®**ï¼šç”¨æˆ¶å¯ä»¥ä»¥ YAML æ ¼å¼å®šç¾©æª¢æŸ¥é»è¦å‰‡
2. âœ… **è§¸ç™¼æ¢ä»¶**ï¼šæ”¯æŒå¤šç¨®è§¸ç™¼é¡å‹ï¼š
   - `risk_level`: "low", "medium", "high", "critical"
   - `operation_type`: ["delete", "send_email", "modify_critical", "financial_transaction", "external_api_call"]
   - `data_threshold`: æ•¸å€¼æ¢ä»¶ï¼ˆä¾‹å¦‚ amount > 1000ï¼‰
   - `agent_confidence`: ä½æ–¼æ­¤é–¾å€¼éœ€è¦å¯©æ‰¹ï¼ˆä¾‹å¦‚ < 0.8ï¼‰
   - `custom_field`: åŸ·è¡Œä¸Šä¸‹æ–‡ä¸­çš„ä»»ä½•å­—æ®µ
3. âœ… **è‡ªå‹•å¯©æ‰¹è¦å‰‡**ï¼šé…ç½®ä½•æ™‚è·³éäººå·¥å¯©æ‰¹
4. âœ… **è¶…æ™‚é…ç½®**ï¼šè¨­ç½®å¯©æ‰¹è¶…æ™‚åŠå‡ç´šè¡Œç‚º
5. âœ… **é€šçŸ¥è¨­ç½®**ï¼šé…ç½®èª°æ¥æ”¶é€šçŸ¥ï¼ˆéƒµä»¶ã€Teamsã€Slackï¼‰
6. âœ… **Schema é©—è­‰**ï¼šç³»çµ±åœ¨ä¿å­˜æ™‚é©—è­‰ YAML èªæ³•
7. âœ… **ç†±é‡è¼‰**ï¼šæ›´æ”¹åœ¨ 30 ç§’å…§ç”Ÿæ•ˆç„¡éœ€é‡å•Ÿç³»çµ±
8. âœ… **è¦å‰‡å„ªå…ˆç´š**ï¼šæ”¯æŒå¤šå€‹è¦å‰‡çš„å„ªå…ˆç´šé †åºï¼ˆç¬¬ä¸€å€‹åŒ¹é…çš„ç”Ÿæ•ˆï¼‰

**YAML é…ç½®æ¶æ§‹**ï¼š
```yaml
# checkpoint-rules.yaml
version: "1.0"
checkpoints:
  # è¦å‰‡ 1: é—œéµé‡‘èäº¤æ˜“
  - name: "é«˜åƒ¹å€¼é‡‘èæ“ä½œ"
    priority: 1
    trigger:
      risk_level: ["high", "critical"]
      operation_type: ["financial_transaction", "refund"]
      data_threshold:
        field: "amount"
        operator: ">"
        value: 1000
    action:
      auto_approve: false
      require_approval_count: 2  # éœ€è¦ 2 å€‹å¯©æ‰¹
      timeout_seconds: 3600      # 1 å°æ™‚
      escalation:
        enabled: true
        after_seconds: 1800      # 30 åˆ†é˜å¾Œå‡ç´š
        escalate_to: ["manager@example.com"]
      notification:
        channels: ["teams", "email"]
        recipients: ["finance-team@example.com"]
    
  # è¦å‰‡ 2: æ•¸æ“šåˆªé™¤æ“ä½œ
  - name: "æ•¸æ“šåˆªé™¤å®‰å…¨"
    priority: 2
    trigger:
      operation_type: ["delete", "drop_table", "truncate"]
      risk_level: ["high", "critical"]
    action:
      auto_approve: false
      timeout_seconds: 7200      # 2 å°æ™‚
      on_timeout: "cancel"       # ç„¡å¯©æ‰¹æ™‚å–æ¶ˆå·¥ä½œæµ
      notification:
        channels: ["teams"]
        recipients: ["admin@example.com"]
  
  # è¦å‰‡ 3: ä½ç½®ä¿¡åº¦ AI æ±ºç­–
  - name: "ä½ç½®ä¿¡åº¦æ±ºç­–"
    priority: 3
    trigger:
      agent_confidence:
        operator: "<"
        value: 0.75
    action:
      auto_approve: false
      timeout_seconds: 1800
      notification:
        channels: ["teams"]
  
  # è¦å‰‡ 4: è‡ªå‹•å¯©æ‰¹ä½é¢¨éšªæ“ä½œ
  - name: "è‡ªå‹•å¯©æ‰¹å®‰å…¨æ“ä½œ"
    priority: 10
    trigger:
      risk_level: ["low"]
      operation_type: ["read", "query", "search"]
    action:
      auto_approve: true
      log_decision: true         # ä»è¨˜éŒ„ä»¥ä¾›å¯©è¨ˆ
```

**å®Œæˆå®šç¾©**ï¼š
- [ ] ç”¨æˆ¶å¯ä»¥ YAML æ ¼å¼å‰µå»º/ç·¨è¼¯æª¢æŸ¥é»è¦å‰‡
- [ ] ç³»çµ±é©—è­‰ YAML èªæ³•ä¸¦é¡¯ç¤ºæ¸…æ™°çš„éŒ¯èª¤æ¶ˆæ¯
- [ ] æ‰€æœ‰è§¸ç™¼é¡å‹æ­£ç¢ºå·¥ä½œï¼ˆé¢¨éšªç­‰ç´šã€æ“ä½œé¡å‹ã€æ•¸æ“šé–¾å€¼ã€ç½®ä¿¡åº¦ï¼‰
- [ ] è‡ªå‹•å¯©æ‰¹è¦å‰‡æŒ‰é æœŸå·¥ä½œ
- [ ] è¶…æ™‚å’Œå‡ç´šè¡Œç‚ºæ­£ç¢ºå·¥ä½œ
- [ ] æ›´æ”¹åœ¨ 30 ç§’å…§ç”Ÿæ•ˆï¼ˆç†±é‡è¼‰ï¼‰
- [ ] å–®å…ƒæ¸¬è©¦è¦†è“‹æ‰€æœ‰è§¸ç™¼çµ„åˆ

**æŠ€è¡“å‚™è¨»**ï¼š
- å°‡ YAML å­˜å„²åœ¨ `workflows.trigger_config` JSONB å­—æ®µ
- ä½¿ç”¨ PyYAML é€²è¡Œè§£æ
- å¯¦ç¾å¸¶å„ªå…ˆç´šæ’åºçš„è¦å‰‡åŒ¹é…å¼•æ“
- åœ¨ Redis ä¸­ç·©å­˜è§£æçš„è¦å‰‡ä»¥æé«˜æ€§èƒ½

---

### **US-F2-002: å¯©æ‰¹æˆ–æ‹’çµ•æª¢æŸ¥é»ä¸¦æä¾›è±å¯Œä¸Šä¸‹æ–‡**

**å„ªå…ˆç´š**ï¼šP0ï¼ˆå¿…é ˆæœ‰ï¼‰  
**é ä¼°é–‹ç™¼æ™‚é–“**ï¼š4 å¤©  
**è¤‡é›œåº¦**ï¼šâ­â­â­â­

**ç”¨æˆ¶æ•…äº‹**ï¼š
- **ä½œç‚º** IT é‹ç¶­ç®¡ç†å“¡ï¼ˆAlex Chenï¼‰
- **æˆ‘æƒ³è¦** çœ‹åˆ°é—œæ–¼ AI æè­°åšä»€éº¼çš„å®Œæ•´ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬æ•¸æ“šã€æ¨ç†å’Œç½®ä¿¡åº¦åˆ†æ•¸
- **ä»¥ä¾¿** æˆ‘å¯ä»¥åšå‡ºæ˜æ™ºçš„æ±ºå®šä¾†æ‰¹å‡†æˆ–æ‹’çµ•è©²æ“ä½œ

**é©—æ”¶æ¨™æº–**ï¼š
1. âœ… **å¯¦æ™‚é€šçŸ¥**ï¼šç”¨æˆ¶åœ¨æª¢æŸ¥é»å‰µå»ºå¾Œ 5 ç§’å…§æ”¶åˆ° Teams é€šçŸ¥
2. âœ… **ä¸Šä¸‹æ–‡å±•ç¤º**ï¼šå¯©æ‰¹é é¢é¡¯ç¤ºï¼š
   - å·¥ä½œæµåç¨±å’ŒåŸ·è¡Œ ID
   - ç•¶å‰æ­¥é©Ÿæè¿°
   - AI æè­°çš„æ“ä½œï¼ˆçµæ§‹åŒ–é¡¯ç¤ºï¼‰
   - AI çš„æ¨ç†ï¼ˆç‚ºä»€éº¼é€™å€‹æ“ä½œï¼‰
   - ç½®ä¿¡åº¦åˆ†æ•¸ï¼ˆ0-100%ï¼‰
   - ç›¸é—œæ•¸æ“šï¼ˆå®¢æˆ¶ä¿¡æ¯ã€å·¥å–®è©³æƒ…ç­‰ï¼‰
   - é¢¨éšªè©•ä¼°ï¼ˆç‚ºä»€éº¼éœ€è¦å¯©æ‰¹ï¼‰
   - ä¹‹å‰çš„åŸ·è¡Œæ­·å²ï¼ˆå¦‚æœæœ‰ï¼‰
3. âœ… **æ‰¹å‡†æ“ä½œ**ï¼šç”¨æˆ¶é»æ“Š"æ‰¹å‡†"â†’ å·¥ä½œæµç«‹å³æ¢å¾©
4. âœ… **æ‹’çµ•æ“ä½œ**ï¼šç”¨æˆ¶é»æ“Š"æ‹’çµ•"â†’ å·¥ä½œæµçµ‚æ­¢ï¼Œç”¨æˆ¶è¼¸å…¥æ‹’çµ•åŸå› 
5. âœ… **å¾…è™•ç†åˆ—è¡¨**ï¼šç”¨æˆ¶çœ‹åˆ°æ‰€æœ‰å¾…å¯©æ‰¹çš„åˆ—è¡¨ï¼ˆå¯æŒ‰å„ªå…ˆç´šã€æ™‚é–“æ’åºï¼‰
6. âœ… **å¯©æ‰¹ SLA**ï¼šUI é¡¯ç¤ºè¶…æ™‚å‰å‰©é¤˜æ™‚é–“
7. âœ… **ç§»å‹•å‹å¥½**ï¼šå¯©æ‰¹é é¢åœ¨ç§»å‹•è¨­å‚™ä¸Šå·¥ä½œ
8. âœ… **å¯©è¨ˆè¿½è¹¤**ï¼šæ‰€æœ‰å¯©æ‰¹æ±ºå®šè¨˜éŒ„åˆ° `audit_logs` è¡¨

**å¯©æ‰¹é é¢ UI æ¨¡å‹**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æª¢æŸ¥é»å¯©æ‰¹ï¼šexec-20251118-abc123                          [è¿”å›]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·¥ä½œæµï¼šå®¢æœ - ç™¼é€é€€æ¬¾éƒµä»¶                                        â”‚
â”‚ ç‹€æ…‹ï¼šâ¸ï¸  ç­‰å¾…å¯©æ‰¹                                                 â”‚
â”‚ å‰©é¤˜æ™‚é–“ï¼šâ±ï¸  52 åˆ†é˜                                              â”‚
â”‚                                                                    â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ ğŸ¤– AI æè­°çš„æ“ä½œ                                             â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                    â”‚
â”‚ æ“ä½œï¼šç™¼é€éƒµä»¶                                                     â”‚
â”‚ ç½®ä¿¡åº¦ï¼š87% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘                                             â”‚
â”‚                                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ éƒµä»¶è©³æƒ…ï¼š                                                  â”‚   â”‚
â”‚ â”‚   æ”¶ä»¶äººï¼šjohn.doe@example.com                             â”‚   â”‚
â”‚ â”‚   ä¸»é¡Œï¼šé€€æ¬¾ç¢ºèª - è¨‚å–® #12345                             â”‚   â”‚
â”‚ â”‚   é‡‘é¡ï¼š$99.99                                              â”‚   â”‚
â”‚ â”‚   æ¨¡æ¿ï¼šrefund_confirmation_v2                              â”‚   â”‚
â”‚ â”‚                                                             â”‚   â”‚
â”‚ â”‚ é™„ä»¶ï¼š                                                      â”‚   â”‚
â”‚ â”‚   â€¢ refund_receipt.pdf (45KB)                              â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                    â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ ğŸ’­ AI æ¨ç†                                                   â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                    â”‚
â”‚ "æ ¹æ“šå·¥å–® CS-1234 åˆ†æï¼Œå®¢æˆ¶è«‹æ±‚å°æœ‰ç¼ºé™·çš„ç”¢å“ï¼ˆè¨‚å–® #12345ï¼‰     â”‚
â”‚  é€²è¡Œé€€æ¬¾ã€‚åœ¨ Dynamics 365 ä¸­ç¢ºèªäº†è³¼è²·è¨˜éŒ„ã€‚å®¢æˆ¶æœ‰ 3 å¹´çš„        â”‚
â”‚  æ­£é¢æ­·å²ï¼ˆ15 ç­†è¨‚å–®ï¼Œç„¡ä¹‹å‰çš„é€€æ¬¾ï¼‰ã€‚é€€æ¬¾é‡‘é¡èˆ‡è¨‚å–®ç¸½é¡åŒ¹é…ã€‚     â”‚
â”‚  éƒµä»¶æ¨¡æ¿å·²æ ¹æ“šå…¬å¸æ”¿ç­–é©—è­‰ã€‚"                                     â”‚
â”‚                                                                    â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ âš ï¸  é¢¨éšªè©•ä¼°                                                 â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                    â”‚
â”‚ é¢¨éšªç­‰ç´šï¼šHIGH                                                     â”‚
â”‚ åŸå› ï¼š                                                             â”‚
â”‚   â€¢ é‡‘èäº¤æ˜“ï¼ˆ>$50ï¼‰                                               â”‚
â”‚   â€¢ å¤–éƒ¨é€šä¿¡ï¼ˆéƒµä»¶ï¼‰                                               â”‚
â”‚   â€¢ ä¸å¯é€†æ“ä½œ                                                     â”‚
â”‚                                                                    â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ ğŸ“Š æ”¯æŒæ•¸æ“š                                                  â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                    â”‚
â”‚ å®¢æˆ¶ï¼šJohn Doe (CUST-5678)                                         â”‚
â”‚   â€¢ ç¸½è¨‚å–®ï¼š15 ($1,247.50)                                         â”‚
â”‚   â€¢ ä¹‹å‰çš„é€€æ¬¾ï¼š0                                                  â”‚
â”‚   â€¢ å¸³æˆ¶å¹´é½¡ï¼š3 å¹´                                                 â”‚
â”‚   â€¢ æ”¯æŒå·¥å–®ï¼š2ï¼ˆå‡å·²è§£æ±ºï¼‰                                        â”‚
â”‚                                                                    â”‚
â”‚ è¨‚å–® #12345ï¼š                                                      â”‚
â”‚   â€¢ æ—¥æœŸï¼š2025-11-10                                               â”‚
â”‚   â€¢ ç”¢å“ï¼šç„¡ç·šè€³æ©Ÿ                                                 â”‚
â”‚   â€¢ é‡‘é¡ï¼š$99.99                                                   â”‚
â”‚   â€¢ ç‹€æ…‹ï¼šå·²äº¤ä»˜ 2025-11-12                                        â”‚
â”‚                                                                    â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ ğŸ• åŸ·è¡Œæ­·å²                                                  â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                    â”‚
â”‚ âœ… æ­¥é©Ÿ 1ï¼šå·¥å–®åˆ†æå™¨ (2.3s)                                       â”‚
â”‚ âœ… æ­¥é©Ÿ 2ï¼šå®¢æˆ¶ 360 æŸ¥è©¢ (8.1s)                                    â”‚
â”‚ âœ… æ­¥é©Ÿ 3ï¼šé€€æ¬¾è¨ˆç®—å™¨ (1.5s)                                       â”‚
â”‚ âœ… æ­¥é©Ÿ 4ï¼šéƒµä»¶ç”Ÿæˆå™¨ (3.2s)                                       â”‚
â”‚ â¸ï¸  æ­¥é©Ÿ 5ï¼šç™¼é€éƒµä»¶ï¼ˆç­‰å¾…å¯©æ‰¹ï¼‰                                   â”‚
â”‚                                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ’¬ æ·»åŠ è©•è«–ï¼ˆå¯é¸ï¼‰                                         â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚ â”‚ â”‚ ä¾‹å¦‚ï¼š"å·²æ ¹æ“šå®¢æˆ¶æœå‹™æ”¿ç­–é©—è­‰"                        â”‚   â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                    â”‚
â”‚ [âœ… æ‰¹å‡†]  [âœï¸  ä¿®æ”¹åƒæ•¸]  [âŒ æ‹’çµ•]                                â”‚
â”‚                                                                    â”‚
â”‚ æ‚¨çš„æ‰¹å‡†å°‡ç«‹å³æ¢å¾©å·¥ä½œæµã€‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Œæˆå®šç¾©**ï¼š
- [ ] ç”¨æˆ¶åœ¨ 5 ç§’å…§æ”¶åˆ° Teams é€šçŸ¥
- [ ] å¯©æ‰¹é é¢é¡¯ç¤ºæ‰€æœ‰å¿…éœ€çš„ä¸Šä¸‹æ–‡ï¼ˆæ“ä½œã€æ¨ç†ã€ç½®ä¿¡åº¦ã€æ•¸æ“šã€é¢¨éšªï¼‰
- [ ] ç”¨æˆ¶å¯ä»¥æ‰¹å‡†ä¸¦æ·»åŠ å¯é¸è©•è«–
- [ ] ç”¨æˆ¶å¯ä»¥æ‹’çµ•ä¸¦æä¾›å¿…éœ€çš„åŸå› 
- [ ] æ‰¹å‡†å¾Œå·¥ä½œæµåœ¨ 2 ç§’å…§æ¢å¾©
- [ ] æ‰€æœ‰æ±ºå®šè¨˜éŒ„åˆ° audit_logs è¡¨
- [ ] UI åœ¨ç§»å‹•ç«¯å·¥ä½œï¼ˆéŸ¿æ‡‰å¼è¨­è¨ˆï¼‰

**æŠ€è¡“å‚™è¨»**ï¼š
- ä½¿ç”¨ **Shadcn UI** çµ„ä»¶ï¼ˆCardã€Badgeã€Buttonã€Textareaï¼‰
- åœ¨ `checkpoints` è¡¨ä¸­å­˜å„²æª¢æŸ¥é»ï¼Œç‹€æ…‹ç‚º "pending"
- é€šé Incoming Webhook ç™¼é€ Teams é€šçŸ¥
- ä½¿ç”¨è¼ªè©¢ï¼ˆ2-3ç§’ï¼‰åœ¨ UI ä¸­é€²è¡Œå¯¦æ™‚ç‹€æ…‹æ›´æ–°

---

### **US-F2-003: åœ¨å¯©æ‰¹å‰ä¿®æ”¹ AI åƒæ•¸**

**å„ªå…ˆç´š**ï¼šP0ï¼ˆå¿…é ˆæœ‰ï¼‰  
**é ä¼°é–‹ç™¼æ™‚é–“**ï¼š3 å¤©  
**è¤‡é›œåº¦**ï¼šâ­â­â­â­

**ç”¨æˆ¶æ•…äº‹**ï¼š
- **ä½œç‚º** å®¢æœåœ˜éšŠä¸»ç®¡ï¼ˆSarah Martinezï¼‰
- **æˆ‘æƒ³è¦** åœ¨æ‰¹å‡†å‰ä¿®æ”¹ AI æè­°çš„åƒæ•¸ï¼ˆä¾‹å¦‚æ›´æ”¹éƒµä»¶æ”¶ä»¶äººã€èª¿æ•´é€€æ¬¾é‡‘é¡ï¼‰
- **ä»¥ä¾¿** ç„¡éœ€æ‹’çµ•ä¸¦é‡æ–°å•Ÿå‹•æ•´å€‹å·¥ä½œæµå³å¯ç³¾æ­£ AI éŒ¯èª¤

**é©—æ”¶æ¨™æº–**ï¼š
1. âœ… **ä¿®æ”¹æŒ‰éˆ•**ï¼šç”¨æˆ¶åœ¨å¯©æ‰¹é é¢é»æ“Š"ä¿®æ”¹åƒæ•¸"
2. âœ… **å‹•æ…‹è¡¨å–®**ï¼šç³»çµ±æ ¹æ“šæ“ä½œé¡å‹ç”Ÿæˆå¯ç·¨è¼¯è¡¨å–®ï¼š
   - **ç™¼é€éƒµä»¶**ï¼šç·¨è¼¯æ”¶ä»¶äººã€ä¸»é¡Œã€æ­£æ–‡ã€é™„ä»¶
   - **é‡‘èäº¤æ˜“**ï¼šç·¨è¼¯é‡‘é¡ã€è²¨å¹£ã€å¸³æˆ¶
   - **æ•¸æ“šåº«æ›´æ–°**ï¼šç·¨è¼¯å­—æ®µå€¼
   - **API èª¿ç”¨**ï¼šç·¨è¼¯è«‹æ±‚åƒæ•¸
3. âœ… **JSON ç·¨è¼¯å™¨**ï¼šå°æ–¼è¤‡é›œåƒæ•¸ï¼Œé¡¯ç¤ºå¸¶èªæ³•é«˜äº®çš„ JSON ç·¨è¼¯å™¨ï¼ˆMonaco Editorï¼‰
4. âœ… **å­—æ®µé©—è­‰**ï¼šé©—è­‰ä¿®æ”¹çš„å€¼ï¼ˆä¾‹å¦‚éƒµä»¶æ ¼å¼ã€é‡‘é¡ > 0ï¼‰
5. âœ… **é è¦½æ›´æ”¹**ï¼šé¡¯ç¤ºåŸå§‹ vs ä¿®æ”¹åƒæ•¸çš„å·®ç•°
6. âœ… **ä¿å­˜ä¸¦æ‰¹å‡†**ï¼šç”¨æˆ¶æäº¤ä¿®æ”¹ â†’ å·¥ä½œæµä½¿ç”¨æ–°åƒæ•¸æ¢å¾©
7. âœ… **å­¸ç¿’æ•ç²**ï¼šç³»çµ±å°‡ä¿®æ”¹è¨˜éŒ„ç‚ºå­¸ç¿’æ¡ˆä¾‹ï¼ˆF5ï¼‰
8. âœ… **å¯©è¨ˆè¿½è¹¤**ï¼šå°‡åŸå§‹å’Œä¿®æ”¹çš„å€¼è¨˜éŒ„åˆ° audit_logs

**ä¿®æ”¹æ¨¡æ…‹æ¡† UI**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿®æ”¹åƒæ•¸                                                [é—œé–‰]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ ğŸ“ ç·¨è¼¯éƒµä»¶åƒæ•¸                                                 â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ æ”¶ä»¶äººï¼ˆéƒµä»¶åœ°å€ï¼‰*                                        â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚ â”‚ â”‚ john.doe@example.com                                  â”‚  â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚ â”‚                                                            â”‚â”‚
â”‚ â”‚ ä¸»é¡Œ *                                                     â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚ â”‚ â”‚ é€€æ¬¾ç¢ºèª - è¨‚å–® #12345                                â”‚  â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚ â”‚                                                            â”‚â”‚
â”‚ â”‚ é‡‘é¡ï¼ˆUSDï¼‰*                                               â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚ â”‚ â”‚ 99.99                                                  â”‚  â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚ â”‚                                                            â”‚â”‚
â”‚ â”‚ éƒµä»¶æ­£æ–‡                                                   â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚ â”‚ â”‚ å°Šæ•¬çš„ Johnï¼Œ                                         â”‚  â”‚â”‚
â”‚ â”‚ â”‚                                                       â”‚  â”‚â”‚
â”‚ â”‚ â”‚ æ‚¨è¨‚å–® #12345 çš„ $99.99 é€€æ¬¾å·²è™•ç†ã€‚è«‹å…è¨± 5-7 å€‹     â”‚  â”‚â”‚
â”‚ â”‚ â”‚ å·¥ä½œæ—¥...                                             â”‚  â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ é«˜ç´šï¼šJSON ç·¨è¼¯å™¨ï¼ˆå¯é¸ï¼‰                                â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ {                                                          â”‚â”‚
â”‚ â”‚   "to": "john.doe@example.com",                           â”‚â”‚
â”‚ â”‚   "subject": "é€€æ¬¾ç¢ºèª - è¨‚å–® #12345",                    â”‚â”‚
â”‚ â”‚   "amount": 99.99,                                         â”‚â”‚
â”‚ â”‚   "currency": "USD",                                       â”‚â”‚
â”‚ â”‚   "template": "refund_confirmation_v2",                   â”‚â”‚
â”‚ â”‚   "attachments": ["refund_receipt.pdf"]                   â”‚â”‚
â”‚ â”‚ }                                                          â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â”‚ âš ï¸  æ›´æ”¹å°‡ä¿å­˜ç‚ºå­¸ç¿’æ¡ˆä¾‹ä»¥æ”¹é€² AI                              â”‚
â”‚                                                                â”‚
â”‚ [é è¦½æ›´æ”¹]  [å–æ¶ˆ]  [ä¿å­˜ä¸¦æ‰¹å‡†]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åƒæ•¸å·®ç•°é è¦½**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯©æŸ¥æ›´æ”¹                                                [è¿”å›]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ ğŸ“ åƒæ•¸æ›´æ”¹                                                     â”‚
â”‚                                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ å­—æ®µï¼šamount                                               â”‚â”‚
â”‚ â”‚   åŸå§‹ï¼š99.99                                              â”‚â”‚
â”‚ â”‚   ä¿®æ”¹ï¼š89.99  (â†“ $10.00)                                 â”‚â”‚
â”‚ â”‚                                                            â”‚â”‚
â”‚ â”‚ å­—æ®µï¼šsubject                                              â”‚â”‚
â”‚ â”‚   åŸå§‹ï¼šé€€æ¬¾ç¢ºèª - è¨‚å–® #12345                            â”‚â”‚
â”‚ â”‚   ä¿®æ”¹ï¼šç·Šæ€¥ï¼šé€€æ¬¾ç¢ºèª - è¨‚å–® #12345                      â”‚â”‚
â”‚ â”‚         (â†‘ æ·»åŠ äº† "ç·Šæ€¥ï¼š")                                â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â”‚ âœ… æ‰€æœ‰æ›´æ”¹å·²æˆåŠŸé©—è­‰                                          â”‚
â”‚                                                                â”‚
â”‚ ğŸ’¡ é€™äº›æ›´æ”¹å°‡è¢«è¨˜éŒ„ç‚ºå­¸ç¿’æ¡ˆä¾‹ï¼Œä»¥å¹«åŠ© AI åœ¨æœªä¾†åšå‡ºæ›´å¥½çš„å»ºè­°ã€‚â”‚
â”‚                                                                â”‚
â”‚ [è¿”å›]  [ç¢ºèªä¸¦æ‰¹å‡†]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Œæˆå®šç¾©**ï¼š
- [ ] ç”¨æˆ¶å¯ä»¥é»æ“Š"ä¿®æ”¹åƒæ•¸"æŒ‰éˆ•
- [ ] ç³»çµ±æ ¹æ“šæ“ä½œé¡å‹ç”Ÿæˆå‹•æ…‹è¡¨å–®
- [ ] ç”¨æˆ¶å¯ä»¥åœ¨è¡¨å–®æˆ– JSON ç·¨è¼¯å™¨ä¸­ç·¨è¼¯åƒæ•¸
- [ ] ç³»çµ±é©—è­‰ä¿®æ”¹çš„å€¼ï¼ˆé¡å‹ã€æ ¼å¼ã€ç´„æŸï¼‰
- [ ] ç”¨æˆ¶å¯ä»¥é è¦½æ›´æ”¹ï¼ˆåŸå§‹ vs ä¿®æ”¹ï¼‰
- [ ] æ‰¹å‡†æ™‚å°‡ä¿®æ”¹çš„åƒæ•¸å‚³éçµ¦ agent
- [ ] ä¿®æ”¹è¨˜éŒ„ç‚ºæ•¸æ“šåº«ä¸­çš„å­¸ç¿’æ¡ˆä¾‹
- [ ] å¯©è¨ˆæ—¥èªŒé¡¯ç¤ºåŸå§‹å’Œä¿®æ”¹çš„å€¼

**æŠ€è¡“å‚™è¨»**ï¼š
- ä½¿ç”¨ **Shadcn UI Form** çµ„ä»¶é…åˆ **React Hook Form** é€²è¡Œé©—è­‰
- ä½¿ç”¨ **Monaco Editor** é€²è¡Œ JSON ç·¨è¼¯ï¼ˆèˆ‡ VS Code ç›¸åŒï¼‰
- ç‚ºè¤‡é›œåƒæ•¸å¯¦ç¾ JSON Schema é©—è­‰
- å°‡ä¿®æ”¹å­˜å„²åœ¨ `learning_cases` è¡¨ï¼ˆF5ï¼‰

---

### **US-F2-004: é…ç½®è‡ªå‹•å¯©æ‰¹è¦å‰‡**

**å„ªå…ˆç´š**ï¼šP1ï¼ˆæ‡‰è©²æœ‰ï¼‰  
**é ä¼°é–‹ç™¼æ™‚é–“**ï¼š2 å¤©  
**è¤‡é›œåº¦**ï¼šâ­â­â­

**ç”¨æˆ¶æ•…äº‹**ï¼š
- **ä½œç‚º** ç³»çµ±ç®¡ç†å“¡ï¼ˆMichael Wongï¼‰
- **æˆ‘æƒ³è¦** ç‚ºç¬¦åˆç‰¹å®šæ¢ä»¶çš„ä½é¢¨éšªæ“ä½œé…ç½®è‡ªå‹•å¯©æ‰¹
- **ä»¥ä¾¿** åœ¨ä¿æŒå®‰å…¨æ§åˆ¶çš„åŒæ™‚æ¸›å°‘æ‰‹å‹•å¯©æ‰¹é–‹éŠ·

**é©—æ”¶æ¨™æº–**ï¼š
1. âœ… **è‡ªå‹•å¯©æ‰¹é…ç½®**ï¼šç®¡ç†å“¡å¯ä»¥ç‚ºæ¯å€‹è¦å‰‡å•Ÿç”¨/ç¦ç”¨è‡ªå‹•å¯©æ‰¹
2. âœ… **åŸºæ–¼æ¢ä»¶**ï¼šæ”¯æŒè¤‡é›œæ¢ä»¶ï¼ˆä¾‹å¦‚"å¦‚æœ risk=low ä¸” confidence>0.9 ä¸” amount<$50 å‰‡è‡ªå‹•å¯©æ‰¹"ï¼‰
3. âœ… **åŸºæ–¼æ™‚é–“**ï¼šåƒ…åœ¨å·¥ä½œæ™‚é–“è‡ªå‹•å¯©æ‰¹ï¼ˆå¯é¸ï¼‰
4. âœ… **æ¼¸é€²æ¨å‡º**ï¼šå¾ 0% è‡ªå‹•å¯©æ‰¹é–‹å§‹ï¼Œéš¨æ™‚é–“å¢åŠ åˆ°ç›®æ¨™ç™¾åˆ†æ¯”
5. âœ… **è¦†è“‹**ï¼šæ‰‹å‹•å¯©æ‰¹å§‹çµ‚å„ªå…ˆæ–¼è‡ªå‹•å¯©æ‰¹
6. âœ… **å¯©è¨ˆè¿½è¹¤**ï¼šæ‰€æœ‰è‡ªå‹•å¯©æ‰¹éƒ½è¨˜éŒ„æ±ºç­–æ¨ç†
7. âœ… **ç›£æ§**ï¼šå„€è¡¨æ¿é¡¯ç¤ºè‡ªå‹•å¯©æ‰¹ç‡å’Œæº–ç¢ºæ€§
8. âœ… **ç·Šæ€¥åœæ­¢**ï¼šç®¡ç†å“¡å¯ä»¥ä¸€éµç¦ç”¨æ‰€æœ‰è‡ªå‹•å¯©æ‰¹

**è‡ªå‹•å¯©æ‰¹é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# è‡ªå‹•å¯©æ‰¹è¦å‰‡
auto_approval:
  enabled: true
  global_settings:
    business_hours_only: true
    business_hours:
      timezone: "Asia/Shanghai"
      monday_friday: "09:00-17:00"
      saturday_sunday: "disabled"
    emergency_stop: false  # ç®¡ç†å“¡å¯ä»¥è¨­ç½®ç‚º true ä»¥ç¦ç”¨æ‰€æœ‰
  
  rules:
    # è¦å‰‡ 1ï¼šä½é¢¨éšªè®€å–æ“ä½œ
    - name: "è‡ªå‹•å¯©æ‰¹å®‰å…¨è®€å–"
      enabled: true
      conditions:
        risk_level: "low"
        operation_type: ["read", "query", "search"]
        confidence: ">= 0.8"
      action:
        auto_approve: true
        log_decision: true
        notify: false  # ä¸ç™¼é€é€šçŸ¥
    
    # è¦å‰‡ 2ï¼šå°é¡é‡‘èäº¤æ˜“
    - name: "è‡ªå‹•å¯©æ‰¹å°é¡é€€æ¬¾"
      enabled: true
      conditions:
        risk_level: ["low", "medium"]
        operation_type: "financial_transaction"
        data_threshold:
          field: "amount"
          operator: "<="
          value: 50
        confidence: ">= 0.9"
      action:
        auto_approve: true
        log_decision: true
        notify: true  # è‡ªå‹•å¯©æ‰¹å¾Œç™¼é€é€šçŸ¥
        notification_channels: ["teams"]
    
    # è¦å‰‡ 3ï¼šéƒµä»¶æ“ä½œçš„æ¼¸é€²æ¨å‡º
    - name: "æ¼¸é€²è‡ªå‹•å¯©æ‰¹éƒµä»¶"
      enabled: true
      conditions:
        operation_type: "send_email"
        risk_level: "low"
        confidence: ">= 0.85"
      action:
        auto_approve: true
        rollout_percentage: 25  # è‡ªå‹•å¯©æ‰¹ 25% çš„ç¬¦åˆæ¢ä»¶æ“ä½œ
        log_decision: true
```

**è‡ªå‹•å¯©æ‰¹é€šçŸ¥ç¤ºä¾‹**ï¼š
```
ğŸ¤– è‡ªå‹•å¯©æ‰¹çš„æª¢æŸ¥é»
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å·¥ä½œæµï¼šå®¢æœ - ç™¼é€é€€æ¬¾éƒµä»¶
åŸ·è¡Œï¼šexec-20251118-xyz789

âœ… å·²è‡ªå‹•å¯©æ‰¹ï¼ˆç„¡éœ€æ‰‹å‹•æ“ä½œï¼‰

åŸå› ï¼šåŒ¹é…è‡ªå‹•å¯©æ‰¹è¦å‰‡ "è‡ªå‹•å¯©æ‰¹å°é¡é€€æ¬¾"
  â€¢ é¢¨éšªç­‰ç´šï¼šLOW âœ“
  â€¢ æ“ä½œï¼šfinancial_transaction âœ“
  â€¢ é‡‘é¡ï¼š$35.00 âœ“ (< $50)
  â€¢ ç½®ä¿¡åº¦ï¼š92% âœ“ (>= 90%)

å·²åŸ·è¡Œçš„æ“ä½œï¼šå‘å®¢æˆ¶ç™¼é€é€€æ¬¾ç¢ºèªéƒµä»¶

[æŸ¥çœ‹è©³æƒ…] [ç¦ç”¨è‡ªå‹•å¯©æ‰¹]
```

**å®Œæˆå®šç¾©**ï¼š
- [ ] ç®¡ç†å“¡å¯ä»¥é€šé YAML é…ç½®è‡ªå‹•å¯©æ‰¹è¦å‰‡
- [ ] ç³»çµ±æ­£ç¢ºè©•ä¼°æ¢ä»¶ï¼ˆé¢¨éšªã€ç½®ä¿¡åº¦ã€é–¾å€¼ï¼‰
- [ ] è‡ªå‹•å¯©æ‰¹éµå®ˆå·¥ä½œæ™‚é–“ï¼ˆå¦‚æœé…ç½®ï¼‰
- [ ] æ‰€æœ‰è‡ªå‹•å¯©æ‰¹è¨˜éŒ„åˆ° audit_logs ä¸¦é™„å¸¶æ¨ç†
- [ ] å„€è¡¨æ¿é¡¯ç¤ºè‡ªå‹•å¯©æ‰¹ç‡å’ŒéŒ¯èª¤
- [ ] ç®¡ç†å“¡å¯ä»¥ç·Šæ€¥åœæ­¢æ‰€æœ‰è‡ªå‹•å¯©æ‰¹

**æŠ€è¡“å‚™è¨»**ï¼š
- åœ¨å‰µå»ºæª¢æŸ¥é»å‰è©•ä¼°è‡ªå‹•å¯©æ‰¹è¦å‰‡
- å°‡è‡ªå‹•å¯©æ‰¹æ±ºå®šå­˜å„²åœ¨ `checkpoints.metadata` JSONB
- å¯¦ç¾æ¼¸é€²æ¨å‡ºçš„ A/B æ¸¬è©¦æ¡†æ¶

---

## 2.3 æŠ€è¡“å¯¦ç¾ï¼ˆè©³ç´°ï¼‰

### 2.3.1 StateManager é¡ï¼ˆå®Œæ•´ï¼‰

```python
from typing import Dict, Any, Optional, List
from datetime import datetime, timedelta
from enum import Enum
import json
import asyncio

class CheckpointStatus(str, Enum):
    """æª¢æŸ¥é»å¯©æ‰¹ç‹€æ…‹"""
    PENDING = "pending"
    APPROVED = "approved"
    REJECTED = "rejected"
    TIMEOUT = "timeout"
    AUTO_APPROVED = "auto_approved"

class StateManager:
    """
    ç®¡ç†å·¥ä½œæµæª¢æŸ¥é»å’Œå¯©æ‰¹
    """
    
    def __init__(self, db_session, notification_service, learning_service):
        self.db = db_session
        self.notification_service = notification_service
        self.learning_service = learning_service
    
    async def save_checkpoint(
        self,
        execution_id: str,
        step: int,
        state: Dict[str, Any],
        proposed_action: Dict[str, Any],
        reasoning: str,
        confidence: float,
        risk_level: str,
        timeout_seconds: int = 3600
    ) -> str:
        """
        ä¿å­˜å·¥ä½œæµæª¢æŸ¥é»ä¸¦æš«åœåŸ·è¡Œ
        
        Args:
            execution_id: åŸ·è¡Œ UUID
            step: ç•¶å‰å·¥ä½œæµæ­¥é©Ÿï¼ˆå¾ 0 é–‹å§‹ï¼‰
            state: å®Œæ•´çš„å·¥ä½œæµä¸Šä¸‹æ–‡/ç‹€æ…‹
            proposed_action: AI æè­°çš„æ“ä½œè©³æƒ…
            reasoning: AI å°æ­¤æ“ä½œçš„æ¨ç†
            confidence: AI ç½®ä¿¡åº¦åˆ†æ•¸ï¼ˆ0.0-1.0ï¼‰
            risk_level: é¢¨éšªè©•ä¼°ï¼ˆ"low", "medium", "high", "critical"ï¼‰
            timeout_seconds: å¯©æ‰¹è¶…æ™‚ï¼ˆé»˜èª 1 å°æ™‚ï¼‰
            
        Returns:
            checkpoint_id: å‰µå»ºçš„æª¢æŸ¥é» UUID
        """
        # 1. å‰µå»ºæª¢æŸ¥é»è¨˜éŒ„
        checkpoint_id = f"chkpt-{datetime.utcnow().strftime('%Y%m%d')}-{uuid4().hex[:8]}"
        timeout_at = datetime.utcnow() + timedelta(seconds=timeout_seconds)
        
        checkpoint_data = {
            "id": checkpoint_id,
            "execution_id": execution_id,
            "step": step,
            "state": state,
            "proposed_action": proposed_action,
            "reasoning": reasoning,
            "confidence": confidence,
            "risk_level": risk_level,
            "status": CheckpointStatus.PENDING,
            "timeout_at": timeout_at.isoformat(),
            "created_at": datetime.utcnow().isoformat(),
            "metadata": {
                "original_action": proposed_action.copy(),  # ä¿ç•™åŸå§‹
                "notification_sent": False
            }
        }
        
        # 2. æ’å…¥åˆ°æ•¸æ“šåº«
        await self.db.execute(
            """
            INSERT INTO checkpoints (
                id, execution_id, step, state, status, 
                approved_by, approved_at, feedback, created_at
            ) VALUES (
                :id, :execution_id, :step, :state, :status,
                NULL, NULL, NULL, :created_at
            )
            """,
            {
                "id": checkpoint_id,
                "execution_id": execution_id,
                "step": step,
                "state": json.dumps(checkpoint_data),
                "status": CheckpointStatus.PENDING.value,
                "created_at": checkpoint_data["created_at"]
            }
        )
        await self.db.commit()
        
        # 3. æ›´æ–°åŸ·è¡Œç‹€æ…‹ç‚º 'paused'
        await self.db.execute(
            """
            UPDATE executions
            SET status = 'paused', updated_at = :updated_at
            WHERE id = :execution_id
            """,
            {
                "execution_id": execution_id,
                "updated_at": datetime.utcnow().isoformat()
            }
        )
        await self.db.commit()
        
        # 4. ç™¼é€ Teams é€šçŸ¥
        await self.notification_service.send_checkpoint_notification(
            checkpoint_id=checkpoint_id,
            execution_id=execution_id,
            proposed_action=proposed_action,
            reasoning=reasoning,
            confidence=confidence,
            risk_level=risk_level,
            timeout_at=timeout_at
        )
        
        # 5. å•Ÿå‹•è¶…æ™‚ç›£æ§ï¼ˆç•°æ­¥ä»»å‹™ï¼‰
        asyncio.create_task(
            self._monitor_checkpoint_timeout(checkpoint_id, timeout_seconds)
        )
        
        logger.info(
            f"æª¢æŸ¥é» {checkpoint_id} å·²ç‚ºåŸ·è¡Œ {execution_id} å‰µå»º "
            f"ï¼ˆæ­¥é©Ÿ {step}ï¼Œè¶…æ™‚ï¼š{timeout_seconds}ç§’ï¼‰"
        )
        
        return checkpoint_id
    
    async def approve_checkpoint(
        self,
        checkpoint_id: str,
        approved_by: str,
        modified_params: Optional[Dict[str, Any]] = None,
        feedback: Optional[str] = None
    ) -> bool:
        """
        æ‰¹å‡†æª¢æŸ¥é»ä¸¦æ¢å¾©å·¥ä½œæµ
        
        Args:
            checkpoint_id: æª¢æŸ¥é» UUID
            approved_by: æ‰¹å‡†çš„ç”¨æˆ¶ ID
            modified_params: ä¿®æ”¹çš„åƒæ•¸ï¼ˆå¦‚æœæœ‰ï¼‰
            feedback: å¯é¸çš„æ‰¹å‡†è©•è«–
            
        Returns:
            æˆåŠŸè¿”å› Trueï¼Œæª¢æŸ¥é»éæœŸ/ç„¡æ•ˆè¿”å› False
        """
        # 1. è¼‰å…¥æª¢æŸ¥é»
        checkpoint = await self.load_checkpoint(checkpoint_id)
        if not checkpoint:
            raise ValueError(f"æª¢æŸ¥é» {checkpoint_id} æœªæ‰¾åˆ°")
        
        # 2. é©—è­‰ç‹€æ…‹
        if checkpoint["status"] != CheckpointStatus.PENDING.value:
            logger.warning(
                f"ç„¡æ³•æ‰¹å‡†æª¢æŸ¥é» {checkpoint_id}ï¼šç‹€æ…‹ç‚º {checkpoint['status']}"
            )
            return False
        
        # 3. æª¢æŸ¥æ˜¯å¦è¶…æ™‚
        timeout_at = datetime.fromisoformat(checkpoint["timeout_at"])
        if datetime.utcnow() > timeout_at:
            await self._handle_checkpoint_timeout(checkpoint_id)
            return False
        
        # 4. æ›´æ–°æª¢æŸ¥é»ç‹€æ…‹
        await self.db.execute(
            """
            UPDATE checkpoints
            SET status = 'approved',
                approved_by = :approved_by,
                approved_at = :approved_at,
                feedback = :feedback,
                state = :state
            WHERE id = :checkpoint_id
            """,
            {
                "checkpoint_id": checkpoint_id,
                "approved_by": approved_by,
                "approved_at": datetime.utcnow().isoformat(),
                "feedback": feedback,
                "state": json.dumps({
                    **checkpoint,
                    "modified_params": modified_params,
                    "status": CheckpointStatus.APPROVED.value
                })
            }
        )
        await self.db.commit()
        
        # 5. å¦‚æœåƒæ•¸è¢«ä¿®æ”¹ï¼Œè¨˜éŒ„å­¸ç¿’æ¡ˆä¾‹
        if modified_params:
            await self.learning_service.record_learning_case(
                execution_id=checkpoint["execution_id"],
                scenario=checkpoint["proposed_action"].get("operation_type"),
                original_action=checkpoint["proposed_action"],
                human_modified_action=modified_params,
                feedback=feedback
            )
            
            logger.info(
                f"ç‚ºæª¢æŸ¥é» {checkpoint_id} è¨˜éŒ„å­¸ç¿’æ¡ˆä¾‹ï¼šç”¨æˆ¶ä¿®æ”¹äº†åƒæ•¸"
            )
        
        # 6. æ›´æ–°åŸ·è¡Œç‹€æ…‹ç‚º 'running'
        await self.db.execute(
            """
            UPDATE executions
            SET status = 'running', updated_at = :updated_at
            WHERE id = :execution_id
            """,
            {
                "execution_id": checkpoint["execution_id"],
                "updated_at": datetime.utcnow().isoformat()
            }
        )
        await self.db.commit()
        
        # 7. æ¢å¾©å·¥ä½œæµåŸ·è¡Œ
        await self._resume_workflow(
            checkpoint["execution_id"],
            modified_params or checkpoint["proposed_action"]
        )
        
        logger.info(
            f"æª¢æŸ¥é» {checkpoint_id} å·²ç”± {approved_by} æ‰¹å‡†ã€‚"
            f"å·¥ä½œæµ {checkpoint['execution_id']} å·²æ¢å¾©ã€‚"
        )
        
        return True
```

---

## 2.4 æ•¸æ“šåº«æ¶æ§‹ï¼ˆè©³ç´°ï¼‰

**æª¢æŸ¥é»è¡¨**ï¼š
```sql
CREATE TABLE checkpoints (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    execution_id UUID NOT NULL REFERENCES executions(id) ON DELETE CASCADE,
    step INT NOT NULL,                       -- å·¥ä½œæµæ­¥é©Ÿç·¨è™Ÿ
    state JSONB NOT NULL,                    -- å®Œæ•´çš„æª¢æŸ¥é»ç‹€æ…‹
    status VARCHAR(20) NOT NULL CHECK (      -- å¯©æ‰¹ç‹€æ…‹
        status IN ('pending', 'approved', 'rejected', 'timeout', 'auto_approved')
    ),
    approved_by VARCHAR(100),                -- æ‰¹å‡†/æ‹’çµ•çš„ç”¨æˆ¶ ID
    approved_at TIMESTAMP WITH TIME ZONE,    -- å¯©æ‰¹æ™‚é–“æˆ³
    feedback TEXT,                           -- å¯©æ‰¹/æ‹’çµ•è©•è«–
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

-- ç´¢å¼•
CREATE INDEX idx_checkpoints_execution_id ON checkpoints(execution_id);
CREATE INDEX idx_checkpoints_status ON checkpoints(status);
CREATE INDEX idx_checkpoints_created_at ON checkpoints(created_at DESC);
CREATE INDEX idx_checkpoints_state_gin ON checkpoints USING GIN (state);
```

---

## 2.5 éåŠŸèƒ½éœ€æ±‚ï¼ˆNFRï¼‰

| **é¡åˆ¥** | **éœ€æ±‚** | **ç›®æ¨™** | **æ¸¬é‡æ–¹å¼** |
|---------|---------|---------|-------------|
| **æ€§èƒ½** | æª¢æŸ¥é»ä¿å­˜æ™‚é–“ | < 500ms | æ•¸æ“šåº«æ—¥èªŒ |
| | å·¥ä½œæµæ¢å¾©æ™‚é–“ | æ‰¹å‡†å¾Œ < 2 ç§’ | ç«¯åˆ°ç«¯è¨ˆæ™‚ |
| | Teams é€šçŸ¥äº¤ä»˜ | < 5 ç§’ | Webhook å»¶é² |
| | å¯©æ‰¹é é¢åŠ è¼‰æ™‚é–“ | < 1 ç§’ | å‰ç«¯ APM |
| **å¯æ“´å±•æ€§** | ä¸¦ç™¼å¾…è™•ç†æª¢æŸ¥é» | 100+ åŒæ™‚å­˜åœ¨ | è² è¼‰æ¸¬è©¦ |
| | å¯©æ‰¹ååé‡ | 50+ å¯©æ‰¹/åˆ†é˜ | å£“åŠ›æ¸¬è©¦ |
| **å¯é æ€§** | æª¢æŸ¥é»æŒä¹…æ€§ | 99.99%ï¼ˆç„¡æ•¸æ“šä¸Ÿå¤±ï¼‰| æ•¸æ“šåº«å‚™ä»½ |
| | è¶…æ™‚è™•ç†æº–ç¢ºæ€§ | 100%ï¼ˆæ•ç²æ‰€æœ‰è¶…æ™‚ï¼‰| é›†æˆæ¸¬è©¦ |
| | æ¢å¾©æˆåŠŸç‡ | æ‰¹å‡†å¾Œ 99.5% | éŒ¯èª¤ç›£æ§ |
| **å®‰å…¨æ€§** | å¯©æ‰¹æˆæ¬Š | åŸºæ–¼è§’è‰²ï¼ˆåƒ…æˆæ¬Šç”¨æˆ¶ï¼‰| å–®å…ƒæ¸¬è©¦ |
| | å¯©è¨ˆè¿½è¹¤å®Œæ•´æ€§ | 100% æ±ºå®šå·²è¨˜éŒ„ | æ•¸æ“šåº«å¯©è¨ˆ |
| | åƒæ•¸é©—è­‰ | 100%ï¼ˆé˜²æ­¢æ³¨å…¥ï¼‰| å®‰å…¨æ¸¬è©¦ |

---

## 2.6 æ¸¬è©¦ç­–ç•¥

**å–®å…ƒæ¸¬è©¦**ï¼š
```python
@pytest.mark.asyncio
async def test_save_checkpoint():
    """æ¸¬è©¦æª¢æŸ¥é»å‰µå»ºå’Œé€šçŸ¥"""
    state_manager = StateManager(
        db_session=AsyncMock(),
        notification_service=AsyncMock(),
        learning_service=AsyncMock()
    )
    
    checkpoint_id = await state_manager.save_checkpoint(
        execution_id="exec-test",
        step=2,
        state={"key": "value"},
        proposed_action={"operation": "test"},
        reasoning="æ¸¬è©¦æ¨ç†",
        confidence=0.9,
        risk_level="high",
        timeout_seconds=3600
    )
    
    assert checkpoint_id.startswith("chkpt-")
    state_manager.notification_service.send_checkpoint_notification.assert_called_once()

@pytest.mark.asyncio
async def test_approve_checkpoint_with_modifications():
    """æ¸¬è©¦å¸¶åƒæ•¸ä¿®æ”¹çš„æª¢æŸ¥é»å¯©æ‰¹"""
    state_manager = StateManager(...)
    
    success = await state_manager.approve_checkpoint(
        checkpoint_id="chkpt-test",
        approved_by="user-test",
        modified_params={"amount": 89.99},
        feedback="é™ä½é‡‘é¡"
    )
    
    assert success is True
    state_manager.learning_service.record_learning_case.assert_called_once()
```

---

## 2.7 é¢¨éšªèˆ‡ç·©è§£

| **é¢¨éšª** | **æ¦‚ç‡** | **å½±éŸ¿** | **ç·©è§£æªæ–½** |
|---------|---------|---------|------------|
| å¯©æ‰¹è¶…æ™‚æœªè™•ç† | ä½ | é—œéµ | å…¨é¢çš„è¶…æ™‚ç›£æ§ã€å‘Šè­¦ |
| åƒæ•¸ä¿®æ”¹ç ´å£å·¥ä½œæµ | ä¸­ | é«˜ | JSON Schema é©—è­‰ã€æ‡‰ç”¨å‰é è¦½ |
| Teams é€šçŸ¥äº¤ä»˜å¤±æ•— | ä½ | ä¸­ | é‡è©¦é‚è¼¯ï¼ˆ3 æ¬¡å˜—è©¦ï¼‰ã€éƒµä»¶å‚™ç”¨ |
| å¯©æ‰¹æœŸé–“æ•¸æ“šåº«é€£æ¥ä¸Ÿå¤± | ä½ | é«˜ | äº‹å‹™ç®¡ç†ã€è‡ªå‹•é‡é€£ |
| ç«¶æ…‹æ¢ä»¶ï¼ˆé‡è¤‡å¯©æ‰¹ï¼‰| ä½ | ä¸­ | æ•¸æ“šåº«å”¯ä¸€ç´„æŸã€æ¨‚è§€é–å®š |

---

## 2.8 æœªä¾†å¢å¼·ï¼ˆPost-MVPï¼‰

1. **å¤šå¯©æ‰¹äººæ”¯æŒ**ï¼šåœ¨ç¹¼çºŒå‰éœ€è¦ N å€‹å¯©æ‰¹ï¼ˆä¾‹å¦‚ 3 å€‹å¯©æ‰¹äººä¸­çš„ 2 å€‹ï¼‰
2. **å¯©æ‰¹å·¥ä½œæµ**ï¼šé€šéå‡ç´šéˆè·¯ç”±å¯©æ‰¹ï¼ˆL1 â†’ L2 â†’ ç¶“ç†ï¼‰
3. **æ¢ä»¶æª¢æŸ¥é»**ï¼šåŸºæ–¼é‹è¡Œæ™‚æ¢ä»¶å‹•æ…‹å‰µå»ºæª¢æŸ¥é»
4. **æ‰¹é‡å¯©æ‰¹**ï¼šä¸€æ¬¡æ‰¹å‡†å¤šå€‹ç›¸ä¼¼çš„æª¢æŸ¥é»
5. **ç§»å‹•æ‡‰ç”¨**ï¼šç”¨æ–¼æ›´å¿«å¯©æ‰¹çš„åŸç”Ÿç§»å‹•æ‡‰ç”¨
6. **èªéŸ³å¯©æ‰¹**ï¼šé€šéèªéŸ³å‘½ä»¤å¯©æ‰¹ï¼ˆAlexaã€Google Assistantï¼‰
7. **æ™ºèƒ½è·¯ç”±**ï¼šåŸºæ–¼å°ˆæ¥­çŸ¥è­˜çš„ ML è·¯ç”±åˆ°æœ€ä½³å¯©æ‰¹äºº

---

**ç‹€æ…‹**ï¼šâœ… å®Œæ•´è¦æ ¼å·²å®Œæˆï¼ˆ1400+ è¡Œï¼‰
