# 模組 06: Chat/對話介面

**Semantic Kernel Agentic Framework - User Stories**

**模組**: Module 06
**User Stories**: US 6.1-6.6
**版本**: 2.0.0
**日期**: 2025-10-28

[返回總覽](../user-stories.md)

---

### 📦 模組 6: Chat/對話介面 ⭐ 多模態增強

#### Epic 6: 多模態對話體驗

**目標**: 提供豐富的多模態對話介面，支援文字、圖片、圖表、代碼

---

#### US 6.1 - 文字對話（基礎）

**作為** 業務用戶
**我想要** 通過文字與 Agent 對話
**以便** 完成我的任務

**驗收標準**:

✅ 必須項（輸入功能）:
- [ ] 文字輸入框（支援多行，自動調整高度）
- [ ] Enter 發送（Shift+Enter 換行）
- [ ] 發送按鈕
- [ ] 輸入字數統計（剩餘字數提示）
- [ ] 輸入字數限制（2000 字）

✅ 必須項（Streaming 顯示）:
- [ ] 逐字顯示 Agent 回應（打字機效果）
- [ ] Streaming 速度自然（不太快不太慢）
- [ ] 支援中斷 Streaming（停止生成按鈕）
- [ ] Streaming 過程中可滾動查看
- [ ] Streaming 完成後自動捲動到底部

✅ 必須項（Markdown 支援）:
- [ ] 粗體、斜體、刪除線
- [ ] 標題（H1-H6）
- [ ] 列表（有序、無序）
- [ ] 連結（可點擊）
- [ ] 引用塊
- [ ] 表格

✅ 必須項（對話管理）:
- [ ] 對話歷史自動保存
- [ ] 會話列表（可切換不同對話）
- [ ] 新建對話
- [ ] 重命名對話
- [ ] 刪除對話（軟刪除）
- [ ] 匯出對話（Markdown/PDF）

✅ 必須項（上下文管理）:
- [ ] 多輪對話上下文保持
- [ ] 上下文 Token 數量顯示
- [ ] 上下文過長時自動截斷（保留最近 N 輪）
- [ ] 支援手動清除上下文（重新開始）

**UI 設計要求**:
- 類似 ChatGPT/Claude 的對話介面
- 用戶訊息右對齊（藍色氣泡）
- Agent 訊息左對齊（灰色氣泡）
- 清晰的時間戳記

**📊 優先級**: P0 (MVP 必須)
**🎯 UX 目標**: 對話延遲 <500ms 感知
**🔗 相關**: US 6.2-6.6 (多模態功能)

---

#### US 6.2 - 圖片展示與上傳 ⭐ 多模態

**作為** 業務用戶
**我想要** 在對話中看到圖片和上傳圖片
**以便** 更豐富的互動體驗

**驗收標準**:

✅ 必須項（圖片顯示）:
- [ ] Agent 回應中的圖片自動內嵌展示
- [ ] 圖片點擊放大預覽（Lightbox）
- [ ] 支援格式: PNG, JPG, JPEG, GIF, SVG
- [ ] 圖片載入失敗顯示佔位符（錯誤訊息）
- [ ] 圖片 Lazy Loading（滾動時才載入）
- [ ] 圖片 Alt 文字（無障礙支援）

✅ 必須項（圖片上傳）:
- [ ] 點擊上傳按鈕選擇圖片
- [ ] 拖拽上傳支援（Drag & Drop）
- [ ] 圖片預覽（上傳前）
- [ ] 上傳進度顯示
- [ ] 圖片大小限制: 10MB
- [ ] 支援批量上傳（最多 5 張）
- [ ] 圖片壓縮（自動縮小過大圖片）

✅ 必須項（圖片功能）:
- [ ] 圖片下載按鈕
- [ ] 複製圖片到剪貼簿
- [ ] 圖片分享（生成分享連結）

**應用場景**:
- 上傳數據圖表讓 Agent 分析
- Agent 返回視覺化分析結果
- 上傳產品圖片進行辨識（Phase 2: Vision 支援）
- 上傳錯誤截圖請求協助

**技術要求**:
- Azure Blob Storage（圖片存儲）
- Image Compression Library（壓縮）
- Lightbox Library（預覽）

**📊 優先級**: P0 (MVP 必須)
**🎯 UX 目標**: 圖片上傳 <3 秒（5MB 圖片）
**🔗 相關**: US 6.3 (圖表), US 3.2 (Code Interpreter 圖片)

---

#### US 6.3 - 圖表互動展示（來自 Code Interpreter）⭐ 核心價值

**作為** 業務用戶
**我想要** 在對話中看到互動式圖表
**以便** 深入探索數據分析結果

**驗收標準**:

✅ 必須項（靜態圖表 - MVP）:
- [ ] 顯示 Code Interpreter 生成的圖表
- [ ] 圖表內嵌在對話流中
- [ ] 支援 PNG, SVG 格式
- [ ] 圖表可點擊放大
- [ ] 圖表可下載

✅ 進階項（互動圖表 - Phase 2）:
- [ ] 使用 Plotly/ECharts 生成互動圖表
- [ ] 支援縮放（Zoom In/Out）
- [ ] 支援平移（Pan）
- [ ] Tooltip 顯示詳細數據
- [ ] 圖例點擊顯示/隱藏數據系列
- [ ] 圖表可匯出為圖片或數據

**展示範例**:
```
[對話框]
用戶: "分析這三個月的銷售趨勢"

Agent:
"我來分析銷售趨勢數據...

[代碼執行中...]

分析完成！以下是銷售趨勢圖：

[圖表: sales_trend.png]
📈 互動提示: 點擊圖表可放大查看

從圖表可以看出：
• 1月銷售額: $500,000（基準）
• 2月銷售額: $650,000（增長 30%）
• 3月銷售額: $750,000（增長 15%）

💡 總體趨勢: 穩定增長
⚠️ 注意: 3月增速放緩，建議加強促銷活動"
```

**技術實現**:
- 圖片存儲: Azure Blob Storage
- 圖表庫: Plotly.js / ECharts（Phase 2）
- 圖片 CDN 加速

**📊 優先級**: P0 (MVP 必須 - 靜態圖表)
**🎯 UX 目標**: 圖表載入 <1 秒
**🔗 相關**: US 3.2 (代碼生成圖表), US 5.6 (SQL 可視化)

---

#### US 6.4 - 代碼塊展示與複製 ⭐ 開發者友好

**作為** 業務用戶/開發者
**我想要** 清晰展示 Agent 生成或執行的代碼
**以便** 理解 Agent 的邏輯和複用代碼

**驗收標準**:

✅ 必須項（代碼展示）:
- [ ] 代碼塊語法高亮（支援 Python, JavaScript, SQL, C#, JSON, YAML 等）
- [ ] 語言標籤顯示（```python → 顯示 "Python"）
- [ ] 一鍵複製代碼按鈕（點擊後顯示 "已複製"）
- [ ] 行號顯示（可選開關）
- [ ] 深色/淺色主題適配（跟隨系統或用戶設定）
- [ ] 長代碼可折疊/展開（超過 20 行自動折疊）

✅ 必須項（代碼功能）:
- [ ] 代碼格式化（自動縮排、對齊）
- [ ] 代碼高亮選中行（點擊行號）
- [ ] 代碼搜尋功能（Ctrl+F 在代碼塊內搜尋）
- [ ] 代碼下載（儲存為 .py, .js 等文件）

**UI 參考**:
- GitHub 代碼塊樣式
- Claude/ChatGPT 代碼展示
- VS Code 語法高亮

**UI 示例**:
```
┌─────────────────────────────────────────┐
│ Agent 回應:                              │
│                                          │
│ 這段代碼可以分析銷售數據：               │
│                                          │
│ ┌───────────────────────────────────┐   │
│ │ ```python          [複製] [▼折疊] │   │
│ │  1  import pandas as pd           │   │
│ │  2  import matplotlib.pyplot as...│   │
│ │  3                                │   │
│ │  4  # 載入數據                     │   │
│ │  5  data = pd.read_csv('sales.csv'│   │
│ │  ...                              │   │
│ │ 20  plt.savefig('chart.png')      │   │
│ │ [展開顯示更多]                     │   │
│ └───────────────────────────────────┘   │
│                                          │
│ 執行這段代碼即可生成趨勢圖。             │
└─────────────────────────────────────────┘
```

**技術要求**:
- Syntax Highlighter: Prism.js 或 Highlight.js
- Clipboard API（複製功能）
- Line Numbers Plugin

**📊 優先級**: P0 (MVP 必須)
**🎯 UX 目標**: 代碼高亮渲染 <100ms
**🔗 相關**: US 3.3 (Code Interpreter 展示)

---

#### US 6.5 - 表格數據展示

**作為** 業務用戶
**我想要** 在對話中看到結構化的表格數據
**以便** 快速理解數據結果

**驗收標準**:

✅ 必須項（表格展示）:
- [ ] Markdown 表格自動渲染
- [ ] 表格可排序（點擊表頭按欄位排序）
- [ ] 表格可搜尋（內建搜尋框）
- [ ] 大表格支援分頁（每頁 20 行）
- [ ] 表格可匯出（CSV/Excel）
- [ ] 響應式設計（移動端橫向滾動）

✅ 必須項（表格美化）:
- [ ] 斑馬紋（奇偶行不同背景色）
- [ ] Hover 效果（滑鼠懸停高亮）
- [ ] 對齊方式（數字右對齊、文字左對齊）
- [ ] 數字格式化（千分位、小數點）
- [ ] 長文字省略（Tooltip 顯示完整內容）

**展示範例**:
```
Agent: "以下是各地區銷售統計：

| 地區 | 銷售額 | 增長率 | 訂單數 |
|------|--------|--------|--------|
| 台北 | $1,000,000 | +15% | 1,500 |
| 新竹 | $800,000 | +25% | 800 |
| 台中 | $600,000 | -5% | 2,000 |

[搜尋: ___] [排序: 銷售額 ▼] [匯出 CSV]"
```

**技術實現**:
- React Table 或 TanStack Table
- 排序和篩選邏輯
- CSV 匯出庫（PapaParse）

**📊 優先級**: P1 (MVP 高優先)
**🎯 UX 目標**: 表格渲染 <200ms（100 行數據）
**🔗 相關**: US 5.5 (SQL 查詢結果), US 5.4 (Excel 數據)

---

#### US 6.6 - 移動端友好設計（RWD）

**作為** 移動端用戶
**我想要** 在手機上也能順暢使用 Chat 介面
**以便** 隨時隨地與 Agent 互動

**驗收標準**:

✅ 必須項（響應式佈局）:
- [ ] 支援螢幕寬度: 320px - 1920px
- [ ] 自動適配手機、平板、桌面
- [ ] 縱向和橫向模式支援
- [ ] 字體大小自動調整（em/rem 單位）
- [ ] 按鈕和點擊區域足夠大（至少 44px）

✅ 必須項（觸控手勢）:
- [ ] 滑動手勢切換對話（左右滑動）
- [ ] 下拉刷新（Pull to Refresh）
- [ ] 捏合縮放圖片（Pinch to Zoom）
- [ ] 長按複製文字
- [ ] 雙擊放大圖片

✅ 必須項（虛擬鍵盤適配）:
- [ ] 輸入框不被虛擬鍵盤遮擋
- [ ] 鍵盤彈出時自動捲動到輸入框
- [ ] 支援鍵盤工具列（格式化按鈕）

✅ 必須項（性能優化）:
- [ ] 圖片自適應大小（避免載入過大圖片）
- [ ] 表格橫向滾動（避免破版）
- [ ] Lazy Loading（延遲載入非可見內容）
- [ ] 減少移動端流量消耗（圖片壓縮）

✅ 必須項（離線支援 - Phase 2）:
- [ ] 對話歷史離線可查看
- [ ] Service Worker 緩存
- [ ] 離線狀態提示

**測試設備**:
- iPhone SE（小螢幕）
- iPhone 15 Pro（標準螢幕）
- iPad（平板）
- Android 手機（多種解析度）

**技術要求**:
- CSS Media Queries
- Flexbox/Grid 佈局
- Touch Events API
- Viewport Meta Tag

**📊 優先級**: P1 (MVP 高優先)
**🎯 UX 目標**: 移動端體驗與桌面端一致
**🔗 相關**: 所有 Chat UI 功能

---