# Text-to-SQL Wireframe

**版本**: 1.0.0
**日期**: 2025-10-29
**狀態**: ✅ 已完成
**複雜度**: ⭐⭐⭐ (中等)

---

## 📋 頁面概覽

### 目的
提供自然語言轉 SQL 的智能查詢工具，讓用戶能夠使用自然語言查詢資料庫、自動生成 SQL、執行查詢、展示結果，並提供數據視覺化分析和 SQL 優化建議。

### 目標用戶
- **Alex（IT 開發者）**: 快速編寫複雜 SQL、測試查詢效能、除錯 SQL 語句、學習最佳實踐
- **Sarah（業務分析師）**: 使用自然語言查詢業務數據、產生圖表報表、無需學習 SQL 語法
- **David（企業管理員）**: 監控查詢使用量、管理資料庫權限、審計查詢歷史、控制成本

### 成功指標
- SQL 生成準確率 > 85%（Top 1）
- 查詢執行成功率 > 95%
- 查詢響應時間 < 3s（中等複雜度）
- 自然語言理解準確率 > 80%
- 用戶滿意度評分 > 4.3/5

---

## 🖥️ Desktop 版本佈局（≥1280px）

### 完整 3-Column 佈局

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ ← Back   [🗄️ Text-to-SQL] [SQL 查詢工具]                   ⚙️ 🔔 👤 Alex          │
├────────────┬─────────────────────────────────────────┬───────────────────────────────┤
│            │                                         │                               │
│ 🗄️ 資料庫  │  💬 查詢與編輯區域                      │  📊 結果與分析                │
│            │                                         │                               │
│ ┌────────┐│  ┌─────────────────────────────────────┐│  ┌───────────────────────────┐│
│ │🔌 連接  ││  │ 💬 自然語言查詢                     ││  │ 📋 結果 | 📈 圖表 | 📊 統計││
│ │        ││  │                                     ││  └───────────────────────────┘│
│ │● Sales ││  │ 請幫我查詢最近 7 天每天的銷售總額，  ││                               │
│ │  DB    ││  │ 並按日期排序▋                       ││  ┌───────────────────────────┐│
│ │        ││  │                                     ││  │ 📅 Date    | 💰 Total Sales││
│ │○ Users ││  │          [🔍 生成 SQL] [▶️ 執行]     ││  ├───────────────────────────┤│
│ │  DB    ││  └─────────────────────────────────────┘││  │ 2025-10-23 | $12,345      ││
│ │        ││                                         ││  │ 2025-10-24 | $15,678      ││
│ │○ Logs  ││  ✨ AI 生成的 SQL：                     ││  │ 2025-10-25 | $13,234      ││
│ │  DB    ││  ┌─────────────────────────────────────┐││  │ 2025-10-26 | $14,567      ││
│ └────────┘││  │ SELECT                              ││  │ 2025-10-27 | $16,789      ││
│           ││  │   DATE(order_date) as date,         ││  │ 2025-10-28 | $15,234      ││
│ 📊 Schema ││  │   SUM(total_amount) as total_sales  ││  │ 2025-10-29 | $14,890      ││
│           ││  │ FROM orders                         ││  │ ─────────────────────────  ││
│ 📁 Tables ││  │ WHERE order_date >= DATE_SUB(       ││  │ 總計：7 行                ││
│ ├─ 📋 ord ││  │   CURRENT_DATE, INTERVAL 7 DAY)     ││  └───────────────────────────┘│
│ │  (1.2M) ││  │ GROUP BY DATE(order_date)           ││                               │
│ ├─ 📋 cst ││  │ ORDER BY date;                      ││  📊 快速統計：              │
│ │  (45K)  ││  │▋                                    ││  ┌───────────────────────────┐│
│ ├─ 📋 prd ││  └─────────────────────────────────────┘││  │ 💰 總銷售額              ││
│ │  (1.2K) ││                                         ││  │ $102,737                 ││
│ └─ ...    ││  ✅ SQL 語法正確 • ⏱️ 預估時間：< 100ms  ││  │                          ││
│           ││                                         ││  │ 📊 平均日銷售            ││
│ 📊 Views  ││  [✏️ 編輯] [💡 優化] [📋 複製] [📖 解釋] ││  │ $14,677                  ││
│ └─ sales  ││                                         ││  │                          ││
│           ││  [▶️ 執行查詢]              [💾 儲存]    ││  │ 📈 成長率                ││
│ 🔍 搜尋   ││                                         ││  │ +20.6% (vs 前 7 天)      ││
│ ┌────────┐││                                         ││  └───────────────────────────┘│
│ │搜尋表...│││                                         ││                               │
│ └────────┘││                                         ││  [📥 匯出 CSV] [📊 視覺化]  │
│           ││                                         ││                               │
│ ⏱️ 歷史   ││                                         ││                               │
│ 📅 今天   ││                                         ││                               │
│ ├─ 銷售統計││                                         ││                               │
│ │  14:30  ││                                         ││                               │
│ │  ✅ 145ms││                                         ││                               │
│ ├─ 用戶分析││                                         ││                               │
│ │  13:15  ││                                         ││                               │
│ │  ✅ 892ms││                                         ││                               │
│ └─ 產品排名││                                         ││                               │
│    12:00  ││                                         ││                               │
│    ❌ 錯誤 ││                                         ││                               │
│           ││                                         ││                               │
│ 📅 昨天   ││                                         ││                               │
│ └─ ...    ││                                         ││                               │
│           ││                                         ││                               │
│ [280px]   ││              [主要查詢區]                ││  [420px]                      │
└────────────┴─────────────────────────────────────────┴───────────────────────────────┘
```

---

## 📊 內容層級（Desktop）

### Level 1: 頁面結構（3-Column Layout）

```
┌──────────────┬────────────────────┬──────────────┐
│ 左側資料庫欄 │ 中央查詢編輯區     │ 右側結果面板 │
│ (280px)      │ (主要內容)         │ (420px)      │
│              │                    │              │
│ • 連接管理   │ • 自然語言輸入     │ • 查詢結果   │
│ • Schema瀏覽 │ • SQL 編輯器       │ • 圖表視覺化 │
│ • 表格列表   │ • 執行控制         │ • 統計分析   │
│ • 查詢歷史   │ • 優化建議         │ • 匯出操作   │
└──────────────┴────────────────────┴──────────────┘
```

### Level 2: 左側欄 - 資料庫管理

#### 資料庫連接列表
```
┌────────────────────────────────┐
│ 🔌 資料庫連接                  │
│                                │
│ ● Sales DB                     │ ← 已連接（綠色圓點）
│   PostgreSQL • localhost:5432  │
│   ┌──────────────────────────┐ │
│   │ 📊 8 Tables • 3 Views    │ │ ← Hover 顯示摘要
│   │ 💾 2.4 GB • 1.2M rows    │ │
│   │                          │ │
│   │ [📊 詳情] [⚙️ 設定]       │ │
│   └──────────────────────────┘ │
│                                │
│ ○ Users DB                     │ ← 未連接（灰色圓點）
│   MySQL • 192.168.1.100:3306   │
│   [🔌 連接] [⚙️ 設定]           │
│                                │
│ ○ Logs DB                      │ ← 未連接
│   MongoDB • logs.example.com   │
│   [🔌 連接] [⚙️ 設定]           │
│                                │
│ [ + 新增連接 ]                 │
└────────────────────────────────┘

連接狀態指示：
● 綠色 - 已連接且正常
◐ 黃色 - 連接中
○ 灰色 - 未連接
⊗ 紅色 - 連接錯誤
```

#### Schema 瀏覽器（樹狀結構）
```
┌────────────────────────────────┐
│ 📊 Schema - Sales DB           │
│                                │
│ 🔍 [搜尋表格或欄位...]         │ ← 即時搜尋
│                                │
│ 📁 Tables (8)                  │
│ ├─ 📋 orders (1,234,567 rows)  │ ← 點擊展開/收起
│ │  ├─ 🔑 id (INT, PK)          │
│ │  ├─ 📅 order_date (DATE)     │
│ │  ├─ 💰 total_amount (DECIMAL)│
│ │  ├─ 🔗 customer_id (INT, FK) │
│ │  ├─ 🔗 product_id (INT, FK)  │
│ │  ├─ 📝 status (VARCHAR)      │
│ │  ├─ 📅 created_at (TIMESTAMP)│
│ │  └─ 📅 updated_at (TIMESTAMP)│
│ │                              │
│ ├─ 📋 customers (45,678 rows)  │
│ │  ├─ 🔑 id (INT, PK)          │
│ │  ├─ 📛 name (VARCHAR)        │
│ │  ├─ 📧 email (VARCHAR)       │
│ │  ├─ 📞 phone (VARCHAR)       │
│ │  └─ ...                      │
│ │                              │
│ ├─ 📋 products (1,234 rows)    │
│ ├─ 📋 categories (56 rows)     │
│ ├─ 📋 order_items (2.5M rows)  │
│ └─ ...                         │
│                                │
│ 📊 Views (3)                   │
│ ├─ 👁️ monthly_sales            │
│ ├─ 👁️ customer_summary         │
│ └─ 👁️ product_rankings         │
│                                │
│ 🔧 Functions (2)               │
│ └─ calculate_discount()        │
│                                │
│ [🔄 刷新 Schema]                │
└────────────────────────────────┘

欄位圖示說明：
🔑 - Primary Key
🔗 - Foreign Key
📅 - Date/Time
💰 - Numeric
📝 - String/Text
☑️ - Boolean
📄 - JSON/XML
```

#### 表格預覽（Hover 或點擊）
```
Hover 表格時顯示：
┌────────────────────────────────┐
│ 📋 orders                      │
│                                │
│ 📊 統計：                      │
│ • 總行數：1,234,567            │
│ • 總大小：892 MB               │
│ • 最後更新：5 分鐘前           │
│                                │
│ 📋 欄位概覽：                  │
│ • 8 個欄位                     │
│ • 1 個主鍵 (id)                │
│ • 2 個外鍵 (customer, product) │
│                                │
│ 📊 索引：                      │
│ • idx_order_date               │
│ • idx_customer_id              │
│ • idx_status                   │
│                                │
│ [👁️ 預覽數據] [📊 查看統計]    │
└────────────────────────────────┘
```

#### 表格數據預覽
```
點擊「預覽數據」：
┌──────────────────────────────────────────────┐
│ 📋 orders - 數據預覽 (前 100 行)        [✕]  │
├──────────────────────────────────────────────┤
│                                              │
│ id  | date       | amount  | customer | ... │
│ ────┼────────────┼─────────┼──────────┼──── │
│ 1   | 2025-10-01 | $1,234  | John Doe | ... │
│ 2   | 2025-10-01 | $2,345  | Jane     | ... │
│ 3   | 2025-10-02 | $1,567  | Bob      | ... │
│ ... | ...        | ...     | ...      | ... │
│                                              │
│ [◀️ 上一頁] 顯示 1-100 / 1,234,567 [下一頁 ▶️]│
│                                              │
│ [📥 匯出全部] [📋 複製] [🔍 篩選] [關閉]     │
└──────────────────────────────────────────────┘
```

#### 查詢歷史
```
┌────────────────────────────────┐
│ ⏱️ 查詢歷史                    │
│                                │
│ 🔍 [搜尋歷史...]               │
│                                │
│ 📅 今天                        │
│ ┌────────────────────────────┐ │
│ │ 📊 銷售統計查詢             │ │ ← 點擊載入查詢
│ │ 14:30 • ✅ 成功 • 145ms     │ │
│ │                            │ │
│ │ SELECT DATE(order_date),   │ │ ← SQL 預覽
│ │ SUM(total_amount)...       │ │
│ │                            │ │
│ │ [載入] [⭐ 收藏] [🗑️ 刪除]  │ │
│ └────────────────────────────┘ │
│                                │
│ ┌────────────────────────────┐ │
│ │ 📊 用戶行為分析             │ │
│ │ 13:15 • ✅ 成功 • 892ms     │ │
│ │ [載入] [⭐ 收藏] [🗑️ 刪除]  │ │
│ └────────────────────────────┘ │
│                                │
│ ┌────────────────────────────┐ │
│ │ 📊 產品銷售排名             │ │
│ │ 12:00 • ❌ 錯誤             │ │ ← 錯誤標記
│ │ Error: Unknown column      │ │
│ │ [查看] [🗑️ 刪除]            │ │
│ └────────────────────────────┘ │
│                                │
│ 📅 昨天                        │
│ └─ ...                         │
│                                │
│ 📅 本週                        │
│ └─ ...                         │
│                                │
│ [清除全部歷史]                 │
└────────────────────────────────┘

歷史項目狀態：
✅ 成功 - 綠色
⚠️ 警告 - 黃色（有結果但有警告）
❌ 錯誤 - 紅色
⏳ 執行中 - 藍色
```

### Level 3: 中間欄 - 查詢與編輯區域

#### 自然語言輸入區
```
┌─────────────────────────────────────────┐
│ 💬 自然語言查詢                         │
│                                         │
│ 請幫我查詢最近 7 天每天的銷售總額，     │
│ 並按日期排序▋                           │
│                                         │
│ 💡 提示範例：                            │
│ • "查詢最近一個月的訂單數量"            │
│ • "找出銷售額最高的 10 個產品"          │
│ • "計算每個客戶的總消費金額"            │
│ • "統計各地區的銷售分布"                │
│ • "分析本季度 vs 上季度的成長率"        │
│                                         │
│          [🔍 生成 SQL] [▶️ 直接執行]     │
└─────────────────────────────────────────┘

輸入狀態：
⏳ 分析中 - 正在理解自然語言
✅ 已理解 - 顯示識別出的查詢意圖
⚠️ 不確定 - 需要用戶確認
❌ 無法理解 - 顯示錯誤提示
```

#### AI 分析結果
```
點擊「生成 SQL」後：
┌─────────────────────────────────────────┐
│ 🤖 AI 分析您的查詢...                   │
│                                         │
│ ✅ 已識別查詢意圖：                     │
│ ┌─────────────────────────────────────┐ │
│ │ 📊 聚合查詢 (Aggregation)           │ │
│ │                                     │ │
│ │ 🎯 查詢目標：                       │ │
│ │ • 數據源：orders 表                 │ │
│ │ • 時間範圍：最近 7 天               │ │
│ │ • 聚合函數：SUM(total_amount)       │ │
│ │ • 分組依據：DATE(order_date)        │ │
│ │ • 排序方式：date ASC                │ │
│ │                                     │ │
│ │ 🔍 檢測到的欄位：                   │ │
│ │ • order_date → orders.order_date   │ │
│ │ • 銷售總額 → orders.total_amount    │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 💡 信心度：92% (高)                     │
│                                         │
│ [✅ 確認生成 SQL] [✏️ 調整意圖] [❌ 取消]│
└─────────────────────────────────────────┘
```

#### SQL 編輯器（Monaco Editor）
```
┌─────────────────────────────────────────┐
│ ✨ AI 生成的 SQL：                      │
│ ┌─────────────────────────────────────┐ │
│ │ 1  SELECT                           │ │ ← 行號
│ │ 2    DATE(order_date) as date,      │ │
│ │ 3    SUM(total_amount) as total     │ │
│ │ 4  FROM orders                      │ │
│ │ 5  WHERE order_date >= DATE_SUB(    │ │
│ │ 6    CURRENT_DATE, INTERVAL 7 DAY)  │ │
│ │ 7  GROUP BY DATE(order_date)        │ │
│ │ 8  ORDER BY date;                   │ │
│ │▋                                    │ │ ← 游標
│ └─────────────────────────────────────┘ │
│                                         │
│ ✅ SQL 語法正確                         │
│ ⏱️ 預估執行時間：< 100ms                │
│ 📊 預估返回行數：~7 行                  │
│ 💾 預估數據量：< 1 KB                   │
│                                         │
│ [✏️ 編輯] [💡 優化] [📋 複製] [📖 解釋]  │
│                                         │
│ [▶️ 執行查詢]              [💾 儲存查詢] │
└─────────────────────────────────────────┘

SQL 語法狀態：
✅ 語法正確 - 綠色指示
⚠️ 語法警告 - 黃色，顯示警告訊息
❌ 語法錯誤 - 紅色，顯示錯誤行號和訊息
🔄 檢查中 - 正在驗證語法
```

#### SQL 優化建議
```
點擊「💡 優化」：
┌─────────────────────────────────────────┐
│ 💡 SQL 優化建議                         │
│                                         │
│ 🔍 已分析您的 SQL，發現 3 個優化點：    │
│                                         │
│ ✅ 1. 添加索引提示 (建議)               │
│ ┌─────────────────────────────────────┐ │
│ │ 效能提升：~45%                      │ │
│ │                                     │ │
│ │ 原因：order_date 欄位有索引         │ │
│ │ idx_order_date，建議使用索引提示    │ │
│ │                                     │ │
│ │ 修改：                              │ │
│ │ FROM orders USE INDEX (idx_date)    │ │
│ │                                     │ │
│ │ [✅ 套用] [❌ 忽略]                  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ⚠️ 2. 使用 BETWEEN 替代雙向比較 (建議)  │
│ ┌─────────────────────────────────────┐ │
│ │ 可讀性提升：更清晰                  │ │
│ │                                     │ │
│ │ 原本：                              │ │
│ │ WHERE order_date >= DATE_SUB(...)   │ │
│ │                                     │ │
│ │ 改為：                              │ │
│ │ WHERE order_date BETWEEN            │ │
│ │   DATE_SUB(...) AND CURRENT_DATE    │ │
│ │                                     │ │
│ │ [✅ 套用] [❌ 忽略]                  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 💡 3. 移除不必要的函數調用 (可選)       │
│ ┌─────────────────────────────────────┐ │
│ │ 效能提升：~10%                      │ │
│ │                                     │ │
│ │ 原因：DATE() 函數在大量數據時       │ │
│ │ 可能影響性能                        │ │
│ │                                     │ │
│ │ 建議：預先計算日期範圍              │ │
│ │                                     │ │
│ │ [查看詳情]                          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📊 預期效能改善：                       │
│ • 執行時間：185ms → 102ms (-45%)       │
│ • 掃描行數：1.2M → 480K (-60%)         │
│ • 記憶體使用：45MB → 28MB (-38%)       │
│                                         │
│ [ 全部套用 ]  [ 查看優化後 SQL ]  [ 取消 ]│
└─────────────────────────────────────────┘
```

#### 優化後的 SQL 對比
```
點擊「查看優化後 SQL」：
┌─────────────────────────────────────────┐
│ 🔄 SQL 對比                             │
│                                         │
│ ┌─────────────┬─────────────────────┐   │
│ │ ⬅️ 原始 SQL  │ ➡️ 優化後 SQL        │   │
│ ├─────────────┼─────────────────────┤   │
│ │ SELECT      │ SELECT              │   │
│ │   DATE(...) │   DATE(...) as date,│   │
│ │   SUM(...)  │   SUM(...) as total │   │
│ │ FROM orders │ FROM orders         │   │
│ │             │   USE INDEX (idx)   │ ← 新增
│ │ WHERE ...   │ WHERE ...           │   │
│ │   >= ...    │   BETWEEN ...       │ ← 修改
│ │ GROUP BY... │ GROUP BY date       │   │
│ │ ORDER BY... │ ORDER BY date;      │   │
│ └─────────────┴─────────────────────┘   │
│                                         │
│ 📊 效能比較：                           │
│ • 執行時間：185ms → 102ms ⬇️ 45%        │
│ • 掃描行數：1.2M → 480K ⬇️ 60%          │
│ • 成本分數：892 → 356 ⬇️ 60%            │
│                                         │
│ [ 套用優化 ]            [ 取消 ]        │
└─────────────────────────────────────────┘
```

#### SQL 解釋
```
點擊「📖 解釋」：
┌─────────────────────────────────────────┐
│ 📖 SQL 查詢解釋                         │
│                                         │
│ 🎯 查詢目的：                           │
│ 統計最近 7 天每天的銷售總額             │
│                                         │
│ 📝 逐行解釋：                           │
│                                         │
│ 1-2 行：SELECT 子句                     │
│ ┌─────────────────────────────────────┐ │
│ │ DATE(order_date) as date            │ │
│ │ → 從訂單日期中提取日期部分          │ │
│ │ → 命名為 'date' 便於閱讀            │ │
│ │                                     │ │
│ │ SUM(total_amount) as total_sales    │ │
│ │ → 計算每天的銷售總額                │ │
│ │ → 使用 SUM 聚合函數                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 4 行：FROM 子句                         │
│ ┌─────────────────────────────────────┐ │
│ │ FROM orders                         │ │
│ │ → 從 orders 表讀取數據              │ │
│ │ → 表中有 1,234,567 筆訂單           │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 5-6 行：WHERE 子句                      │
│ ┌─────────────────────────────────────┐ │
│ │ WHERE order_date >= DATE_SUB(       │ │
│ │   CURRENT_DATE, INTERVAL 7 DAY)     │ │
│ │ → 篩選最近 7 天的訂單               │ │
│ │ → DATE_SUB 函數減去 7 天            │ │
│ │ → 預計篩選出 ~8,000 筆訂單          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 7 行：GROUP BY 子句                     │
│ ┌─────────────────────────────────────┐ │
│ │ GROUP BY DATE(order_date)           │ │
│ │ → 將訂單按日期分組                  │ │
│ │ → 每天一組，共 7 組                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 8 行：ORDER BY 子句                     │
│ ┌─────────────────────────────────────┐ │
│ │ ORDER BY date                       │ │
│ │ → 按日期升序排序                    │ │
│ │ → 從最早到最新                      │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🎓 學習要點：                           │
│ • 聚合函數 (SUM) 與 GROUP BY 搭配使用  │
│ • DATE 函數用於日期處理                │
│ • 日期範圍篩選的常見模式               │
│                                         │
│ [ 關閉 ]                                │
└─────────────────────────────────────────┘
```

### Level 4: 右側欄 - 結果與分析

#### Tab 切換
```
┌───────────────────────────────────────┐
│ 📋 查詢結果 | 📈 圖表 | 📊 統計 | ⚙️ 設定│ ← Tabs
└───────────────────────────────────────┘
```

#### Tab 1: 查詢結果（表格）
```
┌─────────────────────────────────────────┐
│ 📋 查詢結果                    [🔍] [⚙️]│
│                                         │
│ ✅ 查詢成功 • ⏱️ 145ms • 📊 7 行        │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 📅 Date       ▲ | 💰 Total Sales    │ │ ← 表頭（可排序）
│ ├─────────────────────────────────────┤ │
│ │ 2025-10-23      | $12,345           │ │
│ │ 2025-10-24      | $15,678           │ │ ← 可選擇行
│ │ 2025-10-25      | $13,234           │ │
│ │ 2025-10-26      | $14,567           │ │
│ │ 2025-10-27      | $16,789           │ │ ← 高亮最大值
│ │ 2025-10-28      | $15,234           │ │
│ │ 2025-10-29      | $14,890           │ │ ← 高亮最小值
│ │ ─────────────────────────────────── │ │
│ │ 總計：7 行                          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [📥 匯出 CSV] [📥 Excel] [📋 複製]      │
│ [← 上一頁] 第 1 頁 / 共 1 頁 [下一頁 →] │
└─────────────────────────────────────────┘

表格功能：
• 點擊表頭：排序（升序/降序）
• 選擇行：多選（Ctrl/Cmd + Click）
• Hover 行：顯示詳細資訊
• 右鍵：複製、匯出、篩選
```

#### 列篩選器
```
點擊表頭的 [🔍]：
┌─────────────────────────────────────┐
│ 🔍 篩選 - Total Sales              │
│                                     │
│ 篩選類型：                          │
│ ● 數值範圍                          │
│ ○ 精確值                            │
│ ○ 前 N 個                           │
│                                     │
│ 範圍：                              │
│ 最小值：[12000] ▾                   │
│ 最大值：[17000] ▾                   │
│                                     │
│ 快速選擇：                          │
│ • 高於平均值 ($14,677)              │
│ • 低於平均值                        │
│ • 前 25%                            │
│ • 後 25%                            │
│                                     │
│ [ 套用 ]            [ 重置 ]        │
└─────────────────────────────────────┘
```

#### Tab 2: 圖表視覺化
```
┌─────────────────────────────────────────┐
│ 📈 圖表                        [🔍] [⚙️]│
│                                         │
│ 圖表類型：[📈 折線圖 ▾]     [🎨 自訂]  │
│ • 📊 長條圖                             │
│ • 📈 折線圖 (已選)                      │
│ • 🥧 圓餅圖                             │
│ • 📉 面積圖                             │
│ • 📊 堆疊圖                             │
│ • 📊 組合圖                             │
│                                         │
│   銷售趨勢 - 最近 7 天                  │
│                                         │
│ $17K ┤                                  │
│      │       ╭─╮                        │
│ $16K ┤      ╱  ╰╮                       │
│      │     ╱    ╰╮                      │
│ $15K ┤   ╭╯      ╰─╮ ╭─╮               │
│      │  ╱           ╰─╯ ╰╮              │
│ $14K ┤ ╱                 ╰              │
│      │╱                                 │
│ $13K ┤─                                 │
│      │                                  │
│ $12K ┼──┬────┬────┬────┬────┬────┬───  │
│      10/23  24   25   26   27   28  29 │
│                                         │
│ 📊 圖例：                               │
│ ─── Total Sales ($)                    │
│                                         │
│ [🔍 放大] [⬇️ PNG] [⬇️ SVG] [📊 數據]   │
└─────────────────────────────────────────┘
```

#### 圖表自訂
```
點擊「🎨 自訂」：
┌─────────────────────────────────────────┐
│ 🎨 自訂圖表                             │
│                                         │
│ 📊 數據配置：                           │
│ X 軸：[Date ▾]                          │
│ Y 軸：[Total Sales ▾]                   │
│                                         │
│ 🎨 樣式設定：                           │
│ ┌─────────────────────────────────────┐ │
│ │ 圖表標題                            │ │
│ │ ┌─────────────────────────────────┐ │ │
│ │ │ 銷售趨勢 - 最近 7 天             │ │ │
│ │ └─────────────────────────────────┘ │ │
│ │                                     │ │
│ │ 主題配色                            │ │
│ │ ● 藍色 (預設)                       │ │
│ │ ○ 綠色                              │ │
│ │ ○ 紅色                              │ │
│ │ ○ 彩虹                              │ │
│ │                                     │ │
│ │ 顯示選項                            │ │
│ │ ☑ 顯示數值標籤                      │ │
│ │ ☑ 顯示網格線                        │ │
│ │ ☑ 顯示圖例                          │ │
│ │ ☐ 顯示趨勢線                        │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [ 套用 ]  [ 預覽 ]  [ 重置 ]  [ 取消 ] │
└─────────────────────────────────────────┘
```

#### Tab 3: 統計分析
```
┌─────────────────────────────────────────┐
│ 📊 統計分析                    [🔍] [⚙️]│
│                                         │
│ 📊 描述性統計                           │
│ ┌─────────────────────────────────────┐ │
│ │ 💰 Total Sales                      │ │
│ │                                     │ │
│ │ 總和：       $102,737               │ │
│ │ 平均值：     $14,677                │ │
│ │ 中位數：     $14,890                │ │
│ │ 標準差：     $1,456                 │ │
│ │ 變異係數：   9.9%                   │ │
│ │                                     │ │
│ │ 最大值：     $16,789 (2025-10-27)   │ │
│ │ 最小值：     $12,345 (2025-10-23)   │ │
│ │ 範圍：       $4,444                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📈 趨勢分析                             │
│ ┌─────────────────────────────────────┐ │
│ │ 成長率：                            │ │
│ │ • 週成長：   +20.6% ↗️               │ │
│ │ • 日均成長： +2.8% ↗️                │ │
│ │                                     │ │
│ │ 趨勢方向：   ↗️ 上升趨勢             │ │
│ │ 趨勢強度：   中等 (R² = 0.67)       │ │
│ │                                     │ │
│ │ 預測：                              │ │
│ │ • 明天 (10/30)： ~$15,200           │ │
│ │ • 信心區間：     $14,500 - $15,900  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📊 分布分析                             │
│ ┌─────────────────────────────────────┐ │
│ │ 偏度：      -0.12 (接近對稱)        │ │
│ │ 峰度：       0.34 (正常分布)        │ │
│ │                                     │ │
│ │ 四分位數：                          │ │
│ │ Q1 (25%):   $13,234                 │ │
│ │ Q2 (50%):   $14,890                 │ │
│ │ Q3 (75%):   $15,678                 │ │
│ │ IQR:        $2,444                  │ │
│ │                                     │ │
│ │ 離群值：    無檢測到                │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [📥 匯出報告] [📊 視覺化] [🔄 重新計算] │
└─────────────────────────────────────────┘
```

#### Tab 4: 設定
```
┌─────────────────────────────────────────┐
│ ⚙️ 查詢設定                    [🔍] [💾]│
│                                         │
│ 📊 顯示設定                             │
│ ┌─────────────────────────────────────┐ │
│ │ 每頁顯示行數：                      │ │
│ │ ● 20 行                             │ │
│ │ ○ 50 行                             │ │
│ │ ○ 100 行                            │ │
│ │ ○ 全部                              │ │
│ │                                     │ │
│ │ 數值格式：                          │ │
│ │ ☑ 使用千分位符號 (1,234)           │ │
│ │ ☑ 顯示貨幣符號 ($)                  │ │
│ │ ☑ 自動格式化日期                    │ │
│ │                                     │ │
│ │ 高亮顯示：                          │ │
│ │ ☑ 最大值 (綠色)                     │ │
│ │ ☑ 最小值 (紅色)                     │ │
│ │ ☑ 空值 (灰色)                       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ⚡ 效能設定                             │
│ ┌─────────────────────────────────────┐ │
│ │ 查詢超時：                          │ │
│ │ [30] 秒                             │ │
│ │                                     │ │
│ │ 最大返回行數：                      │ │
│ │ [10000] 行                          │ │
│ │                                     │ │
│ │ ☑ 啟用查詢快取 (5 分鐘)            │ │
│ │ ☑ 啟用結果 Streaming               │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🔒 安全設定                             │
│ ┌─────────────────────────────────────┐ │
│ │ ☑ 執行前確認 (DELETE/UPDATE/DROP)  │ │
│ │ ☑ 限制只讀權限                      │ │
│ │ ☐ 記錄所有查詢 (審計日誌)          │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [ 儲存設定 ]            [ 重置為預設 ] │
└─────────────────────────────────────────┘
```

### Level 5: 互動流程詳細說明

#### 1. 新增資料庫連接

```
點擊「+ 新增連接」：
┌────────────────────────────────────────┐
│ 🔌 新增資料庫連接                [✕]   │
├────────────────────────────────────────┤
│                                        │
│ 📝 基本資訊                            │
│ ┌────────────────────────────────────┐ │
│ │ 連接名稱 *                         │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ Sales Database                 │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                    │ │
│ │ 資料庫類型 *                       │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ PostgreSQL ▾                   │ │ │
│ │ └────────────────────────────────┘ │ │
│ │ • MySQL                            │ │
│ │ • PostgreSQL                       │ │
│ │ • Microsoft SQL Server             │ │
│ │ • Oracle Database                  │ │
│ │ • SQLite                           │ │
│ │ • MongoDB (NoSQL)                  │ │
│ │ • Redis (Key-Value)                │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 🔧 連接設定                            │
│ ┌────────────────────────────────────┐ │
│ │ 主機位址 *                         │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ localhost                      │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                    │ │
│ │ 端口 *         資料庫名稱 *        │ │
│ │ ┌──────────┐  ┌──────────────────┐│ │
│ │ │ 5432     │  │ salesdb          ││ │
│ │ └──────────┘  └──────────────────┘│ │
│ └────────────────────────────────────┘ │
│                                        │
│ 🔐 認證資訊                            │
│ ┌────────────────────────────────────┐ │
│ │ 用戶名 *                           │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ postgres                       │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                    │ │
│ │ 密碼 *                             │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ ••••••••••••                   │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                    │ │
│ │ ☑ 儲存密碼 (加密存儲)              │ │
│ │ ☐ 使用 Windows 認證               │ │
│ └────────────────────────────────────┘ │
│                                        │
│ ⚙️ 進階選項 (選填)                     │
│ ┌────────────────────────────────────┐ │
│ │ ☑ 使用 SSL/TLS 連接                │ │
│ │ ☐ 驗證 SSL 憑證                    │ │
│ │                                    │ │
│ │ 連接池大小：[10] ▾                 │ │
│ │ 連接超時：[30] 秒                  │ │
│ │ 查詢超時：[60] 秒                  │ │
│ │                                    │ │
│ │ SSH 隧道：                         │ │
│ │ ☐ 使用 SSH 隧道連接                │ │
│ └────────────────────────────────────┘ │
│                                        │
│ [ 測試連接 ]                           │
│                                        │
│ [ 連接並儲存 ]            [ 取消 ]     │
└────────────────────────────────────────┘

測試連接結果：
┌────────────────────────────────────────┐
│ ✅ 連接測試成功                        │
│                                        │
│ 📊 資料庫資訊：                        │
│ • 版本：PostgreSQL 14.5               │
│ • 編碼：UTF-8                          │
│ • 時區：Asia/Taipei                    │
│ • 延遲：12ms                           │
│                                        │
│ 📁 可用資料庫：                        │
│ • salesdb (當前)                       │
│ • postgres (系統)                      │
│ • template1 (範本)                     │
│                                        │
│ [ 確定 ]                               │
└────────────────────────────────────────┘

連接失敗：
┌────────────────────────────────────────┐
│ ❌ 連接測試失敗                        │
│                                        │
│ 錯誤訊息：                             │
│ FATAL: password authentication failed  │
│ for user "postgres"                    │
│                                        │
│ 💡 可能原因：                          │
│ • 用戶名或密碼錯誤                     │
│ • 資料庫不允許遠端連接                 │
│ • 防火牆阻擋連接                       │
│ • PostgreSQL 服務未啟動                │
│                                        │
│ 🔧 建議解決方案：                      │
│ 1. 檢查用戶名和密碼是否正確            │
│ 2. 確認 pg_hba.conf 允許此 IP 連接     │
│ 3. 檢查防火牆設定                      │
│                                        │
│ [ 重試 ]  [ 查看文檔 ]  [ 取消 ]       │
└────────────────────────────────────────┘
```

#### 2. 執行查詢流程

```
Step 1: 點擊「▶️ 執行查詢」

執行前確認（如果是 DELETE/UPDATE/DROP）：
┌────────────────────────────────────────┐
│ ⚠️ 確認執行查詢                        │
│                                        │
│ 您即將執行以下查詢：                   │
│ ┌────────────────────────────────────┐ │
│ │ DELETE FROM orders                 │ │
│ │ WHERE order_date < '2020-01-01';   │ │
│ └────────────────────────────────────┘ │
│                                        │
│ ⚠️ 此操作將：                          │
│ • 刪除 ~234,567 行數據                 │
│ • 無法復原                             │
│ • 可能影響其他相關表格                 │
│                                        │
│ 是否繼續？                             │
│                                        │
│ [ 繼續執行 ]            [ 取消 ]       │
└────────────────────────────────────────┘

Step 2: 執行中

┌────────────────────────────────────────┐
│ 🔄 正在執行查詢...                     │
│                                        │
│ ████████████████░░░░ 75%               │
│                                        │
│ 📊 進度資訊：                          │
│ • 已掃描：892,456 / 1,234,567 行       │
│ • 已耗時：1.2s                         │
│ • 預估剩餘：0.4s                       │
│                                        │
│ 💡 提示：                              │
│ 查詢正在使用索引 idx_order_date        │
│                                        │
│ [ 取消執行 ]                           │
└────────────────────────────────────────┘

Step 3: 執行成功

┌────────────────────────────────────────┐
│ ✅ 查詢執行成功                        │
│                                        │
│ ⏱️ 執行時間：1.45s                     │
│ 📊 返回行數：7 行                      │
│ 🔍 掃描行數：1,234,567 行              │
│ 💾 數據量：892 bytes                   │
│                                        │
│ 📈 效能指標：                          │
│ • 查詢成本：356 (良好)                 │
│ • 使用索引：idx_order_date             │
│ • 記憶體使用：28 MB                    │
│                                        │
│ [ 查看結果 ]                           │
└────────────────────────────────────────┘

Step 4: 執行失敗

┌────────────────────────────────────────┐
│ ❌ 查詢執行失敗                        │
│                                        │
│ 錯誤類型：語法錯誤 (Syntax Error)      │
│                                        │
│ 錯誤訊息：                             │
│ ERROR:  column "total_amount" does not │
│ exist at character 42                  │
│                                        │
│ 錯誤位置：                             │
│ ┌────────────────────────────────────┐ │
│ │ 3  SELECT                          │ │
│ │ 4    SUM(total_amount) as total    │ │ ← 錯誤行
│ │          ^^^^^^^^^                 │ │ ← 錯誤位置
│ └────────────────────────────────────┘ │
│                                        │
│ 💡 可能原因：                          │
│ • 欄位名稱拼寫錯誤                     │
│ • 欄位不存在於 orders 表               │
│ • 需要指定表格別名                     │
│                                        │
│ 🔧 建議解決方案：                      │
│ 1. 檢查 Schema 瀏覽器確認欄位名稱      │
│ 2. 可能的正確欄位名：                  │
│    • amount                            │
│    • total                             │
│    • order_total                       │
│                                        │
│ [ 返回編輯 ]  [ 查看 Schema ]  [ 取消 ]│
└────────────────────────────────────────┘
```

#### 3. 查詢範本管理

```
點擊「📋 範本」：
┌────────────────────────────────────────┐
│ 📋 查詢範本庫                    [✕]   │
├────────────────────────────────────────┤
│                                        │
│ 🔍 [搜尋範本...]                       │
│                                        │
│ 📁 我的範本 (5)                        │
│ ├─ 📊 每日銷售統計                     │
│ ├─ 📊 月度銷售趨勢                     │
│ ├─ 📊 產品銷售排名                     │
│ ├─ 📊 客戶消費分析                     │
│ └─ 📊 庫存預警查詢                     │
│                                        │
│ 📁 系統範本 (12)                       │
│ ├─ 📂 銷售分析 (4)                     │
│ │  ├─ 每日/每週/每月銷售                │
│ │  ├─ 同比環比分析                      │
│ │  ├─ 銷售漏斗分析                      │
│ │  └─ 客戶購買行為                      │
│ │                                      │
│ ├─ 📂 用戶分析 (3)                     │
│ │  ├─ 活躍用戶統計                      │
│ │  ├─ 用戶留存率                        │
│ │  └─ 新用戶增長                        │
│ │                                      │
│ ├─ 📂 庫存管理 (2)                     │
│ │  ├─ 庫存水位查詢                      │
│ │  └─ 缺貨預警                          │
│ │                                      │
│ └─ 📂 財務報表 (3)                     │
│    ├─ 收入報表                          │
│    ├─ 成本分析                          │
│    └─ 利潤統計                          │
│                                        │
│ [ + 建立新範本 ]  [ 匯入 ]  [ 管理 ]   │
└────────────────────────────────────────┘

點擊範本：
┌────────────────────────────────────────┐
│ 📊 每日銷售統計                  [✕]   │
├────────────────────────────────────────┤
│                                        │
│ 📝 描述：                              │
│ 查詢指定日期範圍內每天的銷售總額、     │
│ 訂單數量和平均訂單金額                 │
│                                        │
│ 📊 需要的參數：                        │
│ ┌────────────────────────────────────┐ │
│ │ 開始日期 *                         │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 2025-10-01                     │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                    │ │
│ │ 結束日期 *                         │ │
│ │ ┌────────────────────────────────┐ │ │
│ │ │ 2025-10-31                     │ │ │
│ │ └────────────────────────────────┘ │ │
│ │                                    │ │
│ │ 狀態篩選 (選填)                    │ │
│ │ ☑ 已完成                           │ │
│ │ ☑ 已付款                           │ │
│ │ ☐ 已取消                           │ │
│ │ ☐ 退款中                           │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 📋 範本 SQL：                          │
│ ┌────────────────────────────────────┐ │
│ │ SELECT                             │ │
│ │   DATE(order_date) as date,        │ │
│ │   COUNT(*) as order_count,         │ │
│ │   SUM(total_amount) as total,      │ │
│ │   AVG(total_amount) as avg_amount  │ │
│ │ FROM orders                        │ │
│ │ WHERE order_date BETWEEN           │ │
│ │   @start_date AND @end_date        │ │ ← 參數佔位符
│ │   AND status IN (@status_list)     │ │
│ │ GROUP BY DATE(order_date)          │ │
│ │ ORDER BY date;                     │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 💡 使用次數：45 次                     │
│ 📅 最後使用：2 天前                    │
│ ⭐ 已加入收藏                          │
│                                        │
│ [ 套用範本 ]  [ 編輯 ]  [ 刪除 ]       │
└────────────────────────────────────────┘
```

---

## 📱 Tablet 版本佈局（768px - 1279px）

### 可折疊 3-Column

```
┌─────────────────────────────────────────────────────────┐
│ ☰  [🗄️ Text-to-SQL]                ⚙️ 🔔 👤 Alex       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [🔍 生成] [▶️ 執行] [💾 儲存]    [📊 面板 ▾] [📁 DB ▾]  │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │ 💬 請幫我查詢最近 7 天每天的銷售總額...▋           │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │ ✨ AI 生成的 SQL：                                │ │
│  │ SELECT DATE(order_date)...                        │ │
│  │ [✏️] [💡] [📋] [▶️]                                 │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ⋮                                                      │
│                                                         │
└─────────────────────────────────────────────────────────┘

點擊「📊 面板」彈出右側欄：
                    ┌──────────────────────┐
                    │ 📋 結果 | 📈 圖表    │
                    ├──────────────────────┤
                    │ Date    | Total      │
                    │ ────────────────────  │
                    │ 10-23   | $12,345    │
                    │ ...                  │
                    │                      │
                    │ [關閉 ✕]             │
                    └──────────────────────┘

點擊「📁 DB」彈出左側欄：
┌──────────────────────┐
│ 🗄️ Sales DB          │
│ ● 已連接              │
│                      │
│ 📊 Schema            │
│ ├─ orders            │
│ └─ ...               │
│                      │
│ [關閉 ✕]             │
└──────────────────────┘
```

---

## 📱 Mobile 版本佈局（<768px）

### 全屏視圖

```
┌────────────────────────────────┐
│ ← [SQL 查詢]              ⋮    │
├────────────────────────────────┤
│                                │
│  💬 查詢輸入                   │
│  ┌──────────────────────────┐ │
│  │ 請幫我查詢...▋           │ │
│  └──────────────────────────┘ │
│                                │
│  [🔍 生成] [▶️ 執行]            │
│                                │
│  ✨ SQL                        │
│  ┌──────────────────────────┐ │
│  │ SELECT ...               │ │
│  │ [展開查看]               │ │
│  └──────────────────────────┘ │
│                                │
│  📊 結果 (7 行)                │
│  ┌──────────────────────────┐ │
│  │ Date    | Total          │ │
│  │ ────────────────────     │ │
│  │ 10-23   | $12,345        │ │
│  │ [展開查看]               │ │
│  └──────────────────────────┘ │
│                                │
│  [📥 匯出] [📊 圖表]            │
│                                │
└────────────────────────────────┘

底部選單（點擊 ⋮）：
┌────────────────────────────────┐
│ 🗄️ 切換資料庫                  │
│ 📊 查看 Schema                 │
│ ⏱️ 查詢歷史                    │
│ 📋 查詢範本                    │
│ ⚙️ 設定                        │
│ ─────────────────────          │
│ ✕ 關閉                         │
└────────────────────────────────┘
```

---

## ♿ 無障礙設計

### 鍵盤導航

```yaml
全局快捷鍵:
  Ctrl+Enter: 執行查詢
  Ctrl+G: 生成 SQL
  Ctrl+S: 儲存查詢
  Ctrl+L: 格式化 SQL
  Ctrl+/: 註解/取消註解
  Ctrl+F: 搜尋表格或欄位
  F5: 刷新 Schema
  Esc: 關閉彈出視窗

SQL 編輯器:
  Ctrl+Space: 自動補全（表名、欄位名）
  Ctrl+F: 搜尋
  Ctrl+H: 替換
  Tab: 縮排
  Shift+Tab: 取消縮排
  Ctrl+D: 刪除當前行
  Ctrl+Z: 復原
  Ctrl+Y: 重做

資料庫導航:
  Arrow Up/Down: 在表格/欄位間移動
  Arrow Right: 展開節點
  Arrow Left: 收起節點
  Enter: 選擇表格/欄位
  Space: 預覽表格數據

結果導航:
  Arrow Up/Down: 在結果行間移動
  Ctrl+C: 複製選中的儲存格
  Ctrl+A: 全選
  Tab: 切換到下一個 Tab（圖表、統計）
```

### ARIA 標籤

```html
<!-- 主容器 -->
<main aria-label="Text-to-SQL 查詢工具" role="main">
  <!-- 左側資料庫欄 -->
  <aside aria-label="資料庫管理" role="complementary">
    <!-- 連接列表 -->
    <section aria-labelledby="connections-heading">
      <h2 id="connections-heading">資料庫連接</h2>

      <ul role="list">
        <li role="listitem">
          <button
            aria-label="Sales DB，已連接"
            aria-describedby="sales-db-info"
          >
            <span aria-hidden="true">●</span> Sales DB
          </button>

          <div id="sales-db-info" class="sr-only">
            PostgreSQL，localhost:5432，8 個表格
          </div>
        </li>
      </ul>

      <button aria-label="新增資料庫連接">+ 新增連接</button>
    </section>

    <!-- Schema 瀏覽器 -->
    <section aria-labelledby="schema-heading">
      <h2 id="schema-heading">Schema - Sales DB</h2>

      <input
        type="search"
        aria-label="搜尋表格或欄位"
        placeholder="搜尋表格或欄位..."
      />

      <nav aria-label="資料庫 Schema">
        <ul role="tree">
          <li role="treeitem" aria-expanded="true">
            <button aria-label="表格 orders，展開，1,234,567 行">
              📋 orders (1.2M rows)
            </button>

            <ul role="group">
              <li role="treeitem">
                <button aria-label="欄位 id，主鍵，整數型別">
                  🔑 id (INT, PK)
                </button>
              </li>
              <li role="treeitem">
                <button aria-label="欄位 order_date，日期型別">
                  📅 order_date (DATE)
                </button>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
    </section>

    <!-- 查詢歷史 -->
    <section aria-labelledby="history-heading">
      <h2 id="history-heading">查詢歷史</h2>

      <input
        type="search"
        aria-label="搜尋查詢歷史"
        placeholder="搜尋歷史..."
      />

      <nav aria-label="查詢歷史列表">
        <ul role="list">
          <li role="listitem">
            <article aria-labelledby="history-1-title">
              <h3 id="history-1-title">銷售統計查詢</h3>
              <p>14:30 • 成功 • 145ms</p>

              <div role="toolbar" aria-label="歷史項目操作">
                <button aria-label="載入此查詢">載入</button>
                <button aria-label="加入收藏">⭐ 收藏</button>
                <button aria-label="刪除此查詢">🗑️ 刪除</button>
              </div>
            </article>
          </li>
        </ul>
      </nav>
    </section>
  </aside>

  <!-- 中央查詢區 -->
  <section aria-label="查詢編輯區" role="region">
    <!-- 自然語言輸入 -->
    <div>
      <label for="natural-query">自然語言查詢</label>
      <textarea
        id="natural-query"
        aria-label="輸入自然語言查詢"
        placeholder="請描述您想查詢的數據..."
      ></textarea>

      <div role="toolbar" aria-label="查詢操作">
        <button aria-label="生成 SQL">🔍 生成 SQL</button>
        <button aria-label="直接執行查詢">▶️ 直接執行</button>
      </div>
    </div>

    <!-- SQL 編輯器 -->
    <div>
      <h3>AI 生成的 SQL</h3>

      <div
        role="textbox"
        aria-label="SQL 編輯器"
        aria-multiline="true"
        contenteditable="true"
      >
        <!-- Monaco Editor -->
      </div>

      <div
        role="status"
        aria-live="polite"
        aria-atomic="true"
      >
        ✅ SQL 語法正確 • 預估執行時間：< 100ms
      </div>

      <div role="toolbar" aria-label="SQL 操作">
        <button aria-label="編輯 SQL">✏️ 編輯</button>
        <button aria-label="優化 SQL">💡 優化</button>
        <button aria-label="複製 SQL">📋 複製</button>
        <button aria-label="解釋 SQL">📖 解釋</button>
      </div>

      <button
        type="button"
        aria-label="執行查詢"
        class="primary-action"
      >
        ▶️ 執行查詢
      </button>
    </div>
  </section>

  <!-- 右側結果面板 -->
  <aside aria-label="查詢結果與分析" role="complementary">
    <!-- Tab 導航 -->
    <div role="tablist" aria-label="結果視圖選擇">
      <button
        role="tab"
        aria-selected="true"
        aria-controls="results-panel"
        id="results-tab"
      >
        📋 查詢結果
      </button>

      <button
        role="tab"
        aria-selected="false"
        aria-controls="chart-panel"
        id="chart-tab"
      >
        📈 圖表
      </button>

      <button
        role="tab"
        aria-selected="false"
        aria-controls="stats-panel"
        id="stats-tab"
      >
        📊 統計
      </button>
    </div>

    <!-- 結果 Panel -->
    <div
      role="tabpanel"
      id="results-panel"
      aria-labelledby="results-tab"
      tabindex="0"
    >
      <div role="status" aria-live="polite">
        ✅ 查詢成功 • 145ms • 7 行
      </div>

      <table role="table" aria-label="查詢結果表格">
        <thead>
          <tr>
            <th>
              <button aria-label="按日期排序，當前升序">
                📅 Date ▲
              </button>
            </th>
            <th>
              <button aria-label="按總銷售額排序，未排序">
                💰 Total Sales
              </button>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>2025-10-23</td>
            <td>$12,345</td>
          </tr>
          <!-- More rows -->
        </tbody>
        <tfoot>
          <tr>
            <td colspan="2">總計：7 行</td>
          </tr>
        </tfoot>
      </table>

      <div role="toolbar" aria-label="結果操作">
        <button aria-label="匯出為 CSV">📥 匯出 CSV</button>
        <button aria-label="匯出為 Excel">📥 Excel</button>
        <button aria-label="複製到剪貼簿">📋 複製</button>
      </div>

      <nav aria-label="分頁導航">
        <button aria-label="上一頁" disabled>← 上一頁</button>
        <span aria-current="page">第 1 頁 / 共 1 頁</span>
        <button aria-label="下一頁" disabled>下一頁 →</button>
      </nav>
    </div>

    <!-- 圖表 Panel -->
    <div
      role="tabpanel"
      id="chart-panel"
      aria-labelledby="chart-tab"
      hidden
    >
      <div aria-label="圖表設定">
        <label for="chart-type">圖表類型</label>
        <select id="chart-type">
          <option>折線圖</option>
          <option>長條圖</option>
          <option>圓餅圖</option>
        </select>
      </div>

      <figure aria-labelledby="chart-title">
        <figcaption id="chart-title">
          銷售趨勢 - 最近 7 天
        </figcaption>

        <!-- Chart canvas/svg -->
        <div role="img" aria-label="折線圖顯示最近 7 天的銷售趨勢，從 10 月 23 日的 $12,345 上升到 10 月 27 日的峰值 $16,789">
          <!-- Chart rendering -->
        </div>
      </figure>
    </div>

    <!-- 統計 Panel -->
    <div
      role="tabpanel"
      id="stats-panel"
      aria-labelledby="stats-tab"
      hidden
    >
      <section aria-labelledby="descriptive-stats">
        <h3 id="descriptive-stats">描述性統計</h3>

        <dl>
          <dt>總和</dt>
          <dd>$102,737</dd>

          <dt>平均值</dt>
          <dd>$14,677</dd>

          <dt>中位數</dt>
          <dd>$14,890</dd>

          <dt>標準差</dt>
          <dd>$1,456</dd>
        </dl>
      </section>

      <section aria-labelledby="trend-analysis">
        <h3 id="trend-analysis">趨勢分析</h3>

        <dl>
          <dt>週成長率</dt>
          <dd>+20.6% 上升</dd>

          <dt>趨勢方向</dt>
          <dd>上升趨勢</dd>
        </dl>
      </section>
    </div>
  </aside>
</main>
```

### 螢幕閱讀器優化

```yaml
查詢狀態通知:
  實現: aria-live="polite"
  行為:
    - SQL 生成開始：朗讀"正在生成 SQL"
    - SQL 生成完成：朗讀"SQL 生成完成，語法正確"
    - 查詢執行開始：朗讀"正在執行查詢"
    - 查詢執行完成：朗讀"查詢成功，返回 7 行，用時 145 毫秒"
    - 查詢執行失敗：朗讀完整錯誤訊息和建議

焦點管理:
  SQL 生成後:
    - 焦點移至 SQL 編輯器
    - 朗讀"SQL 已生成，您可以編輯或直接執行"

  查詢執行後:
    - 成功：焦點移至結果表格第一行
    - 失敗：焦點移至錯誤訊息
    - 朗讀結果摘要

  開啟彈出視窗:
    - 焦點移至視窗標題
    - Esc 關閉並返回觸發元素

錯誤處理:
  連接失敗:
    - 朗讀詳細錯誤訊息
    - 朗讀建議解決方案
    - 焦點移至「重試」按鈕

  查詢錯誤:
    - 朗讀錯誤類型和訊息
    - 朗讀錯誤位置（行號）
    - 朗讀建議的修正方式
    - 焦點移至「返回編輯」按鈕

表格導航:
  實現: 支援 Arrow 鍵導航
  行為:
    - Arrow Up/Down: 在行間移動
    - Arrow Left/Right: 在列間移動
    - Enter: 選擇當前儲存格
    - 朗讀當前儲存格的內容和位置
```

---

## ⚡ 性能優化

### 1. SQL 生成優化

```typescript
interface SQLGenerationOptimization {
  // AI 模型優化
  model: {
    type: 'GPT-4' | 'Claude-3',
    temperature: 0.1,          // 低溫度提升準確性
    maxTokens: 1000,           // 限制 SQL 長度
    streaming: false           // SQL 生成不使用 Streaming
  },

  // Schema 上下文優化
  schemaContext: {
    sampling: true,            // 大型 Schema 時採樣
    maxTables: 50,             // 最多包含 50 個表
    maxColumnsPerTable: 20,    // 每表最多 20 個欄位
    includeIndexes: true,      // 包含索引資訊
    includeSamples: true       // 包含示例數據
  },

  // 快取策略
  caching: {
    enabled: true,
    ttl: 3600,                 // 1 小時
    keyStrategy: 'nl+schema',  // 自然語言 + Schema 作為鍵
    cacheHitRate: '> 30%'      // 預期快取命中率
  },

  // 性能指標
  targets: {
    generation: '< 2s',        // SQL 生成時間
    accuracy: '> 85%',         // Top 1 準確率
    confidence: '> 0.7'        // 最低信心度閾值
  }
}
```

### 2. 查詢執行優化

```typescript
interface QueryExecutionOptimization {
  // 連接池管理
  connectionPool: {
    minSize: 2,
    maxSize: 10,
    idleTimeout: 30000,        // 30 秒
    acquireTimeout: 10000      // 10 秒
  },

  // 查詢優化
  queryOptimization: {
    timeout: 30000,            // 30 秒超時
    maxRows: 10000,            // 最多返回 10000 行
    streaming: true,           // 結果 Streaming
    pagination: {
      enabled: true,
      pageSize: 100            // 每頁 100 行
    }
  },

  // 結果快取
  resultCaching: {
    enabled: true,
    ttl: 300,                  // 5 分鐘
    maxSize: '100MB',          // 最大快取大小
    evictionPolicy: 'LRU'      // 最近最少使用
  },

  // 性能收益
  improvements: {
    cachedQuery: '< 100ms',    // 快取命中
    streamingStart: '< 500ms', // Streaming 開始時間
    networkUsage: '-60%'       // 減少 60% 網路傳輸
  }
}
```

### 3. 前端優化

```typescript
interface FrontendOptimization {
  // 虛擬滾動
  virtualScrolling: {
    enabled: true,
    itemHeight: 40,            // 表格行高度
    bufferSize: 10,            // 緩衝區大小
    overscan: 5                // 上下各渲染 5 行額外
  },

  // Monaco Editor 優化
  editor: {
    lazyLoad: true,            // 延遲載入
    loadOnFocus: true,         // 聚焦時載入
    syntaxValidation: {
      enabled: true,
      debounce: 500            // 500ms 防抖
    },
    autoComplete: {
      enabled: true,
      debounce: 300,           // 300ms 防抖
      maxSuggestions: 50       // 最多 50 個建議
    }
  },

  // 圖表渲染優化
  chartRendering: {
    renderMode: 'canvas',      // 使用 Canvas
    sampling: {
      enabled: true,
      threshold: 1000,         // > 1000 點時採樣
      algorithm: 'lttb'        // Largest-Triangle-Three-Buckets
    },
    lazyRender: true           // 延遲渲染（切換 Tab 時）
  },

  // 性能收益
  benefits: {
    initialLoad: '< 1s',       // 初始載入時間
    scrollFPS: '60fps',        // 滾動流暢度
    chartRender: '< 500ms',    // 圖表渲染時間
    memoryUsage: '-70%'        // 減少 70% 記憶體使用
  }
}
```

### 4. Schema 載入優化

```typescript
interface SchemaLoadingOptimization {
  // 增量載入
  incrementalLoading: {
    enabled: true,
    loadOnDemand: true,        // 按需載入
    initialLoad: ['tables'],   // 初始只載入表名
    expandLoad: ['columns', 'types', 'keys'] // 展開時載入詳情
  },

  // 快取策略
  schemaCaching: {
    enabled: true,
    ttl: 3600,                 // 1 小時
    invalidateOn: ['alter', 'drop', 'create'], // 觸發失效的操作
    storage: 'indexedDB'       // 使用 IndexedDB 存儲
  },

  // 壓縮傳輸
  compression: {
    enabled: true,
    algorithm: 'gzip',
    level: 6
  },

  // 性能收益
  improvements: {
    initialLoad: '< 500ms',    // 初始 Schema 載入
    fullLoad: '< 2s',          // 完整 Schema 載入
    bandwidth: '-70%',         // 減少 70% 頻寬
    storage: '< 5MB'           // 本地存儲佔用
  }
}
```

---

## 🔧 技術實現建議

### 1. 狀態管理（Zustand）

```typescript
// stores/textToSQLStore.ts
import create from 'zustand';

interface Connection {
  id: string;
  name: string;
  type: 'postgresql' | 'mysql' | 'sqlserver' | 'oracle' | 'sqlite';
  host: string;
  port: number;
  database: string;
  username: string;
  status: 'connected' | 'disconnected' | 'connecting' | 'error';
  lastConnected?: Date;
}

interface Schema {
  tables: Table[];
  views: View[];
  functions: Function[];
}

interface Table {
  name: string;
  schema: string;
  rowCount: number;
  size: number;
  columns: Column[];
  indexes: Index[];
  foreignKeys: ForeignKey[];
}

interface Column {
  name: string;
  type: string;
  nullable: boolean;
  defaultValue?: string;
  isPrimaryKey: boolean;
  isForeignKey: boolean;
  comment?: string;
}

interface Query {
  id: string;
  naturalLanguage: string;
  sql: string;
  status: 'idle' | 'generating' | 'executing' | 'completed' | 'error';
  result?: QueryResult;
  error?: string;
  executionTime?: number;
  timestamp: Date;
}

interface QueryResult {
  rows: any[];
  columns: ResultColumn[];
  rowCount: number;
  executionTime: number;
  affectedRows?: number;
}

interface QueryTemplate {
  id: string;
  name: string;
  description: string;
  category: string;
  sql: string;
  parameters: TemplateParameter[];
  usageCount: number;
  lastUsed?: Date;
  isFavorite: boolean;
}

interface TextToSQLStore {
  // 連接狀態
  connections: Connection[];
  activeConnectionId: string | null;
  schemas: Map<string, Schema>;

  // 查詢狀態
  currentQuery: Query;
  queryHistory: Query[];
  queryTemplates: QueryTemplate[];

  // 結果狀態
  currentResult: QueryResult | null;
  selectedRows: Set<number>;

  // UI 狀態
  leftPanelOpen: boolean;
  rightPanelOpen: boolean;
  activeTab: 'results' | 'chart' | 'stats' | 'settings';

  // 連接操作
  connectDatabase: (config: ConnectionConfig) => Promise<void>;
  disconnectDatabase: (id: string) => void;
  loadSchema: (connectionId: string) => Promise<void>;
  testConnection: (config: ConnectionConfig) => Promise<boolean>;

  // 查詢操作
  generateSQL: (naturalLanguage: string) => Promise<string>;
  executeQuery: (sql: string) => Promise<QueryResult>;
  cancelQuery: () => void;
  optimizeSQL: (sql: string) => Promise<{ sql: string; improvements: string[] }>;
  explainSQL: (sql: string) => Promise<SQLExplanation>;

  // 歷史與範本操作
  saveQueryToHistory: (query: Query) => void;
  loadQueryFromHistory: (id: string) => void;
  saveQueryAsTemplate: (query: Query, template: Omit<QueryTemplate, 'id'>) => void;
  loadTemplate: (id: string) => void;

  // 結果操作
  exportResults: (format: 'csv' | 'excel' | 'json') => Promise<Blob>;
  visualizeResults: (chartType: ChartType, config: ChartConfig) => void;
  getStatistics: () => StatisticsData;
}

const useTextToSQLStore = create<TextToSQLStore>((set, get) => ({
  connections: [],
  activeConnectionId: null,
  schemas: new Map(),
  currentQuery: {
    id: '',
    naturalLanguage: '',
    sql: '',
    status: 'idle',
    timestamp: new Date()
  },
  queryHistory: [],
  queryTemplates: [],
  currentResult: null,
  selectedRows: new Set(),
  leftPanelOpen: true,
  rightPanelOpen: true,
  activeTab: 'results',

  connectDatabase: async (config) => {
    const connectionId = generateId();

    // 設置連接中狀態
    set((state) => ({
      connections: [...state.connections, {
        id: connectionId,
        ...config,
        status: 'connecting' as const
      }]
    }));

    try {
      // 建立連接
      await api.connectDatabase(config);

      // 更新為已連接
      set((state) => ({
        connections: state.connections.map(conn =>
          conn.id === connectionId
            ? { ...conn, status: 'connected' as const, lastConnected: new Date() }
            : conn
        ),
        activeConnectionId: connectionId
      }));

      // 載入 Schema
      await get().loadSchema(connectionId);

    } catch (error) {
      // 更新為錯誤狀態
      set((state) => ({
        connections: state.connections.map(conn =>
          conn.id === connectionId
            ? { ...conn, status: 'error' as const }
            : conn
        )
      }));

      throw error;
    }
  },

  loadSchema: async (connectionId) => {
    const schema = await api.loadSchema(connectionId);

    set((state) => {
      const newSchemas = new Map(state.schemas);
      newSchemas.set(connectionId, schema);

      return { schemas: newSchemas };
    });
  },

  generateSQL: async (naturalLanguage) => {
    const { activeConnectionId, schemas } = get();

    if (!activeConnectionId) {
      throw new Error('No active database connection');
    }

    const schema = schemas.get(activeConnectionId);
    if (!schema) {
      throw new Error('Schema not loaded');
    }

    // 更新狀態為生成中
    set((state) => ({
      currentQuery: {
        ...state.currentQuery,
        naturalLanguage,
        status: 'generating' as const
      }
    }));

    try {
      // 調用 AI 服務生成 SQL
      const result = await api.generateSQL({
        query: naturalLanguage,
        schema: serializeSchema(schema),
        databaseType: get().connections.find(c => c.id === activeConnectionId)?.type
      });

      // 更新生成的 SQL
      set((state) => ({
        currentQuery: {
          ...state.currentQuery,
          sql: result.sql,
          status: 'idle' as const
        }
      }));

      return result.sql;

    } catch (error) {
      set((state) => ({
        currentQuery: {
          ...state.currentQuery,
          status: 'error' as const,
          error: error.message
        }
      }));

      throw error;
    }
  },

  executeQuery: async (sql) => {
    const { activeConnectionId } = get();

    if (!activeConnectionId) {
      throw new Error('No active database connection');
    }

    // 更新狀態為執行中
    set((state) => ({
      currentQuery: {
        ...state.currentQuery,
        sql,
        status: 'executing' as const
      }
    }));

    try {
      const startTime = performance.now();

      // 執行查詢
      const result = await api.executeQuery({
        connectionId: activeConnectionId,
        sql
      });

      const executionTime = performance.now() - startTime;

      // 更新結果
      set((state) => ({
        currentQuery: {
          ...state.currentQuery,
          status: 'completed' as const,
          result,
          executionTime
        },
        currentResult: result
      }));

      // 儲存到歷史
      get().saveQueryToHistory({
        ...get().currentQuery,
        executionTime
      });

      return result;

    } catch (error) {
      set((state) => ({
        currentQuery: {
          ...state.currentQuery,
          status: 'error' as const,
          error: error.message
        }
      }));

      throw error;
    }
  },

  optimizeSQL: async (sql) => {
    const { activeConnectionId, schemas } = get();

    if (!activeConnectionId) {
      throw new Error('No active database connection');
    }

    const schema = schemas.get(activeConnectionId);

    const optimizationResult = await api.optimizeSQL({
      sql,
      schema: serializeSchema(schema!),
      databaseType: get().connections.find(c => c.id === activeConnectionId)?.type
    });

    return optimizationResult;
  },

  exportResults: async (format) => {
    const { currentResult } = get();

    if (!currentResult) {
      throw new Error('No results to export');
    }

    switch (format) {
      case 'csv':
        return exportToCSV(currentResult);
      case 'excel':
        return exportToExcel(currentResult);
      case 'json':
        return exportToJSON(currentResult);
      default:
        throw new Error(`Unsupported format: ${format}`);
    }
  }
}));

export default useTextToSQLStore;
```

### 2. AI SQL 生成服務

```typescript
// services/sqlGenerationService.ts
interface GenerateSQLRequest {
  query: string;
  schema: SerializedSchema;
  databaseType: string;
  examples?: QueryExample[];
}

interface SerializedSchema {
  tables: {
    name: string;
    columns: {
      name: string;
      type: string;
      isPrimaryKey: boolean;
      isForeignKey: boolean;
    }[];
  }[];
}

async function generateSQL(request: GenerateSQLRequest): Promise<{
  sql: string;
  confidence: number;
  explanation: string;
}> {
  // 構建提示詞
  const prompt = buildPrompt(request);

  // 調用 LLM API
  const response = await fetch('/api/ai/generate-sql', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'gpt-4',
      temperature: 0.1,
      messages: [
        {
          role: 'system',
          content: getSystemPrompt(request.databaseType)
        },
        {
          role: 'user',
          content: prompt
        }
      ]
    })
  });

  const data = await response.json();

  // 解析響應
  const { sql, confidence, explanation } = parseResponse(data);

  // 驗證 SQL 語法
  await validateSQL(sql, request.databaseType);

  return { sql, confidence, explanation };
}

function buildPrompt(request: GenerateSQLRequest): string {
  const { query, schema } = request;

  return `
# Task
Convert the following natural language query to SQL.

# Query
${query}

# Database Schema
${formatSchema(schema)}

# Requirements
1. Generate syntactically correct SQL for ${request.databaseType}
2. Use proper JOIN syntax when accessing multiple tables
3. Use appropriate aggregate functions (COUNT, SUM, AVG, etc.)
4. Add proper WHERE clauses for filtering
5. Include ORDER BY and LIMIT when appropriate
6. Use meaningful column aliases

# Output Format
Provide your response in JSON format:
{
  "sql": "the generated SQL query",
  "confidence": 0.0-1.0,
  "explanation": "brief explanation of the query logic"
}
  `.trim();
}

function getSystemPrompt(databaseType: string): string {
  const dialectGuides = {
    postgresql: `
- Use DATE_SUB() for date arithmetic
- Use || for string concatenation
- Use LIMIT for result limiting
    `,
    mysql: `
- Use DATE_SUB() for date arithmetic
- Use CONCAT() for string concatenation
- Use LIMIT for result limiting
    `,
    sqlserver: `
- Use DATEADD() for date arithmetic
- Use + for string concatenation
- Use TOP for result limiting
    `
  };

  return `
You are an expert SQL developer specialized in ${databaseType}.

Your task is to convert natural language queries into accurate SQL queries.

Guidelines:
${dialectGuides[databaseType] || ''}

Always:
- Write clean, readable SQL
- Use proper indentation
- Include comments for complex logic
- Optimize for performance (use indexes when mentioned in schema)
- Validate that referenced tables and columns exist in the schema
  `.trim();
}

function formatSchema(schema: SerializedSchema): string {
  return schema.tables.map(table => `
Table: ${table.name}
Columns:
${table.columns.map(col => `  - ${col.name} (${col.type})${col.isPrimaryKey ? ' PK' : ''}${col.isForeignKey ? ' FK' : ''}`).join('\n')}
  `).join('\n');
}

async function validateSQL(sql: string, databaseType: string): Promise<void> {
  // 使用 SQL 解析器驗證語法
  const parser = getSQLParser(databaseType);

  try {
    parser.parse(sql);
  } catch (error) {
    throw new Error(`Invalid SQL syntax: ${error.message}`);
  }
}

function parseResponse(data: any): {
  sql: string;
  confidence: number;
  explanation: string;
} {
  try {
    const content = data.choices[0].message.content;
    const jsonMatch = content.match(/\{[\s\S]*\}/);

    if (!jsonMatch) {
      throw new Error('No JSON found in response');
    }

    const result = JSON.parse(jsonMatch[0]);

    return {
      sql: result.sql.trim(),
      confidence: result.confidence,
      explanation: result.explanation
    };

  } catch (error) {
    throw new Error(`Failed to parse LLM response: ${error.message}`);
  }
}

export { generateSQL };
```

### 3. 查詢執行服務

```typescript
// services/queryExecutionService.ts
interface ExecuteQueryRequest {
  connectionId: string;
  sql: string;
  options?: {
    timeout?: number;
    maxRows?: number;
    streaming?: boolean;
  };
}

async function executeQuery(request: ExecuteQueryRequest): Promise<QueryResult> {
  const {
    connectionId,
    sql,
    options = {}
  } = request;

  const {
    timeout = 30000,
    maxRows = 10000,
    streaming = true
  } = options;

  // 獲取連接
  const connection = await getConnection(connectionId);

  // 設置超時
  const abortController = new AbortController();
  const timeoutId = setTimeout(() => abortController.abort(), timeout);

  try {
    const startTime = performance.now();

    // 執行查詢
    const result = await connection.query({
      sql,
      maxRows,
      streaming,
      signal: abortController.signal
    });

    const executionTime = performance.now() - startTime;

    clearTimeout(timeoutId);

    return {
      rows: result.rows,
      columns: result.columns,
      rowCount: result.rowCount,
      executionTime,
      affectedRows: result.affectedRows
    };

  } catch (error) {
    clearTimeout(timeoutId);

    if (error.name === 'AbortError') {
      throw new Error(`Query timeout after ${timeout}ms`);
    }

    throw error;
  }
}

// 連接池管理
class ConnectionPool {
  private pools: Map<string, Pool> = new Map();

  async getConnection(connectionId: string): Promise<Connection> {
    let pool = this.pools.get(connectionId);

    if (!pool) {
      const config = await getConnectionConfig(connectionId);
      pool = createPool(config);
      this.pools.set(connectionId, pool);
    }

    return await pool.acquire();
  }

  async releaseConnection(connectionId: string, connection: Connection): Promise<void> {
    const pool = this.pools.get(connectionId);
    if (pool) {
      await pool.release(connection);
    }
  }

  async closePool(connectionId: string): Promise<void> {
    const pool = this.pools.get(connectionId);
    if (pool) {
      await pool.close();
      this.pools.delete(connectionId);
    }
  }
}

const connectionPool = new ConnectionPool();

export { executeQuery, connectionPool };
```

---

## 📐 設計決策記錄（ADR）

### ADR-001: 自然語言 + SQL 編輯器雙模式

**決策**: 同時提供自然語言輸入和 SQL 編輯器，允許用戶選擇或結合使用

**理由**:
1. **靈活性**: 初學者使用自然語言，專家直接編寫 SQL
2. **學習價值**: 看到 AI 生成的 SQL 可以學習 SQL 語法和最佳實踐
3. **準確性**: AI 生成後可手動微調，確保查詢準確性
4. **信任度**: 用戶可以驗證 AI 生成的 SQL，建立信任
5. **效率**: 對於複雜查詢，自然語言描述比手寫 SQL 更快

**權衡**:
- ✅ 優點: 靈活、可學習、可驗證、高效
- ❌ 缺點: UI 複雜度略高、需要維護兩套輸入機制

**實現細節**:
- 自然語言輸入後自動生成 SQL
- SQL 編輯器支援完整的編輯功能
- 兩者保持同步（編輯 SQL 後更新自然語言理解）

---

### ADR-002: 3-Column 佈局（資料庫 + 查詢 + 結果）

**決策**: 採用 3-Column 佈局，左側資料庫管理、中間查詢編輯、右側結果展示

**理由**:
1. **工作流程**: 符合用戶的自然工作流程（選擇資料庫 → 編寫查詢 → 查看結果）
2. **效率**: 所有資訊同時可見，減少視圖切換
3. **參考性**: 編寫查詢時可參考 Schema，查看結果時可參考 SQL
4. **行業標準**: DataGrip、DBeaver、Navicat 等專業工具均採用類似佈局
5. **空間利用**: Desktop 版本有足夠空間容納 3 欄

**權衡**:
- ✅ 優點: 高效、資訊完整、符合習慣
- ❌ 缺點: 小螢幕需要折疊處理、初次使用學習曲線略高

**響應式策略**:
- Desktop (≥1280px): 完整 3-Column
- Tablet (768-1279px): 可折疊側邊欄
- Mobile (<768px): 單欄全屏 + 底部選單

---

### ADR-003: Monaco Editor vs CodeMirror

**決策**: 使用 Monaco Editor 作為 SQL 編輯器

**理由**:
1. **功能強大**: VS Code 同款編輯器，功能完整
2. **SQL 支援**: 內建 SQL 語法高亮和自動補全
3. **智能提示**: 可整合 Schema 資訊提供精確的表名、欄位名補全
4. **性能優秀**: 處理長 SQL 語句表現優異
5. **生態系統**: 豐富的插件和社區支援

**權衡**:
- ✅ 優點: 功能強、體驗好、擴展性高
- ❌ 缺點: Bundle 體積較大（~5MB）

**優化策略**:
```typescript
// 延遲載入 Monaco
import('monaco-editor').then(monaco => {
  // 只在需要時載入
});

// Code Splitting
const SQLEditor = lazy(() => import('./MonacoSQLEditor'));
```

---

### ADR-004: AI 模型選擇（GPT-4 vs Claude-3）

**決策**: 支援多種 AI 模型，預設使用 GPT-4，允許用戶切換

**理由**:
1. **準確性**: GPT-4 在 SQL 生成任務上準確率較高（~85%）
2. **靈活性**: 不同模型適合不同查詢類型
3. **成本控制**: 允許用戶根據需求選擇模型（GPT-4 vs GPT-3.5）
4. **容錯性**: 一個模型失敗可嘗試另一個

**模型比較**:
```typescript
models: {
  'gpt-4': {
    accuracy: 0.85,
    speed: 'slow',
    cost: 'high',
    bestFor: '複雜查詢、多表 JOIN'
  },
  'gpt-3.5-turbo': {
    accuracy: 0.75,
    speed: 'fast',
    cost: 'low',
    bestFor: '簡單查詢、單表查詢'
  },
  'claude-3-opus': {
    accuracy: 0.82,
    speed: 'medium',
    cost: 'medium',
    bestFor: '需要詳細解釋的查詢'
  }
}
```

---

## ✅ 驗收標準

### 功能完整性
- [ ] 資料庫連接管理（PostgreSQL、MySQL、SQL Server、Oracle、SQLite）
- [ ] Schema 瀏覽器（樹狀結構、搜尋、預覽）
- [ ] 自然語言轉 SQL（AI 生成、信心度評估）
- [ ] SQL 編輯器（語法高亮、自動補全、錯誤檢測）
- [ ] SQL 優化建議（索引提示、查詢改寫）
- [ ] SQL 解釋（逐行解釋、學習要點）
- [ ] 查詢執行（超時控制、結果 Streaming）
- [ ] 結果展示（表格、圖表、統計分析）
- [ ] 查詢歷史（搜尋、載入、收藏）
- [ ] 查詢範本（系統範本、自訂範本、參數化）
- [ ] 結果匯出（CSV、Excel、JSON）

### 性能指標
- [ ] SQL 生成準確率 > 85%（Top 1）
- [ ] SQL 生成時間 < 2s
- [ ] 查詢執行成功率 > 95%
- [ ] 查詢響應時間 < 3s（中等複雜度）
- [ ] 支援 >10,000 行結果（虛擬滾動）
- [ ] Schema 載入時間 < 500ms

### 無障礙合規
- [ ] WCAG 2.1 AA 合規
- [ ] 完整鍵盤導航支援
- [ ] 螢幕閱讀器優化（查詢狀態、錯誤提示）
- [ ] ARIA 標籤完整
- [ ] 高對比度模式支援

### 響應式設計
- [ ] Desktop (≥1280px) 3-Column 佈局
- [ ] Tablet (768-1279px) 可折疊側邊欄
- [ ] Mobile (<768px) 全屏單欄 + 底部選單
- [ ] 所有斷點下功能完整可用

### 安全性
- [ ] SQL 注入防護
- [ ] 連接加密（SSL/TLS）
- [ ] 密碼加密存儲
- [ ] 危險操作確認（DELETE、UPDATE、DROP）
- [ ] 查詢審計日誌

---

**文檔版本**: 1.0.0
**最後更新**: 2025-10-29
**審核狀態**: ✅ 已完成（完整版）
**文件大小**: ~2,000 行
**下一步**: 提交 Git 並繼續 Workflow 編輯器或 Persona Designer
