# Knowledge Base Wireframe

**版本**: 1.0.0
**日期**: 2025-10-29
**狀態**: ✅ 已完成
**複雜度**: ⭐⭐⭐ (中等)

---

## 📋 頁面概覽

### 目的
提供 RAG（檢索增強生成）知識庫的完整管理功能，包括文件上傳、向量化處理、知識片段管理、向量搜尋測試和與 Agent 的整合。

### 目標用戶
- **Alex（IT 開發者）**: 測試 RAG 效果、調整向量參數、除錯搜尋結果
- **Sarah（業務分析師）**: 上傳業務文件、管理知識庫、驗證搜尋準確度
- **David（企業管理員）**: 監控知識庫使用量、管理存儲空間、控制存取權限

### 成功指標
- 文件上傳成功率 > 99%
- 向量化處理時間 < 30s/MB
- 搜尋響應時間 < 500ms
- 搜尋準確率 > 85%（Top 3）
- 用戶滿意度評分 > 4.5/5

---

## 🖥️ Desktop 版本佈局（≥1280px）

### 列表視圖（Knowledge Bases List）

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ ← Back   [📚 Knowledge Bases] [知識庫列表]                  ⚙️ 🔔 👤 Alex          │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  📚 Knowledge Bases                                      [ + 創建知識庫 ] [⚙️ 設定]  │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ 🔍 搜尋知識庫...                                    📁 全部 | 🤖 已關聯 | 📦 未使用 │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ 📚 Customer Support Knowledge                       🟢 就緒                    │ │
│  │                                                                              │ │
│  │ 包含客戶支援常見問題、產品文件、故障排除指南                                    │ │
│  │                                                                              │ │
│  │ 📊 統計：                                                                     │ │
│  │ • 文件數：125 個 • Chunks：2,456 • 向量數：2,456 • 總大小：245 MB            │ │
│  │ • 最後更新：2 小時前 • 創建於：2025-10-15                                     │ │
│  │                                                                              │ │
│  │ 🤖 關聯 Agent (3)：                                                           │ │
│  │ [Customer Service Bot] [FAQ Bot] [Troubleshooting Assistant]                │ │
│  │                                                                              │ │
│  │ [📂 查看詳情] [📤 匯出] [✏️ 編輯] [🗑️ 刪除]                    [⋮ 更多]         │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ 📚 Product Documentation                            🟡 處理中 (45%)           │ │
│  │                                                                              │ │
│  │ 產品技術文件、API 參考、使用手冊                                               │ │
│  │                                                                              │ │
│  │ 📊 統計：                                                                     │ │
│  │ • 文件數：67 個 • Chunks：892 (處理中) • 向量數：892 • 總大小：156 MB         │ │
│  │ • 處理進度：████████████░░░░░░░░ 45% (預計剩餘 5 分鐘)                        │ │
│  │                                                                              │ │
│  │ 🤖 關聯 Agent (1)：                                                           │ │
│  │ [Product Assistant]                                                          │ │
│  │                                                                              │ │
│  │ [📂 查看詳情] [⏸️ 暫停處理] [✏️ 編輯]                          [⋮ 更多]         │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ 📚 Internal Policies                                🔴 錯誤                   │ │
│  │                                                                              │ │
│  │ 公司內部政策、流程文件、員工手冊                                               │ │
│  │                                                                              │ │
│  │ ❌ 處理錯誤：3 個文件向量化失敗                                                │ │
│  │ • invoice_template.pdf - 格式不支援                                           │ │
│  │ • policy_v2.docx - 檔案損壞                                                  │ │
│  │ • handbook.pdf - 超過大小限制 (50MB)                                          │ │
│  │                                                                              │ │
│  │ 📊 統計：                                                                     │ │
│  │ • 文件數：45 個 (3 個失敗) • Chunks：678 • 向量數：678 • 總大小：98 MB        │ │
│  │                                                                              │ │
│  │ [📂 查看詳情] [🔄 重試失敗] [✏️ 編輯] [🗑️ 刪除]                [⋮ 更多]         │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ 📚 Sales Training Materials                         ⚪ 未使用                 │ │
│  │                                                                              │ │
│  │ 銷售培訓資料、產品介紹、競爭分析                                               │ │
│  │                                                                              │ │
│  │ 📊 統計：                                                                     │ │
│  │ • 文件數：32 個 • Chunks：456 • 向量數：456 • 總大小：67 MB                  │ │
│  │ • 最後更新：1 週前 • 創建於：2025-10-10                                       │ │
│  │                                                                              │ │
│  │ 🤖 關聯 Agent (0)：                                                           │ │
│  │ [+ 關聯到 Agent]                                                             │ │
│  │                                                                              │ │
│  │ [📂 查看詳情] [📤 匯出] [✏️ 編輯] [🗑️ 刪除]                    [⋮ 更多]         │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  [ 載入更多... ]                                                                   │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 詳情視圖（Knowledge Base Detail）- 3-Tab Layout

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ ← 返回列表   [📚 Customer Support Knowledge] [知識庫詳情]       ⚙️ 🔔 👤 Alex      │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  📚 Customer Support Knowledge                  🟢 就緒            [✏️ 編輯] [🗑️ 刪除]│
│  包含客戶支援常見問題、產品文件、故障排除指南                                        │
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │ 📊 總覽 | 📁 文件 | 🔍 搜尋測試                    ← Tabs                     │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                     │
├──────────────────────────────────────────────────────┬──────────────────────────────┤
│                                                      │                              │
│  Tab 1: 📊 總覽                                      │  📊 統計資訊                 │
│                                                      │                              │
│  📈 知識庫統計                                       │  ┌──────────────────────────┐│
│  ┌────────────────────────────────────────────────┐ │  │ 📁 文件數                ││
│  │ 📁 文件總數        125 個                      │ │  │ ┌──────────────────────┐││
│  │ 📄 Chunks 總數     2,456 個                    │ │  │ │       125            │││
│  │ 🔢 向量數          2,456 個                    │ │  │ │   ████████████       │││
│  │ 💾 總大小          245 MB                      │ │  │ └──────────────────────┘││
│  │ 📅 最後更新        2 小時前                    │ │  │                          ││
│  │ 🗓️ 創建日期        2025-10-15                  │ │  │ 📈 Chunks 成長趨勢      ││
│  └────────────────────────────────────────────────┘ │  │ [折線圖顯示]            ││
│                                                      │  │                          ││
│  🤖 關聯的 Agents (3)                               │  │ 🔍 搜尋使用統計          ││
│  ┌────────────────────────────────────────────────┐ │  │ • 總搜尋次數：12,345    ││
│  │ [🤖 Customer Service Bot]         [查看] [移除]│ │  │ • 平均響應時間：320ms   ││
│  │ 使用此知識庫回答客戶問題                       │ │  │ • 搜尋準確率：87%       ││
│  │ 最後使用：10 分鐘前                            │ │  └──────────────────────────┘│
│  ├────────────────────────────────────────────────┤ │                              │
│  │ [🤖 FAQ Bot]                      [查看] [移除]│ │  💾 存儲使用量               │
│  │ 快速回答常見問題                               │ │  ┌──────────────────────────┐│
│  │ 最後使用：1 小時前                             │ │  │ 245 MB / 1 GB            ││
│  │ ├────────────────────────────────────────────────┤ │  │ ████████░░░░░░░░ 24.5%  ││
│  │ [🤖 Troubleshooting Assistant]    [查看] [移除]│ │  └──────────────────────────┘│
│  │ 協助故障排除與技術支援                         │ │                              │
│  │ 最後使用：3 小時前                             │ │  🔧 向量化設定               │
│  └────────────────────────────────────────────────┘ │  ┌──────────────────────────┐│
│                                                      │  │ • 模型：text-embedding-3││
│  [ + 關聯新 Agent ]                                 │  │ • Chunk 大小：512        ││
│                                                      │  │ • Overlap：128          ││
│  📁 檔案類型分布                                    │  │ • 向量維度：1536        ││
│  ┌────────────────────────────────────────────────┐ │  │                          ││
│  │ PDF          45% ████████████                  │ │  │ [查看詳細設定]           ││
│  │ DOCX         30% ████████                      │ │  └──────────────────────────┘│
│  │ TXT          15% ████                          │ │                              │
│  │ XLSX          8% ██                            │ │                              │
│  │ 其他          2% ▌                             │ │                              │
│  └────────────────────────────────────────────────┘ │                              │
│                                                      │                              │
│  🕐 活動歷史                                         │                              │
│  ┌────────────────────────────────────────────────┐ │                              │
│  │ 📤 上傳了 15 個文件            2 小時前         │ │                              │
│  │ 🔄 重新向量化 "faq_v2.pdf"     5 小時前         │ │                              │
│  │ ✏️ 編輯知識庫描述              1 天前           │ │                              │
│  │ 🤖 關聯到 "FAQ Bot"            2 天前           │ │                              │
│  │ ⋮                                              │ │                              │
│  └────────────────────────────────────────────────┘ │                              │
│                                                      │                              │
└──────────────────────────────────────────────────────┴──────────────────────────────┘
```

### Tab 2: 📁 文件管理

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│  Tab 2: 📁 文件                                                                     │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ 🔍 搜尋文件...                                         [📤 上傳文件] [📁 批次操作]│ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  篩選：📁 全部 | ✅ 已處理 | 🔄 處理中 | ❌ 錯誤                                     │
│  排序：📅 最新上傳 | 📏 檔案大小 | 📄 檔案名稱                                      │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ ☐ 📄 customer_faq_v3.pdf                                       ✅ 已處理       │ │
│  │                                                                              │ │
│  │ 📊 資訊：                                                                     │ │
│  │ • 檔案大小：2.4 MB                                                           │ │
│  │ • 上傳時間：2 小時前                                                         │ │
│  │ • Chunks：45 個                                                              │ │
│  │ • 處理時間：12.5s                                                            │ │
│  │                                                                              │ │
│  │ 📑 Chunks 預覽：                                                              │ │
│  │ Chunk 1 (512 tokens): "客戶服務常見問題解答...本文檔包含最常見的 50 個問題..." │ │
│  │ Chunk 2 (512 tokens): "問題 1：如何重設密碼？答：請訪問登錄頁面..."           │ │
│  │ [查看全部 45 個 Chunks]                                                      │ │
│  │                                                                              │ │
│  │ [👁️ 預覽] [⬇️ 下載] [🔄 重新處理] [🗑️ 刪除]                    [⋮ 更多]       │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ ☐ 📄 product_manual_2025.docx                                  🔄 處理中 (67%)│ │
│  │                                                                              │ │
│  │ 📊 資訊：                                                                     │ │
│  │ • 檔案大小：5.6 MB                                                           │ │
│  │ • 上傳時間：30 分鐘前                                                        │ │
│  │ • Chunks：67 / 100 (處理中)                                                  │ │
│  │ • 處理進度：████████████████░░░░ 67% (預計剩餘 45 秒)                         │ │
│  │                                                                              │ │
│  │ [⏸️ 暫停] [⏹️ 停止]                                                           │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ ☐ 📄 troubleshooting_guide.pdf                                 ❌ 錯誤        │ │
│  │                                                                              │ │
│  │ ❌ 處理錯誤：檔案損壞，無法讀取內容                                            │ │
│  │                                                                              │ │
│  │ 📊 資訊：                                                                     │ │
│  │ • 檔案大小：1.2 MB                                                           │ │
│  │ • 上傳時間：1 小時前                                                         │ │
│  │ • 錯誤代碼：ERR_FILE_CORRUPT                                                 │ │
│  │                                                                              │ │
│  │ 💡 建議：請重新上傳此檔案，或嘗試使用其他格式                                 │ │
│  │                                                                              │ │
│  │ [🔄 重試] [📤 重新上傳] [🗑️ 刪除]                              [⋮ 更多]       │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  已選擇 0 個文件                                   [ 全選 ] [ 批次刪除 ] [ 批次處理 ]│
│                                                                                     │
│  [ 載入更多... ]                                             顯示 1-20 / 125 個文件│
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 文件上傳流程

```
Step 1: 點擊「上傳文件」
┌─────────────────────────────────────────────────┐
│ 📤 上傳文件到知識庫                             │
│                                                 │
│ ┌─────────────────────────────────────────────┐│
│ │                                             ││
│ │       📁 拖曳文件到此處                     ││
│ │          或點擊選擇文件                     ││
│ │                                             ││
│ │   支援格式：PDF, DOCX, TXT, MD, CSV, XLSX   ││
│ │   最大單檔：50 MB                           ││
│ │   最多同時上傳：20 個文件                   ││
│ │                                             ││
│ └─────────────────────────────────────────────┘│
│                                                 │
│ [ 選擇文件 ]                      [ 取消 ]      │
└─────────────────────────────────────────────────┘

Step 2: 選擇文件後
┌─────────────────────────────────────────────────┐
│ 📤 上傳文件 (3 個已選擇)                        │
│                                                 │
│ ┌─────────────────────────────────────────────┐│
│ │ ✅ customer_faq_v3.pdf        2.4 MB     [✕]││
│ │ ✅ product_manual_2025.docx   5.6 MB     [✕]││
│ │ ✅ troubleshooting.txt        456 KB     [✕]││
│ └─────────────────────────────────────────────┘│
│                                                 │
│ ⚙️ 處理選項：                                   │
│ ☑ 自動向量化                                   │
│ ☑ 檢測重複文件                                 │
│ ☐ 覆蓋同名文件                                 │
│                                                 │
│ 🔧 Chunk 設定：                                 │
│ • Chunk 大小：[512] tokens                     │
│ • Overlap：[128] tokens                        │
│                                                 │
│ 預計處理時間：約 2 分鐘                         │
│ 預計增加：約 150 個 Chunks                      │
│                                                 │
│ [ 開始上傳 ]                      [ 取消 ]      │
└─────────────────────────────────────────────────┘

Step 3: 上傳中
┌─────────────────────────────────────────────────┐
│ ⬆️ 上傳中... (2/3 完成)                         │
│                                                 │
│ ✅ customer_faq_v3.pdf                          │
│    ████████████████████ 100%                   │
│    已上傳，正在向量化... ⏳                     │
│                                                 │
│ ✅ product_manual_2025.docx                     │
│    ████████████████████ 100%                   │
│    向量化完成 ✅                                │
│                                                 │
│ 🔄 troubleshooting.txt                          │
│    ████████████░░░░░░░░ 65%                    │
│    上傳中... 298 KB / 456 KB                    │
│                                                 │
│ [ 取消全部 ]                                    │
└─────────────────────────────────────────────────┘

Step 4: 完成
┌─────────────────────────────────────────────────┐
│ ✅ 上傳完成                                     │
│                                                 │
│ 📊 處理結果：                                   │
│ • 成功上傳：3 個文件                            │
│ • 成功向量化：3 個文件                          │
│ • 生成 Chunks：152 個                           │
│ • 生成向量：152 個                              │
│ • 總處理時間：1 分 45 秒                        │
│                                                 │
│ [ 查看文件 ]              [ 關閉 ]              │
└─────────────────────────────────────────────────┘
```

### Tab 3: 🔍 搜尋測試

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│  Tab 3: 🔍 搜尋測試                                                                 │
│                                                                                     │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │ 🔍 輸入測試查詢...                                          [ 🔍 搜尋 ]          │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                     │
│  ⚙️ 搜尋設定：                                                                      │
│  • Top K：[5] ▾  • 相似度閾值：[0.7] ━━━━●━━━  • 重排序：☑ 啟用                    │
│  • 混合搜尋：☑ 向量 + 關鍵字  • 過濾：📁 全部文件                                   │
│                                                                                     │
├──────────────────────────────────────────────────────┬──────────────────────────────┤
│                                                      │                              │
│  🔍 查詢：「如何重設密碼？」                         │  📊 搜尋效能                 │
│  ⏱️ 響應時間：287ms                                  │  ┌──────────────────────────┐│
│  📊 找到 5 個相關 Chunks                             │  │ ⏱️ 響應時間              ││
│                                                      │  │ 287ms                    ││
│  ┌────────────────────────────────────────────────┐ │  │ (良好 < 500ms)           ││
│  │ Chunk 1                      ⭐ 0.92 (最相關)  │ │  │                          ││
│  │ 📄 來源：customer_faq_v3.pdf (第 5 頁)         │ │  │ 🎯 相似度分布            ││
│  │                                                │ │  │ [0.9-1.0] ██ 1           ││
│  │ 問題：如何重設密碼？                           │ │  │ [0.8-0.9] ███ 2          ││
│  │                                                │ │  │ [0.7-0.8] ██ 2           ││
│  │ 答：請訪問登錄頁面，點擊「忘記密碼」連結。     │ │  │ [< 0.7] ░ 0              ││
│  │ 輸入您的註冊郵箱，系統將發送重設連結到您的     │ │  └──────────────────────────┘│
│  │ 郵箱。連結有效期為 24 小時...                  │ │                              │
│  │                                                │ │  💾 向量庫狀態               │
│  │ [👁️ 查看完整 Chunk] [📄 開啟來源文件]          │ │  ┌──────────────────────────┐│
│  └────────────────────────────────────────────────┘ │  │ ✅ 就緒                  ││
│                                                      │  │ • 索引數：2,456          ││
│  ┌────────────────────────────────────────────────┐ │  │ • 維度：1536             ││
│  │ Chunk 2                      ⭐ 0.88           │ │  │ • 更新時間：2 小時前     ││
│  │ 📄 來源：account_management.pdf (第 12 頁)     │ │  └──────────────────────────┘│
│  │                                                │ │                              │
│  │ 帳戶安全設定                                   │ │  🧪 測試案例                 │
│  │                                                │ │  ┌──────────────────────────┐│
│  │ 為了確保帳戶安全，我們建議定期更換密碼。       │ │  │ 已儲存的測試查詢：       ││
│  │ 您可以在「帳戶設定 > 安全性」中修改密碼...     │ │  │                          ││
│  │                                                │ │  │ • 如何重設密碼？         ││
│  │ [👁️ 查看完整 Chunk] [📄 開啟來源文件]          │ │  │ • 產品退貨流程           ││
│  └────────────────────────────────────────────────┘ │  │ • 聯絡客服方式           ││
│                                                      │  │ • 訂單追蹤               ││
│  ┌────────────────────────────────────────────────┐ │  │                          ││
│  │ Chunk 3                      ⭐ 0.85           │ │  │ [ + 儲存當前查詢 ]       ││
│  │ 📄 來源：security_guide.pdf (第 3 頁)         │ │  │ [ 批次測試 ]             ││
│  │                                                │ │  └──────────────────────────┘│
│  │ 密碼安全最佳實踐                               │ │                              │
│  │ ...                                            │ │                              │
│  └────────────────────────────────────────────────┘ │                              │
│                                                      │                              │
│  ⋮ (顯示全部 5 個結果)                               │                              │
│                                                      │                              │
│  [ 匯出結果 ]  [ 重新搜尋 ]  [ 調整參數 ]            │                              │
│                                                      │                              │
└──────────────────────────────────────────────────────┴──────────────────────────────┘
```

---

## 📊 內容層級（Desktop）

### Level 1: 頁面結構

```
知識庫列表視圖：
┌─────────────────────────────┐
│ 頁面標題 + 操作              │
│ 搜尋與篩選                  │
│ 知識庫卡片列表              │
│ • Customer Support KB       │
│ • Product Documentation     │
│ • Internal Policies         │
│ ⋮                           │
└─────────────────────────────┘

知識庫詳情視圖（3-Tab）：
┌──────────────┬──────────────┐
│ 左側主內容   │ 右側統計面板 │
│              │              │
│ Tab 1: 總覽  │ • 統計圖表   │
│ Tab 2: 文件  │ • 存儲使用   │
│ Tab 3: 搜尋  │ • 向量設定   │
│              │ • 效能監控   │
└──────────────┴──────────────┘
```

### Level 2: 知識庫卡片（列表視圖）

```
┌──────────────────────────────────────────────────┐
│ 📚 [知識庫名稱]                    [狀態指示]    │ ← 標題與狀態
│                                                  │
│ [描述文字]                                       │ ← 簡短描述
│                                                  │
│ 📊 統計：                                        │ ← 統計資訊
│ • 文件數：125 • Chunks：2,456 • 大小：245 MB    │
│ • 最後更新：2 小時前                             │
│                                                  │
│ 🤖 關聯 Agent (3)：                              │ ← 關聯 Agents
│ [Agent 1] [Agent 2] [Agent 3]                   │
│                                                  │
│ [操作按鈕...]                          [⋮ 更多]  │ ← 操作區域
└──────────────────────────────────────────────────┘

狀態指示：
🟢 就緒       - 所有文件已處理完成
🟡 處理中     - 正在向量化文件
🔴 錯誤       - 處理過程中發生錯誤
⚪ 未使用     - 尚未關聯到任何 Agent
```

### Level 3: Tab 1 - 總覽

#### 知識庫統計卡片
```
┌────────────────────────────────────────────────┐
│ 📈 知識庫統計                                  │
│ ┌────────────────────────────────────────────┐│
│ │ 📁 文件總數        125 個                  ││
│ │ 📄 Chunks 總數     2,456 個                ││
│ │ 🔢 向量數          2,456 個                ││
│ │ 💾 總大小          245 MB                  ││
│ │ 📅 最後更新        2 小時前                ││
│ │ 🗓️ 創建日期        2025-10-15              ││
│ └────────────────────────────────────────────┘│
└────────────────────────────────────────────────┘
```

#### 關聯的 Agents
```
┌────────────────────────────────────────────────┐
│ 🤖 關聯的 Agents (3)                           │
│                                                │
│ ┌────────────────────────────────────────────┐│
│ │ [🤖 Customer Service Bot]   [查看] [移除]  ││
│ │ 使用此知識庫回答客戶問題                   ││
│ │ 最後使用：10 分鐘前                        ││
│ ├────────────────────────────────────────────┤│
│ │ [🤖 FAQ Bot]                [查看] [移除]  ││
│ │ 快速回答常見問題                           ││
│ │ 最後使用：1 小時前                         ││
│ └────────────────────────────────────────────┘│
│                                                │
│ [ + 關聯新 Agent ]                             │
└────────────────────────────────────────────────┘
```

#### 檔案類型分布
```
┌────────────────────────────────────────────────┐
│ 📁 檔案類型分布                                │
│                                                │
│ PDF          45% ████████████                 │
│ DOCX         30% ████████                     │
│ TXT          15% ████                         │
│ XLSX          8% ██                           │
│ 其他          2% ▌                            │
└────────────────────────────────────────────────┘
```

#### 活動歷史
```
┌────────────────────────────────────────────────┐
│ 🕐 活動歷史                                    │
│                                                │
│ 📤 上傳了 15 個文件            2 小時前        │
│ 🔄 重新向量化 "faq_v2.pdf"     5 小時前        │
│ ✏️ 編輯知識庫描述              1 天前          │
│ 🤖 關聯到 "FAQ Bot"            2 天前          │
│ ⋮                                              │
└────────────────────────────────────────────────┘
```

### Level 4: Tab 2 - 文件管理

#### 文件列表項目
```
┌──────────────────────────────────────────────────────────┐
│ ☐ 📄 customer_faq_v3.pdf                   ✅ 已處理     │ ← 選擇框 + 檔名 + 狀態
│                                                          │
│ 📊 資訊：                                                │ ← 文件資訊
│ • 檔案大小：2.4 MB                                       │
│ • 上傳時間：2 小時前                                     │
│ • Chunks：45 個                                          │
│ • 處理時間：12.5s                                        │
│                                                          │
│ 📑 Chunks 預覽：                                         │ ← Chunks 預覽
│ Chunk 1 (512 tokens): "客戶服務常見問題..."             │
│ Chunk 2 (512 tokens): "問題 1：如何重設密碼？..."        │
│ [查看全部 45 個 Chunks]                                  │
│                                                          │
│ [👁️ 預覽] [⬇️ 下載] [🔄 重新處理] [🗑️ 刪除]  [⋮ 更多]   │ ← 操作按鈕
└──────────────────────────────────────────────────────────┘

處理狀態：
✅ 已處理    - 向量化完成，可供搜尋
🔄 處理中    - 正在向量化，顯示進度
❌ 錯誤      - 處理失敗，顯示錯誤訊息
⏳ 排隊中    - 等待處理
```

#### 處理中狀態
```
┌──────────────────────────────────────────────────────────┐
│ ☐ 📄 product_manual_2025.docx              🔄 處理中 (67%)│
│                                                          │
│ 📊 資訊：                                                │
│ • 檔案大小：5.6 MB                                       │
│ • 上傳時間：30 分鐘前                                    │
│ • Chunks：67 / 100 (處理中)                              │
│ • 處理進度：████████████████░░░░ 67% (預計剩餘 45 秒)    │
│                                                          │
│ [⏸️ 暫停] [⏹️ 停止]                                       │
└──────────────────────────────────────────────────────────┘
```

#### 錯誤狀態
```
┌──────────────────────────────────────────────────────────┐
│ ☐ 📄 troubleshooting_guide.pdf             ❌ 錯誤       │
│                                                          │
│ ❌ 處理錯誤：檔案損壞，無法讀取內容                      │
│                                                          │
│ 📊 資訊：                                                │
│ • 檔案大小：1.2 MB                                       │
│ • 上傳時間：1 小時前                                     │
│ • 錯誤代碼：ERR_FILE_CORRUPT                             │
│                                                          │
│ 💡 建議：請重新上傳此檔案，或嘗試使用其他格式            │
│                                                          │
│ [🔄 重試] [📤 重新上傳] [🗑️ 刪除]            [⋮ 更多]    │
└──────────────────────────────────────────────────────────┘
```

### Level 5: Tab 3 - 搜尋測試

#### 搜尋配置
```
⚙️ 搜尋設定：
┌────────────────────────────────────────────────┐
│ • Top K：[5] ▾                                 │ ← 返回結果數量
│ • 相似度閾值：[0.7] ━━━━●━━━                   │ ← Slider
│ • 重排序：☑ 啟用                               │ ← Reranking
│ • 混合搜尋：☑ 向量 + 關鍵字                    │ ← Hybrid search
│ • 過濾：📁 全部文件 ▾                          │ ← 文件過濾器
└────────────────────────────────────────────────┘
```

#### 搜尋結果項目
```
┌────────────────────────────────────────────────┐
│ Chunk 1                      ⭐ 0.92 (最相關)  │ ← Chunk 編號 + 相似度分數
│ 📄 來源：customer_faq_v3.pdf (第 5 頁)         │ ← 來源文件
│                                                │
│ 問題：如何重設密碼？                           │ ← Chunk 內容預覽
│                                                │
│ 答：請訪問登錄頁面，點擊「忘記密碼」連結。     │
│ 輸入您的註冊郵箱，系統將發送重設連結到您的     │
│ 郵箱。連結有效期為 24 小時...                  │
│                                                │
│ [👁️ 查看完整 Chunk] [📄 開啟來源文件]          │ ← 操作按鈕
└────────────────────────────────────────────────┘
```

#### 搜尋效能監控
```
┌──────────────────────────────────┐
│ 📊 搜尋效能                      │
│                                  │
│ ⏱️ 響應時間                      │
│ 287ms                            │
│ (良好 < 500ms)                   │
│                                  │
│ 🎯 相似度分布                    │
│ [0.9-1.0] ██ 1                   │
│ [0.8-0.9] ███ 2                  │
│ [0.7-0.8] ██ 2                   │
│ [< 0.7] ░ 0                      │
└──────────────────────────────────┘
```

---

## 📱 Tablet 版本佈局（768px - 1279px）

### 列表視圖（可折疊篩選）

```
┌─────────────────────────────────────────────────────────┐
│ ☰  [📚 Knowledge Bases]              ⚙️ 🔔 👤 Alex     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  📚 Knowledge Bases              [ + 創建 ] [⚙️]        │
│                                                         │
│  [🔍 搜尋...]  [📁 全部 ▾]  [排序 ▾]                    │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │ 📚 Customer Support Knowledge      🟢 就緒        │ │
│  │                                                   │ │
│  │ 客戶支援常見問題、產品文件...                     │ │
│  │                                                   │ │
│  │ 📊 125 文件 • 2,456 Chunks • 245 MB              │ │
│  │ 🤖 3 個 Agents                                    │ │
│  │                                                   │ │
│  │ [📂 詳情] [✏️] [🗑️]                   [⋮]          │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ⋮                                                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 詳情視圖（堆疊式 Tab）

```
┌─────────────────────────────────────────────────────────┐
│ ← [Customer Support Knowledge]           ✏️ 🗑️          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  📚 Customer Support Knowledge          🟢 就緒         │
│  客戶支援常見問題、產品文件...                          │
│                                                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │ 📊 總覽 | 📁 文件 | 🔍 搜尋                        │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  📈 知識庫統計                                          │
│  ┌───────────────────────────────────────────────────┐ │
│  │ 📁 125 文件 • 📄 2,456 Chunks                     │ │
│  │ 💾 245 MB • 📅 2 小時前更新                       │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  🤖 關聯的 Agents (3)                                   │
│  [Customer Service Bot] [FAQ Bot] [...]                │
│                                                         │
│  📁 檔案類型                                            │
│  PDF 45% ████████ DOCX 30% ████ ...                    │
│                                                         │
│  [展開更多統計]                                         │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 📱 Mobile 版本佈局（<768px）

### 列表視圖

```
┌────────────────────────────────┐
│ ← [Knowledge Bases]      ⋮     │
├────────────────────────────────┤
│                                │
│  [🔍 搜尋...]                   │
│                                │
│  [📁 全部 ▾] [排序 ▾]          │
│                                │
│ ┌────────────────────────────┐│
│ │📚 Customer Support    🟢   ││
│ │                            ││
│ │客戶支援常見問題...          ││
│ │                            ││
│ │125 文件 • 245 MB           ││
│ │🤖 3 Agents                 ││
│ │                            ││
│ │[詳情] [⋮]                  ││
│ └────────────────────────────┘│
│                                │
│  ⋮                             │
│                                │
│ [ + 創建知識庫 ]               │
│                                │
└────────────────────────────────┘
```

### 詳情視圖（單 Tab 展開）

```
┌────────────────────────────────┐
│ ← Customer Support       ⋮     │
├────────────────────────────────┤
│                                │
│  📚 Customer Support           │
│  🟢 就緒                       │
│                                │
│  [📊 總覽] [📁 文件] [🔍 搜尋] │ ← Tab 切換
│                                │
│  📈 統計                       │
│  ┌──────────────────────────┐│
│  │ 📁 125 文件              ││
│  │ 📄 2,456 Chunks          ││
│  │ 💾 245 MB                ││
│  └──────────────────────────┘│
│                                │
│  🤖 Agents (3)                 │
│  [Customer Service] [...]      │
│                                │
│  📁 檔案類型                   │
│  PDF 45% ████                  │
│  DOCX 30% ███                  │
│                                │
│  [展開更多]                    │
│                                │
└────────────────────────────────┘
```

---

## 🎯 互動元素詳細說明

### 1. 創建知識庫流程

```
Step 1: 基本資訊
┌────────────────────────────────────┐
│ 📚 創建知識庫                      │
│                                    │
│ 知識庫名稱 *                       │
│ ┌────────────────────────────────┐│
│ │ Customer Support Knowledge     ││
│ └────────────────────────────────┘│
│                                    │
│ 描述                               │
│ ┌────────────────────────────────┐│
│ │ 包含客戶支援常見問題、         ││
│ │ 產品文件、故障排除指南...      ││
│ └────────────────────────────────┘│
│                                    │
│ 標籤（選填）                       │
│ ┌────────────────────────────────┐│
│ │ + 添加標籤                     ││
│ └────────────────────────────────┘│
│                                    │
│ [ 下一步 ]          [ 取消 ]       │
└────────────────────────────────────┘

Step 2: 向量化設定
┌────────────────────────────────────┐
│ 🔧 向量化設定                      │
│                                    │
│ Embedding 模型                     │
│ ● text-embedding-3-large (推薦)   │
│ ○ text-embedding-3-small          │
│ ○ text-embedding-ada-002          │
│                                    │
│ Chunk 設定                         │
│ • Chunk 大小：[512] tokens        │
│   ━━━━●━━━━━ (256-2048)           │
│                                    │
│ • Overlap：[128] tokens           │
│   ━━●━━━━━━━ (0-512)              │
│                                    │
│ 💡 建議：                          │
│ • 一般文件：512/128                │
│ • 長篇文章：1024/256               │
│ • 短問答：256/64                   │
│                                    │
│ [ 上一步 ]  [ 創建 ]  [ 取消 ]     │
└────────────────────────────────────┘

Step 3: 創建成功
┌────────────────────────────────────┐
│ ✅ 知識庫創建成功                  │
│                                    │
│ 📚 Customer Support Knowledge      │
│                                    │
│ 下一步操作：                       │
│ [ 上傳文件 ]                       │
│ [ 關聯到 Agent ]                   │
│ [ 查看詳情 ]                       │
│                                    │
│ [ 關閉 ]                           │
└────────────────────────────────────┘
```

### 2. 批次操作

```
文件選擇後：
┌────────────────────────────────────┐
│ 已選擇 3 個文件                    │
│                                    │
│ [ 批次下載 ]                       │
│ [ 批次重新處理 ]                   │
│ [ 批次刪除 ]                       │
│ [ 取消選擇 ]                       │
└────────────────────────────────────┘
```

### 3. Chunk 查看器

```
點擊「查看全部 Chunks」：
┌──────────────────────────────────────────────┐
│ 📄 customer_faq_v3.pdf - Chunks (45 個)      │
│                                              │
│ 🔍 搜尋 Chunks...                            │
│                                              │
│ ┌──────────────────────────────────────────┐│
│ │ Chunk 1 / 45                             ││
│ │                                          ││
│ │ 📊 資訊：                                 ││
│ │ • Tokens：512                            ││
│ │ • 位置：第 1 頁                          ││
│ │ • 向量 ID：vec_abc123                    ││
│ │                                          ││
│ │ 📝 內容：                                 ││
│ │ ┌──────────────────────────────────────┐││
│ │ │ 客戶服務常見問題解答                  │││
│ │ │                                      │││
│ │ │ 本文檔包含最常見的 50 個客戶問題及   │││
│ │ │ 標準回覆。請確保所有客服人員熟悉...   │││
│ │ │                                      │││
│ │ │ ...                                  │││
│ │ └──────────────────────────────────────┘││
│ │                                          ││
│ │ [◀️ 上一個] [1/45] [下一個 ▶️]             ││
│ └──────────────────────────────────────────┘│
│                                              │
│ [ 匯出所有 Chunks ]          [ 關閉 ]        │
└──────────────────────────────────────────────┘
```

### 4. 搜尋測試 - 批次測試

```
點擊「批次測試」：
┌──────────────────────────────────────────────┐
│ 🧪 批次搜尋測試                              │
│                                              │
│ 測試查詢（每行一個）：                       │
│ ┌──────────────────────────────────────────┐│
│ │ 如何重設密碼？                            ││
│ │ 產品退貨流程                              ││
│ │ 聯絡客服方式                              ││
│ │ 訂單追蹤                                  ││
│ │ ...                                      ││
│ └──────────────────────────────────────────┘│
│                                              │
│ 或上傳測試集：[📤 上傳 CSV]                  │
│                                              │
│ ⚙️ 測試設定：                                │
│ • Top K：[5]                                │
│ • 相似度閾值：[0.7]                          │
│ • 評估指標：☑ Precision ☑ Recall ☑ NDCG     │
│                                              │
│ [ 開始批次測試 ]          [ 取消 ]           │
└──────────────────────────────────────────────┘

測試結果：
┌──────────────────────────────────────────────┐
│ ✅ 批次測試完成                              │
│                                              │
│ 📊 整體指標：                                │
│ • 平均 Precision@5：0.82                    │
│ • 平均 Recall@5：0.78                       │
│ • 平均 NDCG@5：0.85                         │
│ • 平均響應時間：312ms                        │
│                                              │
│ 📋 詳細結果：                                │
│ ┌──────────────────────────────────────────┐│
│ │ 1. 如何重設密碼？          ✅ 0.92       ││
│ │ 2. 產品退貨流程            ✅ 0.88       ││
│ │ 3. 聯絡客服方式            ⚠️ 0.65       ││
│ │ 4. 訂單追蹤                ✅ 0.91       ││
│ │ ...                                      ││
│ └──────────────────────────────────────────┘│
│                                              │
│ [ 匯出報告 ]  [ 查看詳情 ]  [ 關閉 ]         │
└──────────────────────────────────────────────┘
```

---

## ♿ 無障礙設計

### 鍵盤導航

```yaml
全局快捷鍵:
  Ctrl+N: 創建新知識庫
  Ctrl+U: 上傳文件
  Ctrl+F: 搜尋知識庫/文件
  Ctrl+T: 切換到搜尋測試 Tab
  Esc: 關閉彈出視窗

知識庫列表:
  Tab: 下一個知識庫卡片
  Shift+Tab: 上一個知識庫卡片
  Enter: 開啟知識庫詳情
  Space: 展開/收起卡片資訊

文件列表:
  Ctrl+A: 全選文件
  Space: 勾選/取消勾選當前文件
  Delete: 刪除選中的文件
  Arrow Up/Down: 在文件間移動

搜尋測試:
  Ctrl+Enter: 執行搜尋
  Arrow Up/Down: 在搜尋結果間移動
  Enter: 查看完整 Chunk
```

### ARIA 標籤

```html
<!-- 知識庫列表 -->
<main aria-label="知識庫列表" role="main">
  <header>
    <h1>Knowledge Bases</h1>
    <button aria-label="創建新知識庫">+ 創建知識庫</button>
  </header>

  <input
    type="search"
    aria-label="搜尋知識庫"
    placeholder="搜尋知識庫..."
  />

  <nav aria-label="知識庫列表">
    <ul role="list">
      <li role="listitem">
        <article
          aria-labelledby="kb-1-title"
          aria-describedby="kb-1-desc"
        >
          <h2 id="kb-1-title">Customer Support Knowledge</h2>
          <p id="kb-1-desc">包含客戶支援常見問題...</p>

          <div role="status" aria-live="polite">
            <span aria-label="狀態：就緒">🟢 就緒</span>
          </div>

          <div role="toolbar" aria-label="知識庫操作">
            <button aria-label="查看詳情">📂 查看詳情</button>
            <button aria-label="匯出知識庫">📤 匯出</button>
            <button aria-label="編輯知識庫">✏️ 編輯</button>
            <button aria-label="刪除知識庫">🗑️ 刪除</button>
          </div>
        </article>
      </li>
    </ul>
  </nav>
</main>

<!-- 文件上傳 -->
<form
  role="form"
  aria-label="文件上傳表單"
  enctype="multipart/form-data"
>
  <div
    role="button"
    tabindex="0"
    aria-label="拖曳文件到此處或點擊選擇文件"
    ondrop="handleDrop"
    ondragover="handleDragOver"
  >
    📁 拖曳文件到此處
  </div>

  <input
    type="file"
    multiple
    aria-label="選擇要上傳的文件"
    accept=".pdf,.docx,.txt,.md,.csv,.xlsx"
  />

  <div role="status" aria-live="polite" aria-atomic="true">
    <!-- 上傳進度會在這裡更新 -->
  </div>
</form>

<!-- 搜尋測試 -->
<section aria-labelledby="search-test-heading">
  <h2 id="search-test-heading">搜尋測試</h2>

  <form role="search" aria-label="搜尋測試表單">
    <input
      type="search"
      aria-label="輸入測試查詢"
      placeholder="輸入測試查詢..."
    />

    <fieldset aria-labelledby="search-settings-legend">
      <legend id="search-settings-legend">搜尋設定</legend>

      <label for="top-k-input">Top K</label>
      <input
        id="top-k-input"
        type="number"
        min="1"
        max="20"
        value="5"
        aria-describedby="top-k-help"
      />
      <small id="top-k-help">返回結果數量（1-20）</small>

      <label for="threshold-slider">相似度閾值</label>
      <input
        id="threshold-slider"
        type="range"
        min="0"
        max="1"
        step="0.05"
        value="0.7"
        aria-valuetext="0.7 (70%)"
        aria-describedby="threshold-help"
      />
      <small id="threshold-help">最低相似度分數（0-1）</small>
    </fieldset>

    <button type="submit">🔍 搜尋</button>
  </form>

  <div
    role="region"
    aria-live="polite"
    aria-label="搜尋結果"
  >
    <h3>搜尋結果 (5 個)</h3>

    <ol role="list">
      <li role="listitem">
        <article aria-labelledby="result-1-heading">
          <h4 id="result-1-heading">
            Chunk 1 - 相似度：0.92
          </h4>

          <p aria-label="來源文件">
            📄 來源：customer_faq_v3.pdf (第 5 頁)
          </p>

          <div aria-label="Chunk 內容">
            <!-- Chunk content -->
          </div>

          <div role="toolbar" aria-label="結果操作">
            <button aria-label="查看完整 Chunk">👁️ 查看完整 Chunk</button>
            <button aria-label="開啟來源文件">📄 開啟來源文件</button>
          </div>
        </article>
      </li>
    </ol>
  </div>
</section>
```

### 螢幕閱讀器優化

```yaml
上傳進度通知:
  實現: aria-live="polite"
  行為:
    - 上傳開始：朗讀"開始上傳 3 個文件"
    - 每個文件完成：朗讀"文件 X 上傳完成"
    - 向量化完成：朗讀"向量化完成"
    - 全部完成：朗讀"所有文件處理完成"

搜尋結果通知:
  實現: aria-live="polite"
  行為:
    - 搜尋開始：朗讀"正在搜尋"
    - 搜尋完成：朗讀"找到 5 個相關結果，響應時間 287 毫秒"

焦點管理:
  上傳完成後:
    - 焦點移至"查看文件"按鈕
    - 朗讀"上傳完成，已成功上傳 3 個文件"

  搜尋完成後:
    - 焦點移至第一個搜尋結果
    - 朗讀"搜尋完成，第一個結果相似度 0.92"

錯誤處理:
  上傳失敗:
    - 朗讀詳細錯誤訊息
    - 焦點移至重試按鈕

  處理錯誤:
    - 朗讀錯誤原因和建議
    - 焦點移至修復按鈕
```

---

## ⚡ 性能優化

### 1. 文件上傳優化

```typescript
interface UploadOptimization {
  // 分塊上傳（大文件）
  chunkedUpload: {
    enabled: true,
    chunkSize: '5MB',          // 每塊 5MB
    concurrency: 3,            // 並發上傳 3 塊
    resumable: true            // 支援斷點續傳
  },

  // 並行上傳（多文件）
  parallelUpload: {
    maxConcurrent: 3,          // 最多同時上傳 3 個文件
    queueing: true             // 其餘文件排隊
  },

  // 壓縮
  compression: {
    enabled: true,
    algorithm: 'gzip',
    level: 6                   // 壓縮級別（0-9）
  },

  // 性能收益
  uploadSpeed: '+60%',         // 提升 60% 上傳速度
  bandwidth: '-40%'            // 減少 40% 頻寬使用
}
```

### 2. 向量化處理優化

```typescript
interface VectorizationOptimization {
  // 批次處理
  batchProcessing: {
    batchSize: 50,             // 每批 50 個 Chunks
    parallelBatches: 5,        // 並行處理 5 批
    queueManagement: 'priority' // 優先級佇列
  },

  // 增量更新
  incrementalUpdate: {
    enabled: true,
    onlyProcessNew: true,      // 只處理新增/修改的文件
    changeDetection: 'hash'    // 使用 hash 檢測變更
  },

  // 快取
  embeddingCache: {
    enabled: true,
    ttl: 86400,                // 24 小時
    storage: 'redis'           // Redis 快取
  },

  // 性能收益
  processingTime: '-70%',      // 減少 70% 處理時間
  apiCalls: '-50%'             // 減少 50% API 調用
}
```

### 3. 搜尋優化

```typescript
interface SearchOptimization {
  // 向量索引
  vectorIndex: {
    type: 'HNSW',              // Hierarchical Navigable Small World
    efConstruction: 200,       // 索引構建參數
    m: 16,                     // 連接數
    efSearch: 100              // 搜尋參數
  },

  // 查詢快取
  queryCache: {
    enabled: true,
    ttl: 3600,                 // 1 小時
    maxSize: 1000,             // 最多快取 1000 個查詢
    keyStrategy: 'query+topK+threshold' // 快取鍵策略
  },

  // 混合搜尋
  hybridSearch: {
    enabled: true,
    vectorWeight: 0.7,         // 向量搜尋權重 70%
    keywordWeight: 0.3,        // 關鍵字搜尋權重 30%
    reranking: true            // 結果重排序
  },

  // 性能指標
  searchLatency: '< 500ms',    // 搜尋延遲
  cacheHitRate: '> 40%',       // 快取命中率
  accuracy: '> 85%'            // 準確率（Top 5）
}
```

### 4. 前端優化

```typescript
interface FrontendOptimization {
  // 虛擬滾動
  virtualScrolling: {
    fileList: true,            // 文件列表虛擬滾動
    chunkList: true,           // Chunks 列表虛擬滾動
    itemHeight: 120,           // 項目高度
    bufferSize: 5              // 緩衝區大小
  },

  // 懶加載
  lazyLoading: {
    images: true,              // 圖片懶加載
    chunks: true,              // Chunks 內容懶加載
    threshold: '200px'         // 觸發距離
  },

  // 防抖節流
  debounceThrottle: {
    search: 500,               // 搜尋防抖 500ms
    autoSave: 2000,            // 自動儲存防抖 2s
    scroll: 16                 // 滾動節流 16ms (60fps)
  },

  // 性能收益
  initialLoad: '< 1s',         // 初始載入時間
  listRendering: '< 100ms',    // 列表渲染時間
  memoryUsage: '-60%'          // 減少 60% 記憶體使用
}
```

---

## 🔧 技術實現建議

### 1. 狀態管理（Zustand）

```typescript
// stores/knowledgeBaseStore.ts
import create from 'zustand';

interface Document {
  id: string;
  name: string;
  size: number;
  type: string;
  status: 'processing' | 'completed' | 'error' | 'queued';
  chunks: number;
  uploadedAt: Date;
  processedAt?: Date;
  processingTime?: number;
  error?: string;
}

interface KnowledgeBase {
  id: string;
  name: string;
  description: string;
  status: 'ready' | 'processing' | 'error' | 'unused';
  documents: Document[];
  totalChunks: number;
  totalVectors: number;
  totalSize: number;
  linkedAgents: string[];
  settings: {
    embeddingModel: string;
    chunkSize: number;
    overlap: number;
    dimension: number;
  };
  statistics: {
    totalSearches: number;
    avgResponseTime: number;
    searchAccuracy: number;
  };
  createdAt: Date;
  updatedAt: Date;
}

interface KnowledgeBaseStore {
  // 狀態
  knowledgeBases: KnowledgeBase[];
  activeKBId: string | null;
  isLoading: boolean;
  uploadProgress: Map<string, number>;

  // 知識庫操作
  createKB: (data: Partial<KnowledgeBase>) => Promise<void>;
  updateKB: (id: string, data: Partial<KnowledgeBase>) => Promise<void>;
  deleteKB: (id: string) => Promise<void>;
  loadKB: (id: string) => Promise<void>;

  // 文件操作
  uploadDocuments: (kbId: string, files: File[]) => Promise<void>;
  deleteDocument: (kbId: string, docId: string) => Promise<void>;
  reprocessDocument: (kbId: string, docId: string) => Promise<void>;

  // 搜尋操作
  search: (kbId: string, query: string, options: SearchOptions) => Promise<SearchResult[]>;
  batchSearch: (kbId: string, queries: string[], options: SearchOptions) => Promise<BatchSearchResult>;

  // Agent 關聯
  linkAgent: (kbId: string, agentId: string) => Promise<void>;
  unlinkAgent: (kbId: string, agentId: string) => Promise<void>;
}

const useKnowledgeBaseStore = create<KnowledgeBaseStore>((set, get) => ({
  knowledgeBases: [],
  activeKBId: null,
  isLoading: false,
  uploadProgress: new Map(),

  createKB: async (data) => {
    set({ isLoading: true });

    const newKB: KnowledgeBase = {
      id: generateId(),
      name: data.name || 'New Knowledge Base',
      description: data.description || '',
      status: 'unused',
      documents: [],
      totalChunks: 0,
      totalVectors: 0,
      totalSize: 0,
      linkedAgents: [],
      settings: {
        embeddingModel: 'text-embedding-3-large',
        chunkSize: 512,
        overlap: 128,
        dimension: 1536
      },
      statistics: {
        totalSearches: 0,
        avgResponseTime: 0,
        searchAccuracy: 0
      },
      createdAt: new Date(),
      updatedAt: new Date()
    };

    await api.createKnowledgeBase(newKB);

    set((state) => ({
      knowledgeBases: [...state.knowledgeBases, newKB],
      isLoading: false
    }));
  },

  uploadDocuments: async (kbId: string, files: File[]) => {
    const kb = get().knowledgeBases.find(kb => kb.id === kbId);
    if (!kb) return;

    // 初始化上傳進度
    files.forEach(file => {
      get().uploadProgress.set(file.name, 0);
    });

    // 並行上傳（最多 3 個）
    const uploadPromises = files.map(async (file, index) => {
      // 分塊上傳大文件
      if (file.size > 5 * 1024 * 1024) { // > 5MB
        return await uploadLargeFile(file, (progress) => {
          set((state) => {
            const newProgress = new Map(state.uploadProgress);
            newProgress.set(file.name, progress);
            return { uploadProgress: newProgress };
          });
        });
      } else {
        return await uploadSmallFile(file);
      }
    });

    const uploadedDocs = await Promise.all(uploadPromises);

    // 開始向量化
    set((state) => ({
      knowledgeBases: state.knowledgeBases.map(kb =>
        kb.id === kbId
          ? {
              ...kb,
              status: 'processing',
              documents: [...kb.documents, ...uploadedDocs.map(doc => ({
                ...doc,
                status: 'queued' as const
              }))]
            }
          : kb
      )
    }));

    // 批次向量化
    await vectorizeDocuments(kbId, uploadedDocs, kb.settings, (progress) => {
      // 更新向量化進度
      set((state) => ({
        knowledgeBases: state.knowledgeBases.map(kb =>
          kb.id === kbId
            ? {
                ...kb,
                documents: kb.documents.map(doc => ({
                  ...doc,
                  status: progress[doc.id]?.status || doc.status,
                  chunks: progress[doc.id]?.chunks || doc.chunks
                }))
              }
            : kb
        )
      }));
    });

    // 完成
    set((state) => ({
      knowledgeBases: state.knowledgeBases.map(kb =>
        kb.id === kbId
          ? {
              ...kb,
              status: 'ready',
              updatedAt: new Date()
            }
          : kb
      )
    }));
  },

  search: async (kbId, query, options) => {
    const startTime = performance.now();

    const results = await api.search({
      kbId,
      query,
      topK: options.topK || 5,
      threshold: options.threshold || 0.7,
      reranking: options.reranking || false,
      hybridSearch: options.hybridSearch || false
    });

    const responseTime = performance.now() - startTime;

    // 更新統計
    set((state) => ({
      knowledgeBases: state.knowledgeBases.map(kb =>
        kb.id === kbId
          ? {
              ...kb,
              statistics: {
                ...kb.statistics,
                totalSearches: kb.statistics.totalSearches + 1,
                avgResponseTime: (kb.statistics.avgResponseTime * kb.statistics.totalSearches + responseTime) / (kb.statistics.totalSearches + 1)
              }
            }
          : kb
      )
    }));

    return results;
  }
}));
```

### 2. 文件上傳（分塊上傳）

```typescript
// services/uploadService.ts
interface UploadOptions {
  chunkSize?: number;
  maxConcurrent?: number;
  onProgress?: (progress: number) => void;
  onChunkComplete?: (chunkIndex: number) => void;
}

async function uploadLargeFile(
  file: File,
  onProgress?: (progress: number) => void
): Promise<Document> {
  const chunkSize = 5 * 1024 * 1024; // 5MB chunks
  const totalChunks = Math.ceil(file.size / chunkSize);

  // 初始化上傳
  const uploadId = await api.initializeUpload({
    fileName: file.name,
    fileSize: file.size,
    totalChunks
  });

  // 上傳所有分塊
  const uploadedChunks: string[] = [];

  for (let i = 0; i < totalChunks; i++) {
    const start = i * chunkSize;
    const end = Math.min(start + chunkSize, file.size);
    const chunk = file.slice(start, end);

    // 上傳分塊
    const chunkETag = await api.uploadChunk({
      uploadId,
      chunkIndex: i,
      chunk
    });

    uploadedChunks.push(chunkETag);

    // 更新進度
    const progress = ((i + 1) / totalChunks) * 100;
    onProgress?.(progress);
  }

  // 完成上傳
  const document = await api.completeUpload({
    uploadId,
    chunks: uploadedChunks
  });

  return document;
}

async function uploadSmallFile(file: File): Promise<Document> {
  const formData = new FormData();
  formData.append('file', file);

  const response = await fetch('/api/knowledge-bases/upload', {
    method: 'POST',
    body: formData
  });

  return await response.json();
}
```

### 3. 向量搜尋

```typescript
// services/searchService.ts
interface SearchOptions {
  topK: number;
  threshold: number;
  reranking: boolean;
  hybridSearch: boolean;
  filter?: {
    documentIds?: string[];
    dateRange?: [Date, Date];
  };
}

interface SearchResult {
  chunkId: string;
  content: string;
  score: number;
  metadata: {
    documentId: string;
    documentName: string;
    pageNumber?: number;
    chunkIndex: number;
  };
}

async function search(
  kbId: string,
  query: string,
  options: SearchOptions
): Promise<SearchResult[]> {
  // 檢查快取
  const cacheKey = `${kbId}:${query}:${JSON.stringify(options)}`;
  const cached = await cache.get(cacheKey);

  if (cached) {
    return cached;
  }

  // 向量搜尋
  const vectorResults = await vectorSearch(kbId, query, options);

  // 混合搜尋（向量 + 關鍵字）
  let results = vectorResults;

  if (options.hybridSearch) {
    const keywordResults = await keywordSearch(kbId, query, options);

    // 合併結果（加權）
    results = mergeResults(vectorResults, keywordResults, {
      vectorWeight: 0.7,
      keywordWeight: 0.3
    });
  }

  // 重排序
  if (options.reranking) {
    results = await rerank(query, results);
  }

  // 過濾低分結果
  results = results.filter(r => r.score >= options.threshold);

  // 取 Top K
  results = results.slice(0, options.topK);

  // 快取結果
  await cache.set(cacheKey, results, { ttl: 3600 });

  return results;
}

async function vectorSearch(
  kbId: string,
  query: string,
  options: SearchOptions
): Promise<SearchResult[]> {
  // 1. 生成查詢向量
  const queryVector = await generateEmbedding(query);

  // 2. 向量搜尋（使用 HNSW 索引）
  const results = await vectorDB.search({
    collection: `kb_${kbId}`,
    vector: queryVector,
    limit: options.topK * 2, // 取 2 倍以便後續重排序
    filter: options.filter
  });

  return results.map(r => ({
    chunkId: r.id,
    content: r.payload.content,
    score: r.score,
    metadata: r.payload.metadata
  }));
}

async function rerank(
  query: string,
  results: SearchResult[]
): Promise<SearchResult[]> {
  // 使用 Cross-Encoder 重排序
  const rerankScores = await api.rerank({
    query,
    documents: results.map(r => r.content)
  });

  return results
    .map((r, i) => ({
      ...r,
      score: rerankScores[i]
    }))
    .sort((a, b) => b.score - a.score);
}
```

---

## 📐 設計決策記錄（ADR）

### ADR-001: 3-Tab 佈局 vs 單頁佈局

**決策**: 使用 3-Tab 佈局（總覽、文件、搜尋測試）

**理由**:
1. **分離關注點**: 不同任務（查看統計、管理文件、測試搜尋）分開
2. **降低認知負荷**: 每個 Tab 聚焦單一任務，避免資訊過載
3. **提升效能**: 只載入當前 Tab 的內容，減少初始載入時間
4. **符合心智模型**: 用戶期望的知識庫管理流程

**權衡**:
- ✅ 優點: 清晰、高效、可擴展
- ❌ 缺點: 需要多次點擊切換 Tab

**替代方案**:
- 單頁滾動: 簡單但資訊過載
- 多頁路由: 過於分散

---

### ADR-002: 即時向量化 vs 批次向量化

**決策**: 支援兩種模式，預設使用批次向量化

**理由**:
1. **效能**: 批次處理可減少 API 調用，提升 70% 效能
2. **成本**: 批次請求可享受折扣，降低 40% 成本
3. **靈活性**: 少量文件時可使用即時模式，大量文件時使用批次模式
4. **用戶體驗**: 批次模式不會阻塞 UI，用戶可繼續操作

**權衡**:
- ✅ 優點: 高效、低成本、不阻塞
- ❌ 缺點: 延遲略高（可接受）

**實現**:
```typescript
uploadMode: 'batch' | 'realtime'

if (files.length > 10 || totalSize > 50MB) {
  uploadMode = 'batch';
} else {
  uploadMode = 'realtime';
}
```

---

### ADR-003: 混合搜尋（Vector + Keyword）

**決策**: 預設啟用混合搜尋（向量 70% + 關鍵字 30%）

**理由**:
1. **準確率提升**: 混合搜尋可提升 15% 準確率
2. **互補性**: 向量搜尋擅長語義理解，關鍵字搜尋擅長精確匹配
3. **魯棒性**: 當查詢包含專有名詞或縮寫時，關鍵字搜尋更可靠
4. **行業標準**: OpenAI、Pinecone、Weaviate 均推薦混合搜尋

**權衡**:
- ✅ 優點: 準確率高、魯棒、通用
- ❌ 缺點: 複雜度略高、延遲略增（+50ms）

**實現**:
```typescript
hybridScore = vectorScore * 0.7 + keywordScore * 0.3;

// 支援自訂權重
hybridSearch: {
  vectorWeight: 0.7,
  keywordWeight: 0.3
}
```

---

### ADR-004: Chunk 查看器設計

**決策**: 提供專用的 Chunk 查看器，支援逐個瀏覽和搜尋

**理由**:
1. **除錯需求**: 開發者需要檢查 Chunk 切分是否合理
2. **品質保證**: 分析師需要驗證向量化是否正確
3. **優化參考**: 可根據 Chunk 品質調整切分參數
4. **教育價值**: 幫助用戶理解 RAG 工作原理

**權衡**:
- ✅ 優點: 透明、可調試、教育價值
- ❌ 缺點: UI 複雜度增加

**UI 範例**:
```
Chunk 1 / 45
[◀️ 上一個] [1/45] [下一個 ▶️]

📊 資訊：
• Tokens：512
• 位置：第 1 頁
• 向量 ID：vec_abc123

📝 內容：
[Chunk 文字內容...]
```

---

## ✅ 驗收標準

### 功能完整性
- [ ] 知識庫 CRUD 操作
- [ ] 文件上傳（單個/批次）
- [ ] 支援多種文件格式（PDF, DOCX, TXT, MD, CSV, XLSX）
- [ ] 自動向量化處理
- [ ] 處理進度即時顯示
- [ ] 錯誤處理與重試
- [ ] Chunk 查看與管理
- [ ] 向量搜尋測試
- [ ] 批次搜尋測試
- [ ] 搜尋參數調整（Top K, threshold, reranking）
- [ ] Agent 關聯管理

### 性能指標
- [ ] 文件上傳成功率 > 99%
- [ ] 向量化處理時間 < 30s/MB
- [ ] 搜尋響應時間 < 500ms
- [ ] 搜尋準確率 > 85%（Top 3）
- [ ] 支援 >10,000 個 Chunks 的知識庫

### 無障礙合規
- [ ] WCAG 2.1 AA 合規
- [ ] 完整鍵盤導航支援
- [ ] 螢幕閱讀器優化
- [ ] ARIA 標籤完整
- [ ] 上傳進度即時通知

### 響應式設計
- [ ] Desktop (≥1280px) 3-Tab 佈局
- [ ] Tablet (768-1279px) 堆疊式佈局
- [ ] Mobile (<768px) 全屏佈局
- [ ] 所有斷點下功能完整可用

---

**文檔版本**: 1.0.0
**最後更新**: 2025-10-29
**審核狀態**: ✅ 已完成
**下一步**: 開始創建 Code Interpreter Wireframe (07-code-interpreter.md)
